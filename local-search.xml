<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>iOSä¹‹fishhook</title>
    <link href="/2021/08/22/iOS%E4%B9%8Bfishhook/"/>
    <url>/2021/08/22/iOS%E4%B9%8Bfishhook/</url>
    
    <content type="html"><![CDATA[<h2 id="fishhook"><a href="#fishhook" class="headerlink" title="fishhook"></a>fishhook</h2><p><a href="https://github.com/facebook/fishhook">fishHook</a>æ˜¯Facebookæä¾›çš„ä¸€ä¸ªåŠ¨æ€ä¿®æ”¹é“¾æ¥mach-Oæ–‡ä»¶çš„å·¥å…·ã€‚åˆ©ç”¨MachOæ–‡ä»¶åŠ è½½åŸç†ï¼Œé€šè¿‡é‡æ–°ç»‘å®š(rebind_symbols)æ‡’åŠ è½½è¡¨(Lazy Symbol Pointers)å’Œéæ‡’åŠ è½½è¡¨(Non-Lazy Symbol Pointers)è¿™ä¸¤ä¸ªè¡¨çš„æŒ‡é’ˆè¾¾åˆ°Cå‡½æ•°HOOKçš„ç›®çš„ã€‚</p><blockquote><p>dyldåŠ è½½machoæ–‡ä»¶å’Œç³»ç»Ÿæ¡†æ¶,å¯¹å‡½æ•°åœ°å€å¤åˆ¶çš„è¿‡ç¨‹ï¼Œæˆä¸º <strong>â€œç¬¦å·ç»‘å®šâ€œ</strong></p></blockquote><h2 id="è°ƒè¯•åˆ†æfishHook"><a href="#è°ƒè¯•åˆ†æfishHook" class="headerlink" title="è°ƒè¯•åˆ†æfishHook"></a>è°ƒè¯•åˆ†æfishHook</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">//</span><br><span class="hljs-comment">//  ViewController.m</span><br><span class="hljs-comment">//  fishhook</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//  Created by Cola on 2020/5/24.</span><br><span class="hljs-comment">//  Copyright Â© 2020 Cola. All rights reserved.</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;ViewController.h&quot;</span></span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;fishhook.h&quot;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> ()</span><br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">ViewController</span></span><br><br>- (<span class="hljs-keyword">void</span>)viewDidLoad &#123;<br>    [<span class="hljs-keyword">super</span> viewDidLoad];<br>   <br>    <span class="hljs-comment">//ä¸€ä¸ªrebinding hookä¸€ä¸ªå‡½æ•°,æƒ³è¦hookå¤šä¸ªå‡½æ•°ï¼Œå¯ä»¥å°†rebindingæ·»åŠ è‡³æ•°ç»„</span><br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1&quot;</span>);<br>    <span class="hljs-comment">//æ›´æ”¹ç³»ç»Ÿçš„NSLogaå‡½æ•°</span><br>    <span class="hljs-keyword">struct</span> rebinding nslog;<br>    nslog.name = <span class="hljs-string">&quot;NSLog&quot;</span>;<br>    nslog.replacement = myNSLog;<br>    nslog.replaced = &amp;sys_nslog;<br>    <br>    <span class="hljs-keyword">struct</span> rebinding rebs[<span class="hljs-number">1</span>] = &#123;nslog&#125;;<br>    <br>    <br>    rebind_symbols(rebs, <span class="hljs-number">1</span>);<br>     <br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)touchesBegan:(<span class="hljs-built_in">NSSet</span>&lt;<span class="hljs-built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="hljs-built_in">UIEvent</span> *)event&#123;<br> <br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;ç‚¹å‡»&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//å‡½æ•°æŒ‡é’ˆ</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> (*sys_nslog)(<span class="hljs-built_in">NSString</span> * _Nonnull format, ...);<br> <br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæ–°çš„å‡½æ•°</span><br><span class="hljs-keyword">void</span> myNSLog(<span class="hljs-built_in">NSString</span> * _Nonnull format, ...)&#123;<br>    format = [format stringByAppendingFormat:<span class="hljs-string">@&quot;\n HOOKæˆåŠŸğŸ‚&quot;</span>];<br>    sys_nslog(format);<br>&#125;<br><br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><ol><li><p>é€šè¿‡machoViewæŸ¥çœ‹ç¬¦å·è¡¨(Lazy Symbol Pointers)çš„åç§»é‡(æ¯”å¦‚NSLogçš„åç§»é‡æ˜¯) 0x00005000</p></li><li><p>åœ¨<code>rebind_symbols(rebs, 1);</code>ä¸‹æ–­ç‚¹,</p></li><li><p>é€šè¿‡image listæŸ¥çœ‹åŠ è½½çš„machoæ–‡ä»¶å’Œæ‰€æœ‰çš„æ¡†æ¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">(lldb) image list<br>[  <span class="hljs-number">0</span>] E10158F5-<span class="hljs-number">413</span>E-<span class="hljs-number">35</span>E1-A349-<span class="hljs-number">8</span>AFA71FFC955 <span class="hljs-number">0</span>x0000000103db1000 <span class="hljs-regexp">/Users/</span>cola<span class="hljs-regexp">/Library/</span>Developer<span class="hljs-regexp">/Xcode/</span>DerivedData<span class="hljs-regexp">/fishhook-dduxiymrdkidvtcxqmuqqwanbexr/</span>Build<span class="hljs-regexp">/Products/</span>Debug-iphonesimulator<span class="hljs-regexp">/fishhook.app/</span>fishhook <br>[  <span class="hljs-number">1</span>] EEA931D0-<span class="hljs-number">403</span>E-<span class="hljs-number">3</span>BC8-<span class="hljs-number">862</span>A-CBA037DE4A74 <span class="hljs-number">0</span>x00000001048e3000 <span class="hljs-regexp">/usr/</span>lib/dyld <br>[  <span class="hljs-number">2</span>] <span class="hljs-number">75369</span>F31-<span class="hljs-number">702</span>D-<span class="hljs-number">364</span>A-<span class="hljs-number">95</span>C3-<span class="hljs-number">8</span>AFA9DD4B3A2 <span class="hljs-number">0</span>x0000000103dbf000 <span class="hljs-regexp">/Applications/</span>Xcode.app<span class="hljs-regexp">/Contents/</span>Developer<span class="hljs-regexp">/Platforms/i</span>PhoneOS.platform<span class="hljs-regexp">/Library/</span>Developer<span class="hljs-regexp">/CoreSimulator/</span>Profiles<span class="hljs-regexp">/Runtimes/i</span>OS.simruntime<span class="hljs-regexp">/Contents/</span>Resources<span class="hljs-regexp">/RuntimeRoot/u</span>sr<span class="hljs-regexp">/lib/</span>dyld_sim <br>[  <span class="hljs-number">3</span>] <span class="hljs-number">56</span>E47800-<span class="hljs-number">2</span>CCB-<span class="hljs-number">3</span>B7D-B94B-CCF5F13D6BCF <span class="hljs-number">0</span>x00007fff256b8000 <span class="hljs-regexp">/Applications/</span>Xcode.app<span class="hljs-regexp">/Contents/</span>Developer<span class="hljs-regexp">/Platforms/i</span>PhoneOS.platform<span class="hljs-regexp">/Library/</span>Developer<span class="hljs-regexp">/CoreSimulator/</span>Profiles<span class="hljs-regexp">/Runtimes/i</span>OS.simruntime<span class="hljs-regexp">/Contents/</span>Resources<span class="hljs-regexp">/RuntimeRoot/</span>System<span class="hljs-regexp">/Library/</span>Frameworks<span class="hljs-regexp">/Foundation.framework/</span>Foundation <br>[  <span class="hljs-number">4</span>] <span class="hljs-number">3</span>EC683F6-<span class="hljs-number">36</span>EF-<span class="hljs-number">33</span>E1-<span class="hljs-number">8</span>B98-C95E12BA38D2 <span class="hljs-number">0</span>x00007fff513f6000 <span class="hljs-regexp">/Applications/</span>Xcode.app<span class="hljs-regexp">/Contents/</span>Developer<span class="hljs-regexp">/Platforms/i</span>PhoneOS.platform<span class="hljs-regexp">/Library/</span>Developer<span class="hljs-regexp">/CoreSimulator/</span>Profiles<span class="hljs-regexp">/Runtimes/i</span>OS.simruntime<span class="hljs-regexp">/Contents/</span>Resources<span class="hljs-regexp">/RuntimeRoot/u</span>sr<span class="hljs-regexp">/lib/</span>libobjc.A.dylib <br>[  <span class="hljs-number">5</span>] <span class="hljs-number">7881</span>AD7F-<span class="hljs-number">524</span>C-<span class="hljs-number">3</span>CFA-<span class="hljs-number">9595</span>-<span class="hljs-number">02</span>ED549166AA <span class="hljs-number">0</span>x00007fff4ff15000 <span class="hljs-regexp">/Applications/</span>Xcode.app<span class="hljs-regexp">/Contents/</span>Developer<span class="hljs-regexp">/Platforms/i</span>PhoneOS.platform<span class="hljs-regexp">/Library/</span>Developer<span class="hljs-regexp">/CoreSimulator/</span>Profiles<span class="hljs-regexp">/Runtimes/i</span>OS.simruntime<span class="hljs-regexp">/Contents/</span>Resources<span class="hljs-regexp">/RuntimeRoot/u</span>sr<span class="hljs-regexp">/lib/</span>libSystem.B.dylib <br><br>.......<br></code></pre></td></tr></table></figure></li><li><p>machoæ–‡ä»¶çš„é¦–åœ°å€+ç¬¬ä¸€æ­¥çš„åç§»é‡ï¼Œå°±æ˜¯NSLogçš„çœŸå®åœ°å€,è¯»NSLogçš„ç¬¦å·è¡¨åœ°å€</p><p>memory read  ç®€å†™   x 0x0000000103db1000+0x00005000</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tap">(lldb) memory read 0x0000000103db1000+0x00005000<br>0x103db6000: fa 2d<span class="hljs-number"> 76 </span>25 ff 7f<span class="hljs-number"> 00 </span>00 f8 d1<span class="hljs-number"> 74 </span>25 ff 7f<span class="hljs-number"> 00 </span>00  .-v%......t%....<br>0x103db6010: f8<span class="hljs-number"> 26 </span>09<span class="hljs-number"> 48 </span>ff 7f<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 44 </span>34 db<span class="hljs-number"> 03 </span>01<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span> .&amp;.H....D4......<br></code></pre></td></tr></table></figure></li><li><p>å…¶ä¸­å‰å…«ä¸ªå­—èŠ‚ä¸ºNSLogçš„åœ°å€<br>æŸ¥çœ‹4ä¸­çš„å‰å…«ä¸ªå­—èŠ‚çš„åœ°å€çš„æ±‡ç¼–ä»£ç </p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(lldb) dis -s <span class="hljs-number">0x7fff25762dfa</span><br>Foundation`NSLog:<br>    <span class="hljs-number">0x7fff25762dfa</span> &lt;+<span class="hljs-number">0</span>&gt;:  pushq  <span class="hljs-variable">%rbp</span><br>    <span class="hljs-number">0x7fff25762dfb</span> &lt;+<span class="hljs-number">1</span>&gt;:  movq   <span class="hljs-variable">%rsp</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rbp</span><br>    <span class="hljs-number">0x7fff25762dfe</span> &lt;+<span class="hljs-number">4</span>&gt;:  subq   $<span class="hljs-number">0xd0</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rsp</span><br>    <span class="hljs-number">0x7fff25762e05</span> &lt;+<span class="hljs-number">11</span>&gt;: testb  <span class="hljs-variable">%al</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%al</span><br>    <span class="hljs-number">0x7fff25762e07</span> &lt;+<span class="hljs-number">13</span>&gt;: je     <span class="hljs-number">0x7fff25762e2f</span>            <span class="hljs-comment">; &lt;+53&gt;</span><br>    <span class="hljs-number">0x7fff25762e09</span> &lt;+<span class="hljs-number">15</span>&gt;: movaps <span class="hljs-variable">%xmm0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">-0</span>xa<span class="hljs-number">0</span>(<span class="hljs-variable">%rbp</span>)<br>    <span class="hljs-number">0x7fff25762e10</span> &lt;+<span class="hljs-number">22</span>&gt;: movaps <span class="hljs-variable">%xmm1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">-0</span><span class="hljs-keyword">x</span><span class="hljs-number">90</span>(<span class="hljs-variable">%rbp</span>)<br></code></pre></td></tr></table></figure><p>ä»ä¸­å¯ä»¥çœ‹è§NSLogçš„åœ°å€</p></li><li><p>å•æ­¥æ‰§è¡Œï¼Œæ‰§è¡Œfishhookçš„rebind_symbolsæ–¹æ³•åæŸ¥çœ‹NSLogçš„çœŸå®åœ°å€</p><p>å’Œ4ç›¸æ¯”åœ°å€å·²ç»æ”¹å˜</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tap">(lldb) memory read 0x000000010f550000+0x00005000<br>0x10f555000:<span class="hljs-number"> 50 </span>14<span class="hljs-number"> 55 </span>0f<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 00 </span>00 f8 d1<span class="hljs-number"> 74 </span>25 ff 7f<span class="hljs-number"> 00 </span>00  P.U.......t%....<br>0x10f555010: f8<span class="hljs-number"> 26 </span>09<span class="hljs-number"> 48 </span>ff 7f<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 54 </span>99<span class="hljs-number"> 34 </span>52 ff 7f<span class="hljs-number"> 00 </span>00  .&amp;.H....T.4R....<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å‰å…«ä¸ªå­—èŠ‚å¯¹åº”åœ°å€çš„æ±‡ç¼–ä»£ç ï¼Œå‘ç°å·²ç»è¢«æ›¿æ¢æˆæˆ‘ä»¬çš„myNSlogæ–¹æ³•</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(lldb) dis -s <span class="hljs-number">010</span>f<span class="hljs-number">551450</span><br>fishhook`myNSLog:<br>    <span class="hljs-number">0x10f551450</span> &lt;+<span class="hljs-number">0</span>&gt;:  pushq  <span class="hljs-variable">%rbp</span><br>    <span class="hljs-number">0x10f551451</span> &lt;+<span class="hljs-number">1</span>&gt;:  movq   <span class="hljs-variable">%rsp</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rbp</span><br>    <span class="hljs-number">0x10f551454</span> &lt;+<span class="hljs-number">4</span>&gt;:  subq   $<span class="hljs-number">0x30</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rsp</span><br>    <span class="hljs-number">0x10f551458</span> &lt;+<span class="hljs-number">8</span>&gt;:  movq   $<span class="hljs-number">0x0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">-0</span><span class="hljs-keyword">x</span><span class="hljs-number">8</span>(<span class="hljs-variable">%rbp</span>)<br>    <span class="hljs-number">0x10f551460</span> &lt;+<span class="hljs-number">16</span>&gt;: leaq   <span class="hljs-number">-0</span><span class="hljs-keyword">x</span><span class="hljs-number">8</span>(<span class="hljs-variable">%rbp</span>)<span class="hljs-punctuation">,</span> <span class="hljs-variable">%rax</span><br>    <span class="hljs-number">0x10f551464</span> &lt;+<span class="hljs-number">20</span>&gt;: movq   <span class="hljs-variable">%rdi</span><span class="hljs-punctuation">,</span> <span class="hljs-number">-0</span><span class="hljs-keyword">x</span><span class="hljs-number">10</span>(<span class="hljs-variable">%rbp</span>)<br>    <span class="hljs-number">0x10f551468</span> &lt;+<span class="hljs-number">24</span>&gt;: movq   <span class="hljs-variable">%rax</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rdi</span><br>    <span class="hljs-number">0x10f55146b</span> &lt;+<span class="hljs-number">27</span>&gt;: movq   <span class="hljs-number">-0</span><span class="hljs-keyword">x</span><span class="hljs-number">10</span>(<span class="hljs-variable">%rbp</span>)<span class="hljs-punctuation">,</span> <span class="hljs-variable">%rsi</span><br>(lldb) <br></code></pre></td></tr></table></figure></li><li><p>è°ƒç”¨åŸæ–¹æ³•</p><p>å› ä¸ºç³»ç»Ÿé»˜è®¤ç»‘å®šçš„åœ°å€è¢«ä¿å­˜åˆ°äº†ï¼Œè‡ªå®šä¹‰çš„å˜é‡ä¸­ï¼Œå¯ä»¥é€šè¿‡åœ°å€è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">//å‡½æ•°æŒ‡é’ˆ</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> (*sys_nslog)(<span class="hljs-built_in">NSString</span> * _Nonnull format, ...);<br></code></pre></td></tr></table></figure><p>è°ƒç”¨åŸæ–¹æ³•</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæ–°çš„å‡½æ•°</span><br>void myNSLog(NSString * <span class="hljs-variable">_Nonnull</span> <span class="hljs-built_in">format</span>, ...)&#123;<br>    <span class="hljs-built_in">format</span> = [<span class="hljs-built_in">format</span> stringByAppendingFormat:@<span class="hljs-string">&quot;\n HOOKæˆåŠŸğŸ‚&quot;</span>];<br>    sys_nslog(<span class="hljs-built_in">format</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="fishHOOKåŸç†"><a href="#fishHOOKåŸç†" class="headerlink" title="fishHOOKåŸç†"></a>fishHOOKåŸç†</h2><p><strong>é‡æ–°ç»‘å®šç¬¦å·è¡¨</strong></p><p>æ‡’åŠ è½½ç¬¦å·è¡¨ä¸indirect symbolsè¡¨ä¸€ä¸€å¯¹åº”</p> <img src="/2021/08/22/iOS%E4%B9%8Bfishhook/images/%E6%87%92%E5%8A%A0%E8%BD%BD%E7%AC%A6%E5%8F%B7%E8%A1%A8.png" class=""><p>indirect symbolsè¡¨ä¸­NSLogçš„Dataå€¼ä¸ºA6</p> <img src="/2021/08/22/iOS%E4%B9%8Bfishhook/images/indirectsymbols%E8%A1%A8.png" class=""><p>A6è½¬ä¸º10è¿›åˆ¶ä¸º166,å…¶ä¸­166å¯¹åº”ç€Symbols Tableä¸‹çš„Symbols</p> <img src="/2021/08/22/iOS%E4%B9%8Bfishhook/images/Symbols.png" class=""><p>å…¶ä¸­ #166åœ¨String Table Indexè¡¨çš„åç§»ä¸ºD7ï¼Œç¬¦å·è¡¨åŸºå€ä¸º83ACï¼ŒNSLogçš„åœ°å€ä¸º 83AC+D7=8483</p> <img src="/2021/08/22/iOS%E4%B9%8Bfishhook/images/StringTable.png" class=""><p>è€ŒfishHookåˆ™æ˜¯é€†è¿‡ç¨‹ï¼Œé€šè¿‡String Tableè¡¨NSLogçš„åœ°å€ï¼Œæ‰¾åˆ°Lazy Symbols Pointers(æ‡’åŠ è½½ç¬¦å·è¡¨)ä¸­çš„NSLogç¬¦å·è¡¨åœ°å€ï¼Œè·å–æ‡’åŠ è½½ç¬¦å·è¡¨çš„åç§».</p><h2 id="fishHOOKèƒ½åšä»€ä¹ˆ"><a href="#fishHOOKèƒ½åšä»€ä¹ˆ" class="headerlink" title="fishHOOKèƒ½åšä»€ä¹ˆ"></a>fishHOOKèƒ½åšä»€ä¹ˆ</h2><ol><li><p>åº”ç”¨å®‰å…¨é˜²æŠ¤ï¼š</p><p> å°†ç³»ç»Ÿæ•æ„Ÿå‡½æ•°ï¼ŒçœŸå®åœ°å€ä¿å­˜ï¼Œå¹¶å°†è¯¥æ–¹æ³•è®¾ç½®ä¸ºå®å®šä¹‰,ä»¥åä½¿ç”¨å®å®šä¹‰è®¾ç½®çš„æ–¹æ³•ï¼Œåˆ«äººå°±æ— æ³•HOOKè¯¥æ–¹æ³•äº†ï¼Œå› ä¸ºä½ ä½¿ç”¨çš„æ˜¯å‡½æ•°çš„çœŸå®åœ°å€ï¼Œå¹¶ä¸æ˜¯è°ƒç”¨ç¬¦å·è¡¨ä¸­çš„å‡½æ•°åœ°å€ï¼Œè¿™æ ·åˆ«äººä¿®æ”¹ç¬¦å·è¡¨æ˜¯ä¸å½±å“ç¨‹åºçš„ã€‚</p><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„:"></a>æ³¨æ„:</h4><p> ä¸‰æ–¹æ¡†æ¶æœ‰å¯èƒ½ä¼šç”¨åˆ°è¯¥å‡½æ•°ï¼Œå¦‚æœfishhookåŠ è½½çš„è¿‡æ—©ä¼šå¯¼è‡´ä¸‰æ–¹æ¡†æ¶å¤±æ•ˆã€‚</p></li></ol><ol start="2"><li><p>å¯åŠ¨ä¼˜åŒ–ã€åŸ‹ç‚¹ã€AOP</p><ul><li>å®šä½æ‰€æœ‰æ–¹æ³•çš„è°ƒç”¨ï¼Œhook objc_msgSendå‡½æ•°?</li><li>äºŒè¿›åˆ¶é‡æ’(layout)çš„ç›®çš„åœ¨äºå°†hot codeèšåˆåœ¨ä¸€èµ·ï¼Œå³ä½¿å¾—æœ€ç»å¸¸æ‰§è¡Œçš„ä»£ç æˆ–æœ€éœ€è¦å…³é”®æ‰§è¡Œçš„ä»£ç ï¼ˆå¦‚å¯åŠ¨é˜¶æ®µçš„é¡ºåºè°ƒç”¨ï¼‰èšåˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªæ›´ç´§å‡‘çš„__TEXTæ®µã€‚</li></ul></li></ol><p>â€‹    </p><p>â€‹    </p>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iOS</tag>
      
      <tag>hook</tag>
      
      <tag>fishhook</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSä¹‹åè°ƒè¯•</title>
    <link href="/2021/08/22/iOS%E4%B9%8B%E5%8F%8D%E8%B0%83%E8%AF%95/"/>
    <url>/2021/08/22/iOS%E4%B9%8B%E5%8F%8D%E8%B0%83%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<h2 id="ptrace-åè°ƒ"><a href="#ptrace-åè°ƒ" class="headerlink" title="ptrace åè°ƒ"></a>ptrace åè°ƒ</h2><p>ptraceåè°ƒè¯•ï¼Œé˜»æ­¢LLDBé™„åŠ è°ƒè¯•</p><p>åœ¨Unix ç³»ç»Ÿä¸­ï¼Œæä¾›äº†ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ ptrace ç”¨äºå®ç°æ–­ç‚¹è°ƒè¯•å’Œå¯¹è¿›ç¨‹è¿›è¡Œè·Ÿè¸ªå’Œæ§åˆ¶ï¼Œè€Œ PT_DENY_ATTACH æ˜¯è‹¹æœå¢åŠ çš„ä¸€ä¸ª ptrace é€‰é¡¹ï¼Œè¿™ä¸ªå‚æ•°ç”¨æ¥å‘Šè¯‰ç³»ç»Ÿï¼Œé˜»æ­¢è°ƒè¯•å™¨ä¾é™„ï¼Œæœ¬è´¨å°±æ˜¯é€šè¿‡26å·ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆçš„ï¼Œç›®å‰å¤§å¤šåè°ƒè¯•éƒ½åˆ©ç”¨è¯¥æ–¹æ¡ˆ,ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">#import &lt;dlfcn.h&gt;<br><br>#import &lt;sys/types.h&gt;<br><br>typedef int (*ptrace_ptr_t)(int _request, pid_t pid, caddr_t _addr, int _data);<br><br>#if !defined(PT_DENT_ATTACH)<br><br>#define PT_DENT_ATTACH 31<br><br>#endif<br><br>void disable_debug() &#123;<br><br>        void * handle = dlopen(0, RTLD_GLOBAL|RTLD_NOW);<br>    <br>        ptrace_ptr_t ptrace_ptr = dlsym(handle, &quot;ptrace&quot;);<br>    <br>        ptrace_ptr(PT_DENT_ATTACH, 0, 0, 0);<br>    <br>        dlclose(handle);<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="sysctlåè°ƒè¯•"><a href="#sysctlåè°ƒè¯•" class="headerlink" title="sysctlåè°ƒè¯•"></a>sysctlåè°ƒè¯•</h2><p>å½“ä¸€ä¸ªè¿›ç¨‹è¢«è°ƒè¯•çš„æ—¶å€™ï¼Œè¯¥è¿›ç¨‹ä¼šæœ‰ä¸€ä¸ªæ ‡è®°æ¥æ ‡è®°è‡ªå·±æ­£åœ¨è¢«è°ƒè¯•ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡sysctlå»æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ä¿¡æ¯ï¼Œçœ‹æœ‰æ²¡æœ‰è¿™ä¸ªæ ‡è®°ä½å³å¯æ£€æŸ¥å½“å‰è°ƒè¯•çŠ¶æ€ã€‚</p><p>å‡½æ•°ä»‹ç»</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp">å‡½æ•°çš„è¿”å›å€¼è‹¥ä¸º<span class="hljs-number">0</span>æ—¶ï¼Œè¯æ˜æ²¡æœ‰é”™è¯¯ï¼Œå…¶ä»–æ•°å­—ä¸ºé”™è¯¯ç ã€‚<br><br>arg1 ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å®šæœ¬è¯·æ±‚å®šå‘åˆ°å†…æ ¸çš„å“ªä¸ªå­ç³»ç»Ÿã€‚ç¬¬äºŒä¸ªåŠå…¶åå…ƒç´ ä¾æ¬¡ç»†åŒ–æŒ‡å®šè¯¥ç³»ç»Ÿçš„æŸä¸ªéƒ¨åˆ†ã€‚<br><br>arg2 æ•°ç»„ä¸­çš„å…ƒç´ æ•°ç›®<br><br>arg3 ä¸€ä¸ªç»“æ„ä½“ï¼ŒæŒ‡å‘ä¸€ä¸ªä¾›å†…æ ¸å­˜æ”¾è¯¥å€¼çš„ç¼“å†²åŒºï¼Œå­˜æ”¾è¿›ç¨‹æŸ¥è¯¢ç»“æœ<br><br>arg4 ç¼“å†²åŒºçš„å¤§å°<br><br>arg5/arg6 ä¸ºäº†è®¾ç½®æŸä¸ªæ–°å€¼ï¼Œarg5å‚æ•°æŒ‡å‘ä¸€ä¸ªå¤§å°ä¸ºarg6å‚æ•°å€¼çš„ç¼“å†²åŒºã€‚å¦‚æœä¸å‡†å¤‡æŒ‡å®šä¸€ä¸ªæ–°å€¼ï¼Œé‚£ä¹ˆarg5åº”ä¸ºä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œarg6å› ä¸º<span class="hljs-number">0.</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sysctl</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *, u_int, <span class="hljs-keyword">void</span> *, <span class="hljs-keyword">size_t</span> *, <span class="hljs-keyword">void</span> *, <span class="hljs-keyword">size_t</span>)</span></span>;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs objective-c"><br>#import &lt;sys/sysctl.h&gt;<br><br>#import &lt;sys/types.h&gt;<br><br>#import &lt;unistd.h&gt;<br><br>static bool is_debugger_present(void) &#123;<br><br>    int name[4];//å­˜æ”¾å­—èŠ‚ç ï¼ŒæŸ¥è¯¢ä¿¡æ¯<br><br>    struct kinfo_proc info;//æ¥å—è¿›ç¨‹æŸ¥è¯¢ç»“æœä¿¡æ¯çš„ç»“æ„ä½“<br><br>    size_t info_size = sizeof(info);//ç»“æ„ä½“çš„å¤§å°<br><br>    info.kp_proc.p_flag = 0;<br><br>    name[0] = CTL_KERN;//å†…æ ¸æŸ¥çœ‹<br><br>    name[1] = KERN_PROC;//è¿›ç¨‹æŸ¥çœ‹<br><br>    name[2] = KERN_PROC_PID;//è¿›ç¨‹ID<br><br>    name[3] = getpid();//è·å–pid<br><br>    int proc_err = sysctl(name, 4, &amp;info, &amp;info_size, NULL, 0);<br><br>    if (proc_err == -1) &#123; //åˆ¤æ–­æ˜¯å¦å‡ºç°äº†å¼‚å¸¸<br><br>        exit(-1);<br><br>    &#125;<br><br>    //info.kp_proc.p_flagä¸­å­˜æ”¾çš„æ˜¯æ ‡å¿—ä½ï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼Œåœ¨proc.hæ–‡ä»¶ä¸­æœ‰p_flagçš„å®å®šä¹‰ï¼Œé€šè¿‡&amp;è¿ç®—å¯çŸ¥å¯¹åº”æ ‡å¿—ä½çš„å€¼æ˜¯å¦ä¸º0ã€‚ï¼ˆè‹¥ç»“æœå€¼ä¸º0åˆ™å¯¹åº”æ ‡å¿—ä½ä¸º0ï¼‰ã€‚å…¶ä¸­P_TRACEDä¸ºæ­£åœ¨è·Ÿè¸ªè°ƒè¯•è¿‡ç¨‹ã€‚<br><br>    return ((info.kp_proc.p_flag &amp; P_TRACED) != 0);<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="syscallåè°ƒ"><a href="#syscallåè°ƒ" class="headerlink" title="syscallåè°ƒ"></a>syscallåè°ƒ</h2><p>ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°:</p><p>å…¶ä¸­PT_DENT_ATTACHçš„å€¼ä¸º31ï¼Œç›´æ¥å¡«31å³å¯ã€‚SYS_ptraceçš„å€¼ä¸º26ï¼Œå¯ä»¥å¼•å…¥&lt;sys/syscall.h&gt;å¤´æ–‡ä»¶åç›´æ¥è°ƒç”¨å®å®šä¹‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">#import &lt;sys/syscall.h&gt;<br><br>syscall(SYS_ptrace,PT_DENT_ATTACH,0,0,0);<br></code></pre></td></tr></table></figure><p>ä¸ºä»å®ç°ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°syscallï¼Œä¸Šé¢è®²åˆ°çš„ptraceä¹Ÿæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨å»å®ç°çš„ã€‚è€Œptraceçš„ç¼–å·ä¸º26ï¼Œä¹Ÿå°±æ˜¯SYS_ptraceçš„å€¼:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">26</span>. ptrace               <span class="hljs-number">801</span>e<span class="hljs-number">812</span>c T<br></code></pre></td></tr></table></figure><p>å…¶ä»–å‡½æ•°ç¼–å·å¯ä»¥åœ¨è¿™é‡ŒKernel SyscallsæŸ¥é˜…</p><p>ä½†æ˜¯syscallåœ¨iOS10ä¹‹ååºŸå¼ƒäº†ã€‚ä»£æ›¿å®ƒçš„å‡½æ•°åœ¨</p><p>&lt;sys/kdebug_signpost.h&gt;é‡Œï¼Œå«kdebug_signpost()</p><h2 id="SIGSTOP-å½“æ£€æµ‹åˆ°æœ‰æ–­ç‚¹è§¦å‘æ—¶åœæ­¢è°ƒè¯•"><a href="#SIGSTOP-å½“æ£€æµ‹åˆ°æœ‰æ–­ç‚¹è§¦å‘æ—¶åœæ­¢è°ƒè¯•" class="headerlink" title="SIGSTOP(å½“æ£€æµ‹åˆ°æœ‰æ–­ç‚¹è§¦å‘æ—¶åœæ­¢è°ƒè¯•))"></a>SIGSTOP(å½“æ£€æµ‹åˆ°æœ‰æ–­ç‚¹è§¦å‘æ—¶åœæ­¢è°ƒè¯•))</h2><p>é€šè¿‡æ•è·ç³»ç»ŸSIGSTOPä¿¡å·æ¥åˆ¤æ–­ã€‚</p><p>å¦‚æœç¨‹åºæ²¡æœ‰æ–­ç‚¹ã€‚é‚£è¿™ä¸ªæ˜¯æ²¡æœ‰ç”¨çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">dispatch_source_t source = dispatch_source_create(DISPATCH_SOURCE_TYPE_SIGNAL, SIGSTOP, 0, dispatch_get_main_queue());<br><br>    dispatch_source_set_event_handler(source, ^&#123;<br><br>        exit(0);<br><br>    &#125;);<br><br>    dispatch_resume(source);<br>isatty<br><br>isattyæ–¹æ³•ä¹Ÿå¯ä»¥ç”¨æ¥æ£€æµ‹æ˜¯å¦æ­£åœ¨è¢«è°ƒè¯•<br><br>#import &lt;unistd.h&gt;<br><br>if (isatty(1)) &#123;<br><br>   exit(0);   <br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="isatty"><a href="#isatty" class="headerlink" title="isatty"></a>isatty</h2><p>isattyæ–¹æ³•ä¹Ÿå¯ä»¥ç”¨æ¥æ£€æµ‹æ˜¯å¦æ­£åœ¨è¢«è°ƒè¯•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#import &lt;unistd.h&gt;</span><br><span class="hljs-keyword">if</span> (isatty(<span class="hljs-number">1</span>)) &#123;<br>   <span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);   <br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="ioctl"><a href="#ioctl" class="headerlink" title="ioctl"></a>ioctl</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">#import &lt;sys/ioctl.h&gt;<br>void Anti_ioctl() &#123;<br>    if (!ioctl(1, TIOCGWINSZ)) &#123;<br>        exit(1);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œä¸Šè¿°è¿™äº›æ–¹å¼åªèƒ½ç®€å•åœ°é˜²æ­¢ App è¢«åŠ¨æ€è°ƒè¯•ï¼Œå…¶å® ptraceã€sysctlã€syscall ç­‰å‡½æ•°æœ¬èº«ä¹Ÿå¯ä»¥è¢«é™æ€ä¿®æ”¹æˆ– Hookã€‚è€Œä¸”å³ä¾¿èƒ½æœ‰æ•ˆé˜»æ­¢äº†è°ƒè¯•ï¼ŒApp ä»ç„¶å¯ä»¥é€šè¿‡ tweak å» Hook App å†…éƒ¨çš„æ–¹æ³•å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ dylib æ³¨å…¥å»ä¿®æ”¹ App çš„åŠŸèƒ½</p><p>æˆ‘ä»¬åªå¥½ä»å¤šæ–¹é¢è€ƒè™‘ï¼Œå°½å¯èƒ½æé«˜å®‰å…¨æ€§ï¼Œæ¯”å¦‚é˜²æ­¢ tweak ä¾é™„ã€é˜²æ­¢ç½‘ç»œè¯·æ±‚æŠ“åŒ…ã€å¯¹æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ è§£å¯†ã€ä»£ç æ··æ·†ã€æ£€æŸ¥äºŒè¿›åˆ¶ binary ç­¾åæ˜¯å¦åŒ¹é…ï¼›å…³é”®é€»è¾‘ç”¨æ›´åº•å±‚çš„ C å‡½æ•°å®ç°ï¼ˆè™½ç„¶ C å‡½æ•°ä¹Ÿæ˜¯å¯ä»¥è¢« Hookï¼Œä¾‹å¦‚ Facebook å¼€æºçš„ fishhookï¼‰ï¼Œç­‰ç­‰ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ£€æŸ¥æ‰‹æœºæ˜¯å¦å·²ç»è¶Šç‹±ï¼Œå¹¶å¯¹è¶Šç‹±æœºåšç‰¹æ®Šå¤„ç†ã€‚</p><h2 id="å†…è”-svc-ptrace-å®ç°å’Œå†…è”-svc-syscall-ptrace-å®ç°"><a href="#å†…è”-svc-ptrace-å®ç°å’Œå†…è”-svc-syscall-ptrace-å®ç°" class="headerlink" title="å†…è” svc + ptrace å®ç°å’Œå†…è” svc + syscall + ptrace å®ç°"></a>å†…è” svc + ptrace å®ç°å’Œå†…è” svc + syscall + ptrace å®ç°</h2><p> å…¶å®è¿™ä¸¤ç§æ–¹æ³•éƒ½ç­‰åŒäºç›´æ¥æˆ–é—´æ¥ä½¿ç”¨ ptrace, æ­¤æ—¶ç³»ç»Ÿè°ƒç”¨å·æ˜¯ SYS_ptrace</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs objective-c"> static __attribute__((always_inline)) void AntiDebugASM() &#123;<br><br>#ifdef __arm__<br><br>    asm volatile(<br><br>                 &quot;mov r0,#31\n&quot;<br><br>                 &quot;mov r1,#0\n&quot;<br><br>                 &quot;mov r2,#0\n&quot;<br><br>                 &quot;mov r12,#26\n&quot;<br><br>                 &quot;svc #80\n&quot;<br><br>                 );<br><br>#endif<br><br>#ifdef __arm64__<br><br>    asm volatile(<br><br>                 &quot;mov x0,#26\n&quot;<br><br>                 &quot;mov x1,#31\n&quot;<br><br>                 &quot;mov x2,#0\n&quot;<br><br>                 &quot;mov x3,#0\n&quot;<br><br>                 &quot;mov x16,#0\n&quot;<br><br>                 &quot;svc #128\n&quot;<br><br>                 );<br><br>#endif<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å†…è”æ±‡ç¼–è°ƒç”¨exitå‡½æ•°"><a href="#å†…è”æ±‡ç¼–è°ƒç”¨exitå‡½æ•°" class="headerlink" title="å†…è”æ±‡ç¼–è°ƒç”¨exitå‡½æ•°"></a>å†…è”æ±‡ç¼–è°ƒç”¨exitå‡½æ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">static __attribute__((always_inline)) void OPENME() &#123;<br>    asm volatile(<br>                 &quot;mov x0,#0\n&quot;<br>                 &quot;mov x16,#1\n&quot;<br>                 &quot;svc #80\n&quot;<br>                 &quot;mov x1, #0\n&quot;<br>                 &quot;mov sp, x1\n&quot;<br>                 &quot;mov x29, x1\n&quot;<br>                 &quot;mov x30, x1\n&quot;<br>                 &quot;ret&quot;<br>    );<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹äºfishhookäº¤æ¢ç³»ç»Ÿå‡½æ•°çš„ç»•è¿‡æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†sysctlç­‰å‡½æ•°è°ƒç”¨æ”¾åˆ°åŠ¨æ€åº“ä¸­ï¼Œä»¥ä¿è¯æ£€æµ‹å‡½æ•°å¯ä»¥åœ¨è¿›æ”»æ³¨å…¥çš„ä»£ç ä¹‹å‰æ‰§è¡Œã€‚åŠ¨æ€åº“çš„åŠ è½½é¡ºåºä¸ºBuild Phasesä¸‹çš„Link Binary With Libaraiesä¸­çš„æ’åˆ—é¡ºåºã€‚</p><h2 id="svc-syscall-ptrace-ååè°ƒè¯•"><a href="#svc-syscall-ptrace-ååè°ƒè¯•" class="headerlink" title="svc + syscall + ptrace ååè°ƒè¯•"></a>svc + syscall + ptrace ååè°ƒè¯•</h2> <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/youshaoduo/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">83688732</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iOS</tag>
      
      <tag>åè°ƒè¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSä¹‹cycript</title>
    <link href="/2021/08/22/iOS-cycript/"/>
    <url>/2021/08/22/iOS-cycript/</url>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Cycriptæ˜¯ç”±Cydiaåˆ›å§‹äººSaurikæ¨å‡ºçš„ä¸€æ¬¾è„šæœ¬è¯­è¨€ï¼ŒCycriptæ··åˆäº†OCã€JavaScriptè¯­æ³•çš„è§£é‡Šå™¨ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªå‘½ä»¤ä¸­ä½¿ç”¨Ocæˆ–è€…JavaScriptï¼Œç”šè‡³ä¸¤è€…å¹¶ç”¨ã€‚å®ƒèƒ½å¤ŸæŒ‚é’©æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶ä¿®æ”¹å¾ˆå¤šä¸œè¥¿ã€‚</p><p><a href="http://www.cycript.org/manual/#97846f1e-fda4-43bc-8432-45bb1115c433">å®˜æ–¹å‚è€ƒæ‰‹å†Œ</a></p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>1.è¶Šç‹±æ‰‹æœºå®‰è£…Cycriptæ’ä»¶ï¼Œsshç™»å½•åˆ°æ‰‹æœºä¸­</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">cycript -<span class="hljs-selector-tag">p</span> pid<br></code></pre></td></tr></table></figure><p>2.ä½¿ç”¨MonkeyDevæ–°å»ºMonkeyAppå·¥ç¨‹ï¼Œè¿è¡Œéœ€è¦åŠ¨æ€è°ƒè¯•çš„App,Monkeyé»˜è®¤å¼€å¯äº†CycriptæœåŠ¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">CHConstructor&#123;<br>    NSLog(INSERT_SUCCESS_WELCOME);<br>    <br>    [[NSNotificationCenter defaultCenter] addObserverForName:UIApplicationDidFinishLaunchingNotification object:nil queue:[NSOperationQueue mainQueue] usingBlock:^(NSNotification * _Nonnull note) &#123;<br>        <br>#ifndef __OPTIMIZE__<br>        CYListenServer(6666);<br><br>        MDCycriptManager* manager = [MDCycriptManager sharedInstance];<br>        [manager loadCycript:NO];<br><br>        NSError* error;<br>        NSString* result = [manager evaluateCycript:@&quot;UIApp&quot; error:&amp;error];<br>        NSLog(@&quot;result: %@&quot;, result);<br>        if(error.code != 0)&#123;<br>            NSLog(@&quot;error: %@&quot;, error.localizedDescription);<br>        &#125;<br>#endif<br>        <br>    &#125;];<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦Cycripté“¾æ¥åˆ°ç›®æ ‡åº”ç”¨ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cycript</span> -r IP:<span class="hljs-number">6666</span><br></code></pre></td></tr></table></figure><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><ul><li>UIApp</li><li>NSHomeDirectory()</li><li>[[NSBundle mainBundle] bundleIdentifier]</li><li>UIApp.delegate</li><li>UIApp.keyWindow</li><li>UIApp.keyWindow.recursiveDescription().toString()</li><li>UIApp.keyWindow.rootViewController </li><li>#address :è·å–è¯¥å¯¹è±¡</li><li>*#address:æ‰“å°è¯¥å¯¹è±¡æˆå‘˜å˜é‡</li><li>?exit</li></ul><h3 id="å¼¹çª—"><a href="#å¼¹çª—" class="headerlink" title="å¼¹çª—"></a>å¼¹çª—</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">alert = [[<span class="hljs-built_in">UIAlertView</span> alloc]initWithTitle:<span class="hljs-string">&quot;@@&quot;</span> message:<span class="hljs-string">&quot;hahaha&quot;</span> delegate:<span class="hljs-literal">nil</span> cancelButtonTitle:<span class="hljs-string">&quot;OK&quot;</span> otherButtonTitles:<span class="hljs-literal">nil</span>]<br></code></pre></td></tr></table></figure><p>è°ƒç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">[alert <span class="hljs-keyword">show</span>]<br>[#<span class="hljs-number">0x1046bcbc0</span> <span class="hljs-keyword">show</span>]<br>alert.<span class="hljs-keyword">show</span>()<br></code></pre></td></tr></table></figure><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><ol><li><p>å°†æ‰‹æœºè¯­è¨€è®¾ç½®æœªè‹±æ–‡ï¼ˆæ–¹ä¾¿å®šä½ï¼‰ï¼Œè¿›å…¥è®¾ç½®-å…³äº</p></li><li><p>æ‰“å°å½“å‰é¡µé¢çš„æ‰€æœ‰ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">UIApp.keyWindow.recursiveDescription().toString()<br><br><span class="hljs-comment">//åªæ˜¾ç¤ºä¸€éƒ¨åˆ†</span><br> &lt;PSTableCell: <span class="hljs-number">0x10392e000</span>; baseClass = UITableViewCell; frame = (<span class="hljs-number">0</span> <span class="hljs-number">290</span>; <span class="hljs-number">375</span> <span class="hljs-number">44</span>); text = <span class="hljs-string">&#x27;Network&#x27;</span>; autoresize = W; tag = <span class="hljs-number">4</span>; layer = &lt;CALayer: <span class="hljs-number">0x2811e46a0</span>&gt;&gt;\n<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹è§Networkçš„PSTableCellä»¥åŠå¯¹è±¡åœ°å€</p></li><li><p>éšè—/æ˜¾ç¤º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//éšè—</span><br>[#<span class="hljs-number">0x10392e000</span> setHidden:YES]<br><span class="hljs-comment">//æ˜¾ç¤º</span><br>[#<span class="hljs-number">0x10392e000</span> setHidden:NO]<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡nextResponderæ‰¾åˆ°cellå¯¹åº”çš„controller</p><p>é€šè¿‡ä¸‰æ¬¡nextResponderæœ€ç»ˆæ‰¾åˆ°äº†controller-&gt;PSGAboutController</p> <img src="/2021/08/22/iOS-cycript/images/%E4%BF%AE%E6%94%B9controller.png" class=""></li><li><p>ä¿®æ”¹controllerçš„æ ‡é¢˜</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">[#<span class="hljs-number">0x104137400</span> setTitle:<span class="hljs-string">&quot;Cola&quot;</span>]<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iOS</tag>
      
      <tag>hook</tag>
      
      <tag>cycript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSä¹‹Tweak</title>
    <link href="/2021/08/22/iOS-Tweak/"/>
    <url>/2021/08/22/iOS-Tweak/</url>
    
    <content type="html"><![CDATA[<h2 id="ç¼–å†™HOOKæ’ä»¶"><a href="#ç¼–å†™HOOKæ’ä»¶" class="headerlink" title="ç¼–å†™HOOKæ’ä»¶"></a>ç¼–å†™HOOKæ’ä»¶</h2><h3 id="åˆ›å»ºå·¥ç¨‹"><a href="#åˆ›å»ºå·¥ç¨‹" class="headerlink" title="åˆ›å»ºå·¥ç¨‹"></a>åˆ›å»ºå·¥ç¨‹</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">1</span>. ç»ˆç«¯è¾“å…¥<span class="hljs-selector-tag">nic</span><span class="hljs-selector-class">.pl</span><br><span class="hljs-selector-tag">2</span>. <span class="hljs-selector-tag">Choose</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">Template</span> (required): <span class="hljs-selector-tag">10</span><br><span class="hljs-selector-tag">3</span>. <span class="hljs-selector-tag">Project</span> <span class="hljs-selector-tag">Name</span> (required): å·¥ç¨‹å<br><span class="hljs-selector-tag">4</span>. <span class="hljs-selector-tag">Package</span> <span class="hljs-selector-tag">Name</span> <span class="hljs-selector-attr">[com.yourcompany.tututest]</span>:  åŒ…å:<span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.xxx</span><span class="hljs-selector-class">.xxx</span><br><span class="hljs-selector-tag">5</span>. <span class="hljs-selector-tag">Author</span>/<span class="hljs-selector-tag">Maintainer</span> <span class="hljs-selector-tag">Name</span> <span class="hljs-selector-attr">[lk]</span>: ä½œè€…<br><span class="hljs-selector-tag">6</span>. <span class="hljs-selector-attr">[iphone/tweak]</span> <span class="hljs-selector-tag">MobileSubstrate</span> <span class="hljs-selector-tag">Bundle</span> <span class="hljs-selector-tag">filter</span> <span class="hljs-selector-attr">[com.apple.springboard]</span>: è¦<span class="hljs-selector-tag">Hook</span>çš„åŒ…å<br><span class="hljs-selector-tag">7</span>. <span class="hljs-selector-attr">[iphone/tweak]</span> <span class="hljs-selector-tag">List</span> <span class="hljs-selector-tag">of</span> <span class="hljs-selector-tag">applications</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">terminate</span> <span class="hljs-selector-tag">upon</span> <span class="hljs-selector-tag">installation</span> (space-separated, <span class="hljs-string">&#x27;-&#x27;</span> for none) <span class="hljs-selector-attr">[SpringBoard]</span>: å›è½¦é»˜è®¤<br><br></code></pre></td></tr></table></figure><h3 id="å·¥ç¨‹æ–‡ä»¶ç®€ä»‹"><a href="#å·¥ç¨‹æ–‡ä»¶ç®€ä»‹" class="headerlink" title="å·¥ç¨‹æ–‡ä»¶ç®€ä»‹"></a>å·¥ç¨‹æ–‡ä»¶ç®€ä»‹</h3><p>åˆ›å»ºå¥½çš„å·¥ç¨‹ä¸‹å…±æœ‰4ä¸ªæ–‡ä»¶</p> <img src="/2021/08/22/iOS-Tweak/images/tweakproject.png" class=""><ul><li><p>Makefile   ç¼–è¯‘æ–‡ä»¶</p></li><li><p>Tweak.x    ç¼–å†™HOOKæ–‡ä»¶</p></li><li><p>control     æ’ä»¶ä½œè€…ã€ç‰ˆæœ¬ä¿¡æ¯</p></li><li><p>demo001.plist  è®¾ç½®è¦HOOKçš„Bundle ID</p></li></ul><h4 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h4><p>æŒ‡å®šå·¥ç¨‹ç”¨åˆ°çš„æ–‡ä»¶,æ¡†æ¶,åº“ç­‰ä¿¡æ¯,å°†æ•´ä¸ªè¿‡ç¨‹è‡ªåŠ¨åŒ–</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs makefile">INSTALL_TARGET_PROCESSES = SpringBoard<br><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(THEOS)</span>/makefiles/common.mk<br><br>TWEAK_NAME = demo001<br><br>demo001_FILES = Tweak.x<br>demo001_CFLAGS = -fobjc-arc<br><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(THEOS_MAKE_PATH)</span>/tweak.mk<br></code></pre></td></tr></table></figure><ol><li>INSTALL_TARGET_PROCESSES = SpringBoard ç›®æ ‡å®‰è£…çš„é¡¹ç›®</li><li>include $(THEOS)/makefiles/common.mk å›ºå®šå†™æ³• </li><li>TWEAK_NAME = demo001 tweakçš„åç§°</li><li>demo001_FILES = Tweak.x tweakæºæ–‡ä»¶,å¤šä¸ªæ–‡ä»¶ä»¥ç©ºæ ¼åˆ†éš”</li><li>include $(THEOS_MAKE_PATH)/tweak.mk é€šè¿‡includeå‘½ä»¤æŒ‡å®šä¸åŒçš„.mkæ–‡ä»¶</li></ol><p>é™¤äº†ä¸Šé¢çš„ä¿¡æ¯æ ¼å¼,æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä»¥ä¸‹ä¿¡æ¯</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs makefile">æˆ‘ä»¬å¦‚ä½•é€šè¿‡è¿›è¡ŒæŒ‡å®šSDK?<br>TARGET = iPhone:latest:8.0 <br><br>æˆ‘ä»¬å¦‚ä½•å¯¼å…¥framework?<br>demo001_FRAMWORKS = UIKit  <br><br>æˆ‘ä»¬å¦‚ä½•æŒ‡å®šå¤„ç†å™¨æ¶æ„<br>ARCHS = armv7 arm64  <br><br>æˆ‘ä¹ˆå¦‚ä½•é“¾æ¥Mach-Oå¯¹è±¡<br>demo001_LDFLAGS = -lx<br>æ³¨æ„<br>-lx ä»£è¡¨é“¾æ¥libx.aæˆ–libx.dylib,å³ç»™xåŠ ä¸Šlibçš„å‰ç¼€,ä»¥åŠ.aæˆ–.dylibçš„åç¼€,å¯ä»¥æ ¹æ®è‡ªå·±çš„é¡¹ç›®è¿›è¡Œè°ƒæ•´<br><br></code></pre></td></tr></table></figure><h4 id="Tweak-x"><a href="#Tweak-x" class="headerlink" title="Tweak.x"></a>Tweak.x</h4><p>xm ä¸­çš„xä»£è¡¨è¿™ä¸ªæ–‡ä»¶æ”¯æŒLogosè¯­æ³•</p><p>x å¦‚æœåç¼€åæ˜¯å•ç‹¬çš„x,è¯´æ˜æºæ–‡ä»¶æ”¯æŒLogoså’ŒCè¯­æ³•;</p><p>xm å¦‚æœåç¼€åæ˜¯xm,è¯´æ˜æºæ–‡ä»¶æ”¯æŒLogoså’ŒC/C++è¯­æ³•.</p><p>.xi å°†é¦–å…ˆä½œä¸ºobjective-cè¿›è¡Œé¢„å¤„ç†ï¼Œç„¶åLogoså°†å¤„ç†ç»“æœï¼Œç„¶åå°†è¿›è¡Œç¼–è¯‘ã€‚</p><p>.xmi å°†é¦–å…ˆä½œä¸ºobjective-c ++è¿›è¡Œé¢„å¤„ç†ï¼Œç„¶åLogoså°†å¤„ç†ç»“æœï¼Œç„¶åå°†è¿›è¡Œç¼–è¯‘ã€‚</p><h4 id="demo001-plist"><a href="#demo001-plist" class="headerlink" title="demo001.plist"></a>demo001.plist</h4><p>ç”¨äºæŒ‡å®šéœ€è¦æ³¨å…¥çš„ç›®æ ‡æ–‡ä»¶çš„Bundle ID</p><h4 id="control"><a href="#control" class="headerlink" title="control"></a>control</h4><p>æŒ‡å®šdebåŒ…çš„ä¸€äº›ä¿¡æ¯,åŒ…æ‹¬åå­—,æè¿°,ç‰ˆæœ¬å·ç­‰</p><h3 id="ç¼–å†™HOOKä»£ç "><a href="#ç¼–å†™HOOKä»£ç " class="headerlink" title="ç¼–å†™HOOKä»£ç "></a>ç¼–å†™HOOKä»£ç </h3><p>ç¼–è¾‘tweak.x</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-comment">//hook ViewControllerçš„testæ–¹æ³•</span><br><span class="hljs-tag"></span><br><span class="hljs-tag">%<span class="hljs-selector-tag">hook</span></span> ViewController<br><br>-<span class="ruby"> (void)test&#123;</span><br><span class="ruby"></span><br>    NSLog(@&quot;ğŸºğŸºğŸºHOOKğŸºğŸºğŸº&quot;);<br>&#125;<br><span class="hljs-tag"></span><br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span><br></code></pre></td></tr></table></figure><p>è®¾ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> THEOS_DEVICE_IP = localhost<br><span class="hljs-builtin-name">export</span> THEOS_DEVICE_PORT = 2222<br></code></pre></td></tr></table></figure><h3 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h3><p>ä½¿ç”¨iproxyè½¬å‘æ‰‹æœº22ç«¯å£åˆ°æœ¬åœ°2222</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">iproxy</span> <span class="hljs-number">2222</span> <span class="hljs-number">22</span><br></code></pre></td></tr></table></figure><p>ç»ˆç«¯è¾“å…¥ makeï¼›make package install</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-built_in">make</span><br><span class="hljs-built_in">make</span> <span class="hljs-keyword">package</span> install<br></code></pre></td></tr></table></figure><h2 id="Logosè¯­æ³•"><a href="#Logosè¯­æ³•" class="headerlink" title="Logosè¯­æ³•"></a>Logosè¯­æ³•</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//i</span>phonedevwiki.net<span class="hljs-regexp">/index.php/</span>Logos<br></code></pre></td></tr></table></figure><table><thead><tr><th>Logosè¯­æ³•</th><th>åŠŸèƒ½è§£é‡Š</th><th>äº‹ä¾‹</th></tr></thead><tbody><tr><td>%hook</td><td>éœ€è¦hookå“ªä¸ªç±»</td><td>%hook Classname</td></tr><tr><td>%end</td><td>ä»£ç å—ç»“æŸæ ‡è®°</td><td>%end</td></tr><tr><td>%group</td><td>åˆ†ç»„</td><td>%group Groupname</td></tr><tr><td>%new</td><td>æ·»åŠ æ–°æ–¹æ³•</td><td>%new(signature)</td></tr><tr><td>%ctor</td><td>æ„é€ å‡½æ•°</td><td>%ctor { â€¦ }</td></tr><tr><td>%dtor</td><td>ææ„å‡½æ•°</td><td>%dtor { â€¦ }</td></tr><tr><td>%log</td><td>è¾“å‡ºæ‰“å°</td><td>%log; %log([(), â€¦]);</td></tr><tr><td>%orig</td><td>ä¿æŒåŸæœ‰æ–¹æ³•</td><td>%origï¼›%orig(arg1, â€¦)ï¼›</td></tr><tr><td>%c</td><td>åŠ¨æ€è·å–ç±»</td><td>%c([+/-]Class)ï¼›</td></tr></tbody></table><h3 id="1-hook-end"><a href="#1-hook-end" class="headerlink" title="1. %hook %end"></a>1. %hook %end</h3><p>æŒ‡å®šéœ€è¦hookçš„class,å¿…é¡»ä»¥ï¼…endç»“å°¾ã€‚</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-comment">// hook SpringBoardç±»é‡Œé¢çš„_menuButtonDownå‡½æ•°,å…ˆæ‰“å°ä¸€å¥è¯,å†ä¹‹å­é‚£ä¸ªå‡½æ•°åŸå§‹çš„æ“ä½œ</span><br><span class="hljs-tag">%<span class="hljs-selector-tag">hook</span></span> SpringBorad<br>-<span class="ruby"> (void)<span class="hljs-symbol">_menuButtonDown:</span>(id)down</span><br><span class="ruby"></span>&#123;<br>    NSLog(@&quot;111111&quot;);<br><span class="hljs-tag">   %<span class="hljs-selector-tag">orig</span></span>; // è°ƒç”¨åŸå§‹çš„_menuButtonDownå‡½æ•°<br>&#125;<br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span><br></code></pre></td></tr></table></figure><h3 id="2-group"><a href="#2-group" class="headerlink" title="2.%group"></a>2.%group</h3><p>è¯¥æŒ‡ä»¤ç”¨äºå°†%hookåˆ†ç»„ï¼Œä¾¿äºä»£ç ç®¡ç†åŠæŒ‰æ¡ä»¶åˆå§‹åŒ–åˆ†ç»„ï¼Œå¿…é¡»ä»¥%endç»“å°¾ã€‚ </p><p>ä¸€ä¸ªï¼…groupå¯ä»¥åŒ…å«å¤šä¸ª%hook,æ‰€æœ‰ä¸å±äºæŸä¸ªè‡ªå®šä¹‰groupçš„ï¼…hookä¼šè¢«éšå¼å½’ç±»åˆ°ï¼…group_ungroupedä¸­ã€‚</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">group</span></span> iOS8<br><span class="hljs-tag">%<span class="hljs-selector-tag">hook</span></span> IOS8_SPECIFIC_CLASS<br><span class="hljs-comment">    // your code here</span><br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span> // end hook<br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span> // end group ios8<br><span class="hljs-tag"></span><br><span class="hljs-tag">%<span class="hljs-selector-tag">group</span></span> iOS9<br><span class="hljs-tag">%<span class="hljs-selector-tag">hook</span></span> IOS9_SPECIFIC_CLASS<br><span class="hljs-comment">    // your code here</span><br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span> // end hook<br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span> // end group ios9<br><span class="hljs-tag"></span><br><span class="hljs-tag">%<span class="hljs-selector-tag">ctor</span></span> &#123;<br>    if (kCFCoreFoundationVersionNumber &gt; 1200) &#123;<br><span class="hljs-tag">        %<span class="hljs-selector-tag">init</span>(iOS9)</span>;<br>    &#125; else &#123;<br><span class="hljs-tag">        %<span class="hljs-selector-tag">init</span>(iOS8)</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-new"><a href="#3-new" class="headerlink" title="3.%new"></a>3.%new</h3><p>åœ¨%hookå†…éƒ¨ä½¿ç”¨ï¼Œç»™ä¸€ä¸ªç°æœ‰classæ·»åŠ æ–°å‡½æ•°ï¼ŒåŠŸèƒ½ä¸class_addMethodç›¸åŒ. </p><p>æ³¨ï¼š<br>Objective-Cçš„categoryä¸class_addMethodçš„åŒºåˆ«ï¼š </p><p>å‰è€…æ˜¯é™æ€çš„è€Œåè€…æ˜¯åŠ¨æ€çš„ã€‚ä½¿ç”¨%newæ·»åŠ ,è€Œä¸éœ€è¦å‘.hæ–‡ä»¶ä¸­æ·»åŠ å‡½æ•°å£°æ˜,å¦‚æœä½¿ç”¨category,å¯èƒ½ä¸é‡åˆ°è¿™æ ·é‚£æ ·çš„é”™è¯¯.</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">hook</span></span> SpringBoard<br><span class="hljs-tag">%<span class="hljs-selector-tag">new</span></span><br>-<span class="ruby"> (void)addNewMethod</span><br><span class="ruby"></span>&#123;<br>    NSLog(@&quot;åŠ¨æ€æ·»åŠ ä¸€ä¸ªæ–¹æ³•åˆ°SpringBoard&quot;);<br>&#125;<br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span><br></code></pre></td></tr></table></figure><h3 id="4-ctor"><a href="#4-ctor" class="headerlink" title="4.%ctor"></a>4.%ctor</h3><p>tweakçš„constructor,å®Œæˆåˆå§‹åŒ–å·¥ä½œï¼›å¦‚æœä¸æ˜¾ç¤ºå®šä¹‰ï¼ŒTheosä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª%ctor,å¹¶åœ¨å…¶ä¸­è°ƒç”¨%init(_ungrouped)ã€‚</p><p>%ctorä¸€èˆ¬å¯ä»¥ç”¨æ¥åˆå§‹åŒ–%group,ä»¥åŠè¿›è¡ŒMSHookFunctionç­‰æ“ä½œ,å¦‚ä¸‹:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta">#ifndef KCFCoreFoundationVersionNumber_iOS_8_0</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KCFCoreFoundationVersionNumber_iOS_8_0      1140.10</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>%ctor<br>&#123;<br>    %<span class="hljs-keyword">init</span>;<br><br>    <span class="hljs-keyword">if</span> (KCFCoreFoundationVersionNumber &gt;= KCFCoreFoundationVersionNumber_iOS_7_0 &amp;&amp; KCFCoreFoundationVersionNumber &gt; KCFCoreFoundationVersionNumber_iOS_8_0)<br>    %<span class="hljs-keyword">init</span>(iOS7Hook);<br> <span class="hljs-keyword">if</span> (KCFCoreFoundationVersionNumber &gt;= KCFCoreFoundationVersionNumber_iOS_8_0)<br>    %<span class="hljs-keyword">init</span>(iOS8Hook);<br>MSHookFunction((<span class="hljs-keyword">void</span> *)&amp;AudioServicesPlaySystemSound,(<span class="hljs-keyword">void</span> *)&amp;replaced_AudioServerPlaySystemSound,(<span class="hljs-keyword">void</span> **)&amp;orginal_AudioServicesPlaySystemSound);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-dtor"><a href="#5-dtor" class="headerlink" title="5.%dtor"></a>5.%dtor</h3><p>Generate an anonymous deconstructor (of default priority).</p><h3 id="6-log"><a href="#6-log" class="headerlink" title="6.%log"></a>6.%log</h3><p>è¯¥æŒ‡ä»¤åœ¨%hookå†…éƒ¨ä½¿ç”¨ï¼Œå°†å‡½æ•°çš„ç±»åã€å‚æ•°ç­‰ä¿¡æ¯å†™å…¥syslog,å¯ä»¥ï¼…log([(),â€¦..])çš„æ ¼å¼è¿½åŠ å…¶ä»–æ‰“å°ä¿¡æ¯ã€‚</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">hook</span></span> SpringBorad<br>-<span class="ruby"> (void)<span class="hljs-symbol">_menuButtonDown:</span>(id)down</span><br><span class="ruby"></span>&#123;<br><span class="hljs-tag">    %<span class="hljs-selector-tag">log</span>((NSString *)</span>@&quot;iosre&quot;,(NSString *)@&quot;Debug&quot;);<br><span class="hljs-tag">    %<span class="hljs-selector-tag">orig</span></span>; // è°ƒç”¨åŸå§‹çš„_menuButtonDownæ–¹æ³•<br>&#125;<br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span><br></code></pre></td></tr></table></figure><h3 id="7-orig"><a href="#7-orig" class="headerlink" title="7.%orig"></a>7.%orig</h3><p>è¯¥æŒ‡ä»¤åœ¨%hookå†…éƒ¨ä½¿ç”¨ï¼Œæ‰§è¡Œè¢«hookçš„å‡½æ•°çš„åŸå§‹ä»£ç ï¼›ä¹Ÿå¯ä»¥ç”¨ï¼…origæ›´æ”¹åŸå§‹å‡½æ•°çš„å‚æ•°ã€‚</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">hook</span></span> SpringBorad<br>-<span class="ruby"> (void)<span class="hljs-symbol">setCustomSubtitleText:</span>(id)arg1 <span class="hljs-symbol">withColor:</span>   (id)arg2</span><br><span class="ruby"></span>&#123;<br><span class="hljs-tag">    %<span class="hljs-selector-tag">orig</span>(@&quot;change arg2&quot;,arg2)</span>;// å°†arg2çš„å‚æ•°ä¿® æ”¹ä¸º&quot;change arg2&quot;<br>&#125;<br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span><br></code></pre></td></tr></table></figure><h3 id="8-init"><a href="#8-init" class="headerlink" title="8.%init"></a>8.%init</h3><p>è¯¥æŒ‡ä»¤ç”¨äºåˆå§‹åŒ–æŸä¸ªï¼…groupï¼Œå¿…é¡»åœ¨%hookæˆ–ï¼…ctorå†…è°ƒç”¨ï¼›å¦‚æœå¸¦å‚æ•°ï¼Œåˆ™åˆå§‹åŒ–æŒ‡å®šçš„groupï¼Œå¦‚æœä¸å¸¦å‚æ•°ï¼Œåˆ™åˆå§‹åŒ–_ungrouped. </p><p>æ³¨ï¼š åˆ‡è®°ï¼Œåªæœ‰è°ƒç”¨äº†ï¼…init,å¯¹åº”çš„%groupæ‰èƒ½èµ·ä½œç”¨ï¼</p><h3 id="9-c"><a href="#9-c" class="headerlink" title="9.%c"></a>9.%c</h3><p>è¯¥æŒ‡ä»¤çš„ä½œç”¨ç­‰åŒäºobjc_getClassæˆ–NSClassFromString,å³åŠ¨æ€è·å–ä¸€ä¸ªç±»çš„å®šä¹‰ï¼Œåœ¨%hookæˆ–ï¼…ctorå†…ä½¿ç”¨ ã€‚</p><p>è°ƒç”¨ViewControllerä¸­çš„Methodæ–¹æ³•</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">[[[%c(ViewController) alloc ] init]<span class="hljs-function"><span class="hljs-keyword">Method</span>];</span> <br></code></pre></td></tr></table></figure><h2 id="æ—¥å¿—æ‰“å°"><a href="#æ—¥å¿—æ‰“å°" class="headerlink" title="æ—¥å¿—æ‰“å°"></a>æ—¥å¿—æ‰“å°</h2><p>hook demoæ–¹æ³•å¹¶æ·»åŠ æ‰“å°å…¥å‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"> <br><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;ViewController.h&quot;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> ()</span><br> <span class="hljs-comment">//ç‚¹å‡»äº‹ä»¶</span><br>- (<span class="hljs-keyword">IBAction</span>)compute;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">ViewController</span></span><br><br>- (<span class="hljs-keyword">void</span>)viewDidLoad &#123;<br>    [<span class="hljs-keyword">super</span> viewDidLoad];<br>    <span class="hljs-comment">// Do any additional setup after loading the view.</span><br>    <br>&#125;<br> <br>- (<span class="hljs-keyword">IBAction</span>)compute &#123;<br>    <br>    [<span class="hljs-keyword">self</span> demo:<span class="hljs-string">@&quot;66&quot;</span>];<br>    <br>&#125;<br> <br>- (<span class="hljs-keyword">void</span>)demo:(<span class="hljs-built_in">NSString</span> *)str&#123;<br>   <span class="hljs-built_in">NSString</span> *res = [str stringByAppendingString:<span class="hljs-string">@&quot;ğŸ‚ğŸ‚ğŸ‚&quot;</span>];<br>    <span class="hljs-built_in">NSLog</span>(res);<br>  <br>    <br>&#125;<br><span class="hljs-keyword">@end</span><br><br></code></pre></td></tr></table></figure><p>logify.plç”Ÿæˆ.xmæ–‡ä»¶</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//æ ¹æ®class-dumpåçš„ViewController.hç”Ÿæˆ.xæ–‡ä»¶</span><br>logify.pl <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ViewController</span>.</span></span>h &gt;<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Tweak</span>.</span></span>x<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹‹å…³ç³»ç¨‹åºä¸­è‡ªå·±å†™çš„æ–¹æ³•</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-comment">//ç»è¿‡åˆ å‡è¿‡åçš„Tweak.xæ–‡ä»¶</span><br><span class="hljs-tag"></span><br><span class="hljs-tag">%<span class="hljs-selector-tag">hook</span></span> ViewController<br> <br>-<span class="ruby"> (void)<span class="hljs-symbol">demo:</span>(id)arg1 &#123; %log; %orig; &#125;</span><br><span class="ruby"></span><span class="hljs-tag"> </span><br><span class="hljs-tag">%<span class="hljs-selector-tag">end</span></span><br><br></code></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„Tweak.xæ–‡ä»¶æ›¿æ¢theosç”Ÿæˆçš„Tweak.xæ–‡ä»¶åç¼–è¯‘å®‰è£…å³å¯</p><p>æŸ¥çœ‹æ‰“å°æ—¥å¿—</p> <img src="/2021/08/22/iOS-Tweak/images/logify.png" class="">]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iOS</tag>
      
      <tag>hook</tag>
      
      <tag>tweak</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IOSæ–‡ä»¶ç»“æ„</title>
    <link href="/2021/08/22/IOS%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/"/>
    <url>/2021/08/22/IOS%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h2 id="æ–‡ä»¶ç»“æ„"><a href="#æ–‡ä»¶ç»“æ„" class="headerlink" title="æ–‡ä»¶ç»“æ„"></a>æ–‡ä»¶ç»“æ„</h2><p>ç›®å½•ç»“æ„</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs coq">/<br>|<br><span class="hljs-type">---Developer</span>/<br>|<br><span class="hljs-type">---Applications</span>/<br>|<br><span class="hljs-type">---Library</span>/<br>|<br><span class="hljs-type">---System</span>/<br>|<br><span class="hljs-type">---bin</span>/<br>|<br><span class="hljs-type">---sbin</span>/<br>|<br><span class="hljs-type">---boot</span>/<br>|<br><span class="hljs-type">---cores</span>/<br>|<br><span class="hljs-type">---dev</span>/<br>|<br><span class="hljs-type">---usr</span>/<br>|<br><span class="hljs-type">---lib</span>/<br>|<br><span class="hljs-type">---mnt</span>/<br>|<br><span class="hljs-type">---tmp</span> -&gt; private/var/tmp/<br>|<br><span class="hljs-type">---etc</span> -&gt; private/etc/<br>|<br><span class="hljs-type">---User</span> -&gt; /var/mobile/<br>|<br><span class="hljs-type">---var</span> -&gt; private/var/<br>|<br><span class="hljs-type">---private</span>/<br></code></pre></td></tr></table></figure><h2 id="æ ¹ç›®å½•"><a href="#æ ¹ç›®å½•" class="headerlink" title="æ ¹ç›®å½•"></a>æ ¹ç›®å½•</h2><h3 id="1-Developer"><a href="#1-Developer" class="headerlink" title="1. /Developer"></a>1. /Developer</h3><pre><code>å¼€å‘è€…ç›¸å…³åº“ã€å·¥å…·</code></pre><h3 id="2-Applications"><a href="#2-Applications" class="headerlink" title="2. /Applications"></a>2. /Applications</h3><pre><code>ç³»ç»ŸAPP</code></pre><h3 id="3-Library"><a href="#3-Library" class="headerlink" title="3. /Library"></a>3. /Library</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç”¨æˆ·ç¼“å­˜æ•°æ®<br></code></pre></td></tr></table></figure><p>è¶Šç‹±ç›¸å…³æ–‡ä»¶ä¼šå­˜æ”¾è¯¥ç›®å½•ä¸‹</p><p>3.1 /Library/dpkg <code>cydia dpkgç›®å½•</code></p><pre><code>å®‰è£…æ’ä»¶ä½¿ç”¨çš„æ–‡ä»¶è·¯å¾„ã€æ’ä»¶å¸è½½è„šæœ¬ã€æ’ä»¶ç­¾å/var/lib/dpkg/infoinfo|--- re.frida.server.list æ‰€ä½¿ç”¨çš„æ–‡ä»¶|--- re.frida.server.md5sums ç­¾å|--- re.frida.server.prerm å¸è½½è„šæœ¬</code></pre><p>3.2 /Library/LaunchDaemons  <code>è¶Šç‹±åæ·»åŠ åå°è¿è¡Œç¨‹åº,ä»¥plistæ–‡ä»¶å½¢å¼å­˜æ”¾</code></p><p>3.3 /Library/MobileSubstrate <code>è¶Šç‹±æ’ä»¶ç›¸å…³ç›®å½•</code></p><pre><code>/Library/MobileSubstrate/DynamicLibraries è¶Šç‹±æ’ä»¶å®‰è£…ç›®å½•,ç»“æ„å¦‚ä¸‹DynamicLibraries |---inject.plist|---inject.dylibplistæ–‡ä»¶ä¸­åŒ…å«è¦hookçš„appæˆ–ç»„ä»¶çš„ä¿¡æ¯ï¼Œcydiaè´Ÿè´£å°†å¯¹åº”çš„dylibåŠ è½½åˆ°hookçš„è¿›ç¨‹ä¸­</code></pre><p> 3.4 /Library/PreferenceBundles <code>è¶Šç‹±æ’ä»¶çš„ç•Œé¢ï¼Œå¦‚FlyJBä¼šåœ¨è®¾ç½®ä¸­æœ‰ä¸ªè®¾ç½®ç•Œé¢ï¼Œå¯¹åº”è¯¥ç›®å½•ä¸‹çš„èµ„æºæ–‡ä»¶,æ³¨:è¦æƒ³ä½¿ç”¨ç•Œé¢åŠŸèƒ½éœ€è¦å…ˆå®‰è£…P  referenceLoaderæ’ä»¶</code></p><p> 3.5 /Library/PreferenceLoader/Preferences <code>è¶Šç‹±æ’ä»¶çš„ç”¨æˆ·åå¥½è®¾ç½®</code></p><p> 3.6 /Library/Ringtones <code>ç³»è‡ªå¸¦çš„æ¥ç”µé“ƒå£°å­˜æ”¾ç›®å½•(ACCæ–‡ä»¶ç»“æ„)</code></p><h3 id="4-System"><a href="#4-System" class="headerlink" title="4.  /System"></a>4.  /System</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç³»ç»Ÿç¼“å­˜æ•°æ®ã€åº“æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>4.1 /System/Library/LaunchDaemons</p><pre><code>è®¾ç½®ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ç›®å½•ï¼Œplistæ–‡ä»¶è®¾ç½®</code></pre><p>4.1 /System/Library/Frameworks   /System/Library/PrivateFrameworks</p><pre><code>ç³»ç»ŸåŠ¨æ€åº“</code></pre><h3 id="5-bin-sbin"><a href="#5-bin-sbin" class="headerlink" title="5. /bin  /sbin"></a>5. /bin  /sbin</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å‘½ä»¤<br></code></pre></td></tr></table></figure><h3 id="6-boot"><a href="#6-boot" class="headerlink" title="6. /boot"></a>6. /boot</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å¼•å¯¼ç›¸å…³ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸ºç©º<br></code></pre></td></tr></table></figure><h3 id="7-dev"><a href="#7-dev" class="headerlink" title="7. /dev"></a>7. /dev</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è®¾å¤‡æ–‡ä»¶<br></code></pre></td></tr></table></figure><h3 id="8-usr"><a href="#8-usr" class="headerlink" title="8. /usr"></a>8. /usr</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç³»ç»Ÿæ ¸å¿ƒåº“ã€å‘½ä»¤<br></code></pre></td></tr></table></figure><p>8.1  /usr/lib/substrate <code>è¶Šç‹±æ ¸å¿ƒåº“æ–‡ä»¶</code></p><pre><code>substrate|--- SubstrateBootstrap.dylib|--- SubstrateInserter.dylib|--- SubstrateLoader.dylibè¿è¡ŒAPPä¼šåŠ è½½3ä¸ªdylib</code></pre><h3 id="9-tmp"><a href="#9-tmp" class="headerlink" title="9. /tmp"></a>9. /tmp</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">è½¯è¿æ¥åˆ° <span class="hljs-regexp">/private/</span>tmp/<br></code></pre></td></tr></table></figure><h3 id="10-etc"><a href="#10-etc" class="headerlink" title="10. /etc"></a>10. /etc</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">è½¯è¿æ¥åˆ° <span class="hljs-regexp">/private/</span>etc/<br></code></pre></td></tr></table></figure><h3 id="11-User"><a href="#11-User" class="headerlink" title="11. /User"></a>11. /User</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">è½¯ä»¶æ¥åˆ° <span class="hljs-regexp">/var/m</span>obile/<br></code></pre></td></tr></table></figure><h3 id="12-var"><a href="#12-var" class="headerlink" title="12. /var"></a>12. /var</h3><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">è½¯ä»¶æ¥åˆ° <span class="hljs-keyword">private</span>/<span class="hljs-keyword">var</span><br></code></pre></td></tr></table></figure><h3 id="13-private"><a href="#13-private" class="headerlink" title="13. /private"></a>13. /private</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">æ ¸å¿ƒæ–‡ä»¶ç³»ç»Ÿ<br></code></pre></td></tr></table></figure><p>13.1 /private/etc <code>é…ç½®æ–‡ä»¶</code></p><p>13.2 /private/system_data <code>ç©ºæ–‡ä»¶å¤¹</code></p><p>13.3 /private/xarts <code>unknow</code></p><p>13.4 /private/var</p><pre><code>ç³»ç»Ÿæ ¸å¿ƒç›®å½•ï¼Œrootã€mobileå®¶ç›®å½•ã€appå®‰è£…ç›®å½•ã€ç”¨æˆ·æ•°æ®ã€å­˜å‚¨.........éƒ½åœ¨è¯¥ç›®å½•ä¸‹</code></pre><h2 id="private-varç›®å½•"><a href="#private-varç›®å½•" class="headerlink" title="/private/varç›®å½•"></a>/private/varç›®å½•</h2><h3 id="1-Keychains"><a href="#1-Keychains" class="headerlink" title="1. Keychains"></a>1. Keychains</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Keychains</span> åŠ å¯†åæ•°æ®<br></code></pre></td></tr></table></figure><p>   1.1  /var/Keychains/keychain-2.db</p><pre><code>å­˜æ”¾åŠ å¯†åæ•°æ®</code></pre><p>1.2 /var/Keychains/TrustStore.sqlite3</p><pre><code>å¯¼å…¥è¯ä¹¦æ•°æ®</code></pre><h3 id="2-MobileDevice"><a href="#2-MobileDevice" class="headerlink" title="2. MobileDevice"></a>2. MobileDevice</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">æè¿°æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>2.1 /var/MobileDevice/ProvisioningProfiles</p><pre><code>å®‰è£…çš„æè¿°æ–‡ä»¶</code></pre><h3 id="3-MobileSoftwareUpdate"><a href="#3-MobileSoftwareUpdate" class="headerlink" title="3. MobileSoftwareUpdate"></a>3. MobileSoftwareUpdate</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç³»ç»Ÿå‡çº§ç›¸å…³<br></code></pre></td></tr></table></figure><h3 id="4-binpack"><a href="#4-binpack" class="headerlink" title="4. binpack"></a>4. binpack</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">checkra</span>è¶Šç‹±åçš„checkra<span class="hljs-number">1</span>n APPå®‰è£…ç›®å½•<br></code></pre></td></tr></table></figure><h3 id="5-cache"><a href="#5-cache" class="headerlink" title="5. cache"></a>5. cache</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç¼“å­˜ç›®å½•ï¼Œaptä¼šç¼“å­˜æ•°æ®åˆ°è¯¥ç›®å½•<br></code></pre></td></tr></table></figure><h3 id="6-containers"><a href="#6-containers" class="headerlink" title="6. containers"></a>6. containers</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">ç”¨æˆ·<span class="hljs-keyword">APP</span>å®‰è£…ç›®å½•ã€å…±äº«æ•°æ®<br></code></pre></td></tr></table></figure><p>6.1 /var/containers/Bundle/Application</p><pre><code>ç”¨æˆ·APPå®‰è£…ç›®å½•</code></pre><p>6.2 /var/containers/Shared</p><pre><code>    APPå…±äº«æ•°æ®ç›®å½•</code></pre><h3 id="7-db"><a href="#7-db" class="headerlink" title="7. db"></a>7. db</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç³»ç»Ÿæ–‡ä»¶ï¼Œé“ƒå£°ï¼Œå£çº¸ï¼Œç³»ç»Ÿè®¾ç½®ï¼Œç•Œé¢ï¼Œui<br></code></pre></td></tr></table></figure><h3 id="8-installd"><a href="#8-installd" class="headerlink" title="8. installd"></a>8. installd</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">å®‰è£…APPï¼Œå®‰è£…APPæ—¶å¯èƒ½ä¼šå…ˆç¼“å­˜åˆ°<span class="hljs-regexp">/var/i</span>nstalld<span class="hljs-regexp">/Library/</span>Caches/com.apple.mobile.installd.staging<br></code></pre></td></tr></table></figure><h3 id="9-keybags"><a href="#9-keybags" class="headerlink" title="9. keybags"></a>9. keybags</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">é”å±å¯†ç ç›¸å…³<br></code></pre></td></tr></table></figure><h3 id="10-lib"><a href="#10-lib" class="headerlink" title="10. lib"></a>10. lib</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">cydiaç›¸å…³æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>10.1 /var/lib/apt <code>aptç›¸å…³æ–‡ä»¶</code></p><p>10.2 /var/lib/cydia/firmware.ver <code>cydiaç‰ˆæœ¬</code></p><p>10.3 /var/lib/dpkg <code>è½¯é“¾æ¥åˆ°/Library/dpkg</code></p><h3 id="11-log-logs"><a href="#11-log-logs" class="headerlink" title="11. log logs"></a>11. log logs</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">æ—¥å¿—ç›¸å…³<br></code></pre></td></tr></table></figure><h3 id="12-networkd"><a href="#12-networkd" class="headerlink" title="12. networkd"></a>12. networkd</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç½‘ç»œç›¸å…³<br></code></pre></td></tr></table></figure><h3 id="13-preferences"><a href="#13-preferences" class="headerlink" title="13. preferences"></a>13. preferences</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">åå¥½è®¾ç½®<br></code></pre></td></tr></table></figure><h3 id="14-run"><a href="#14-run" class="headerlink" title="14. run"></a>14. run</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">UNKNOW</span><br></code></pre></td></tr></table></figure><h3 id="15-vm"><a href="#15-vm" class="headerlink" title="15. vm"></a>15. vm</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è™šæ‹Ÿå†…å­˜<br></code></pre></td></tr></table></figure><h3 id="16-wireless"><a href="#16-wireless" class="headerlink" title="16. wireless"></a>16. wireless</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">UNKNOW</span><br></code></pre></td></tr></table></figure><h3 id="17-tmp"><a href="#17-tmp" class="headerlink" title="17. tmp"></a>17. tmp</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ä¸´æ—¶æ–‡ä»¶<br></code></pre></td></tr></table></figure><h3 id="18-root"><a href="#18-root" class="headerlink" title="18. root"></a>18. root</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">rootç”¨æˆ·å®¶ç›®å½•<br></code></pre></td></tr></table></figure><h3 id="19-mobile"><a href="#19-mobile" class="headerlink" title="19. mobile"></a>19. mobile</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">mobileç”¨æˆ·å®¶ç›®å½•<br></code></pre></td></tr></table></figure><p>19.1 Documents <code>mobileç”¨æˆ·æ–‡æ¡£,CrackerXIä¼šè„±å£³åˆ°è¯¥ç›®å½•ä¸‹</code></p><p>19.2 Media <code>ç›¸å†Œã€ç”µå­ä¹¦ã€å½•éŸ³ç­‰</code></p><pre><code>ç›¸å†Œç…§ç‰‡/var/mobile/Media/DCIMiTunesä¸Šä¼ çš„å¤šåª’ä½“æ–‡ä»¶ç›®å½•/var/mobile/Media/iTunes_Controlç…§ç‰‡é‡Œçš„å›¾ç‰‡/var/mobile/Media/Photosè¯­éŸ³å¤‡å¿˜å½•/var/mobile/Media/Recordings</code></pre><p>â€‹    </p><p>19.3 Library <code>mobileç”¨æˆ·ç¼“å­˜æ•°æ®</code></p><pre><code>APPå®‰è£…åç”Ÿæˆçš„å®‰è£…è·¯å¾„ã€æ²™ç®±ç›®å½•åç§° ä¼šå­˜å‚¨åœ¨è¯¥DB/var/mobile/Library/FrontBoard/applicationState.dbå­˜å‚¨é€šè®¯å½•/var/mobile/Library/AddressBookå­˜å‚¨çŸ­ä¿¡/var/mobile/Library/SMSå­˜å‚¨å¤‡å¿˜å½•/var/mobile/Library//var/mobile/Library</code></pre><p>19.4 Containers <code>APPæ²™ç®±ã€å…±äº«æ•°æ®ç­‰</code></p><pre><code>APPæ²™ç®±ç›®å½•/var/mobile/Containers/Data/Application/xxxxAPPæ²™ç®±ç›®å½•|--- Documents æ–‡æ¡£ç›®å½•,å­˜å‚¨ä¸€äº›æ–‡ä»¶|--- Library ç¼“å­˜æ•°æ®|   ||   --- Caches ç¼“å­˜|   ||   --- Preferences ç”¨æˆ·åå¥½è®¾ç½®ï¼Œä¸€èˆ¬è¯¥ç›®å½•ä¸‹ä¼šå­˜åœ¨.plist|   | |   --- Cookies ä½¿ç”¨WebKitæ—¶cookieå­˜å‚¨è·¯å¾„|   ||   --- WebKit/WebsiteData  H5æœ¬åœ°ç¼“å­˜æ•°æ®ã€IndexedDBã€WebSQLç­‰|   ||   --- SplashBoard/Snapshots æŒ‚èµ·å¿«ç…§,å¯åŠ¨å›¾ç¼“å­˜|   ||   --- .....|--- SystemData APPè¿è¡Œäº§ç”Ÿçš„æ•°æ®ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨|--- tmp  ä¸´æ—¶æ–‡ä»¶</code></pre><p>â€‹    </p>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ReactNativeåˆ†æ</title>
    <link href="/2021/08/22/ReactNative%E5%88%86%E6%9E%90/"/>
    <url>/2021/08/22/ReactNative%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h2><p>React Native (ç®€ç§°RN)æ˜¯Facebookäº2015å¹´4æœˆå¼€æºçš„è·¨å¹³å°ç§»åŠ¨åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œæ˜¯Facebookæ—©å…ˆå¼€æºçš„JSæ¡†æ¶ React åœ¨åŸç”Ÿç§»åŠ¨åº”ç”¨å¹³å°çš„è¡ç”Ÿäº§ç‰©ï¼Œæ”¯æŒiOSå’Œå®‰å“ä¸¤å¤§å¹³å°</p><h2 id="2-åˆ†æ"><a href="#2-åˆ†æ" class="headerlink" title="2. åˆ†æ"></a>2. åˆ†æ</h2><p>æ ¸å¿ƒä»£ç ä¸ºjsç¼–å†™ï¼Œåœ¨å®‰è£…åŒ…assestç›®å½•ä¸‹å­˜æ”¾index.android.bundleï¼ˆæœ‰å¯èƒ½é‡å‘½åï¼Œå› ä¸ºrnæœ¬èº«ä»…ä»…åšäº†æ··æ·†ï¼Œä½¿ç”¨ç¼–è¾‘å™¨æ‰“å¼€å³å¯åˆ†æjsä»£ç ã€‚</p><p>æ³¨ï¼šéƒ¨åˆ†APPå¯èƒ½ä¼šå°†index.android.bundleåŠ å¯†ï¼Œè¿è¡Œæ—¶è§£å¯†åŠ è½½</p><h3 id="2-1-æ•°æ®è§£å¯†"><a href="#2-1-æ•°æ®è§£å¯†" class="headerlink" title="2.1 æ•°æ®è§£å¯†"></a>2.1 æ•°æ®è§£å¯†</h3><h4 id="2-1-1-é€šè¿‡è¯·æ±‚åŒ…å…³é”®å­—å®šä½åˆ°åŠ å¯†ç‚¹"><a href="#2-1-1-é€šè¿‡è¯·æ±‚åŒ…å…³é”®å­—å®šä½åˆ°åŠ å¯†ç‚¹" class="headerlink" title="2.1.1 é€šè¿‡è¯·æ±‚åŒ…å…³é”®å­—å®šä½åˆ°åŠ å¯†ç‚¹"></a>2.1.1 é€šè¿‡è¯·æ±‚åŒ…å…³é”®å­—å®šä½åˆ°åŠ å¯†ç‚¹</h4> <img src="/2021/08/22/ReactNative%E5%88%86%E6%9E%90/images/%E5%AE%9A%E4%BD%8D%E5%88%B0%E5%8A%A0%E5%AF%86%E7%82%B9.png" class=""><h4 id="2-1-2-æ–°å»ºjsæ–‡ä»¶ï¼Œå¤åˆ¶strEncã€strDecæ–¹æ³•å’Œç›¸å…³ä¾èµ–æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨nodeè¿è¡Œè§£å¯†"><a href="#2-1-2-æ–°å»ºjsæ–‡ä»¶ï¼Œå¤åˆ¶strEncã€strDecæ–¹æ³•å’Œç›¸å…³ä¾èµ–æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨nodeè¿è¡Œè§£å¯†" class="headerlink" title="2.1.2 æ–°å»ºjsæ–‡ä»¶ï¼Œå¤åˆ¶strEncã€strDecæ–¹æ³•å’Œç›¸å…³ä¾èµ–æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨nodeè¿è¡Œè§£å¯†"></a>2.1.2 æ–°å»ºjsæ–‡ä»¶ï¼Œå¤åˆ¶strEncã€strDecæ–¹æ³•å’Œç›¸å…³ä¾èµ–æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨nodeè¿è¡Œè§£å¯†</h4> <img src="/2021/08/22/ReactNative%E5%88%86%E6%9E%90/images/node%E5%AE%9E%E7%8E%B0%E5%8A%A0%E8%A7%A3%E5%AF%86.png" class=""><h4 id="2-1-3ç¼–å†™burpæ’ä»¶ï¼Œjavaè°ƒç”¨jsåŠ è§£å¯†æ–¹æ³•"><a href="#2-1-3ç¼–å†™burpæ’ä»¶ï¼Œjavaè°ƒç”¨jsåŠ è§£å¯†æ–¹æ³•" class="headerlink" title="2.1.3ç¼–å†™burpæ’ä»¶ï¼Œjavaè°ƒç”¨jsåŠ è§£å¯†æ–¹æ³•"></a>2.1.3ç¼–å†™burpæ’ä»¶ï¼Œjavaè°ƒç”¨jsåŠ è§£å¯†æ–¹æ³•</h4><p>xxxxx</p><h3 id="2-2-bundleä»£ç ç¯¡æ”¹"><a href="#2-2-bundleä»£ç ç¯¡æ”¹" class="headerlink" title="2.2 bundleä»£ç ç¯¡æ”¹"></a>2.2 bundleä»£ç ç¯¡æ”¹</h3><p>å¯¹äºéå¯¹ç§°åŠ å¯†éœ€è¦å°†bundleä¸­çš„å…¬é’¥è¿›è¡Œæ›¿æ¢ï¼Œæ‰€ä»¥éœ€è¦å¯¹bundleè¿›è¡Œç¯¡æ”¹ã€‚<br>index.android.bundleä¸­çš„jsæœ€ç»ˆæ˜¯éœ€è¦è¢«loadåˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥åœ¨æŸä¸€æ—¶åˆ»æ˜¯å¯ä»¥è·å–ï¼Œå°†loadå‰çš„index.android.bundleè¿›è¡Œç¯¡æ”¹ã€‚</p><h4 id="2-2-1-åˆ†ærnåŠ è½½æµç¨‹"><a href="#2-2-1-åˆ†ærnåŠ è½½æµç¨‹" class="headerlink" title="2.2.1 åˆ†ærnåŠ è½½æµç¨‹"></a>2.2.1 åˆ†ærnåŠ è½½æµç¨‹</h4><p><strong>com.facebook.react.ReactNativeHost.createReactInstanceManager</strong>æ–¹æ³•</p><img src="/2021/08/22/ReactNative%E5%88%86%E6%9E%90/images/createReactInstanceManager.png" class=""><p>å¦‚ä¸Šå›¾ <strong>å°1</strong> ç”±ç”¨æˆ·æŒ‡å®šbundleè·¯å¾„ï¼Œä¸€èˆ¬æ¥è¯´å¦‚æœbundleåŠ å¯†äº†ï¼Œè§£å¯†åä¼šå°†jSBundleFileè®¾ç½®ä¸ºbundleè§£å¯†åæ–‡ä»¶è·¯å¾„ï¼Œç”±RNè´Ÿè´£åŠ è½½ï¼Œæ­¤æ—¶å¯ä»¥HOOKè¯¥æ–¹æ³•ï¼Œè¿›è¡Œè§£å¯†åçš„bundle dumpã€‚</p><p>è¿›å…¥<strong>jSBundleFile</strong>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ReactInstanceManagerBuilder <span class="hljs-title">setJSBundleFile</span><span class="hljs-params">(String str)</span> </span>&#123;<br><br>    <span class="hljs-keyword">if</span> (!str.startsWith(<span class="hljs-string">&quot;assets://&quot;</span>)) &#123;<br>        <span class="hljs-keyword">return</span> setJSBundleLoader(JSBundleLoader.createFileLoader(str));<br>    &#125;<br>    <span class="hljs-keyword">this</span>.mJSBundleAssetUrl = str;<br>    <span class="hljs-keyword">this</span>.mJSBundleLoader = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>  è§£å¯†åçš„æ–‡ä»¶è·¯å¾„å›ºç„¶ä¸èƒ½æ˜¯assetså¼€å¤´çš„ï¼Œæ‰€ä»¥ä¼šèµ°setJSBundleLoaderæµç¨‹</p><p>  dump bundleè„šæœ¬ï¼Œè·å–åˆ°bundleæ–‡ä»¶åå³å¯è¿›è¡Œç¯¡æ”¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> ReactInstanceManagerBuilder = Java.use(<span class="hljs-string">&quot;com.facebook.react.ReactInstanceManagerBuilder&quot;</span>);<br>ReactInstanceManagerBuilder.setJSBundleFile.overload(<span class="hljs-string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>) </span>&#123;<br>   <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;bundle path is :&quot;</span>,path);<br>    <span class="hljs-keyword">return</span>  <span class="hljs-built_in">this</span>.setJSBundleFile(path);<br>&#125;;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šå›¾ <strong>å°2</strong> å¦‚æœç”¨æˆ·æœªæŒ‡å®šjSBundleFileï¼Œåˆ™é»˜è®¤è°ƒç”¨setBundleAssetNameæ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ä¼šåŠ è½½assetsè·¯å¾„ä¸‹çš„<strong>index.android.bundle</strong>(è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆappèµ„æºè·¯å¾„ä¸‹bundleé»˜è®¤åä¸ºindex.android.bundleçš„åŸå› )</p><img src="/2021/08/22/ReactNative%E5%88%86%E6%9E%90/images/setBundleAssetName.png" class=""><h4 id="2-2-2-ç¯¡æ”¹bundle"><a href="#2-2-2-ç¯¡æ”¹bundle" class="headerlink" title="2.2.2 ç¯¡æ”¹bundle"></a>2.2.2 ç¯¡æ”¹bundle</h4><h5 id="2-2-2-1-å°†index-android-bundleä¸­çš„åŠ å¯†æ–¹æ³•åˆ é™¤"><a href="#2-2-2-1-å°†index-android-bundleä¸­çš„åŠ å¯†æ–¹æ³•åˆ é™¤" class="headerlink" title="2.2.2.1 å°†index.android.bundleä¸­çš„åŠ å¯†æ–¹æ³•åˆ é™¤"></a>2.2.2.1 å°†index.android.bundleä¸­çš„åŠ å¯†æ–¹æ³•åˆ é™¤</h5><img src="/2021/08/22/ReactNative%E5%88%86%E6%9E%90/images/%E7%AF%A1%E6%94%B9bundle.png" class=""><h5 id="2-2-2-2-pushè‡³æ‰‹æœºsdå¡ä¸‹"><a href="#2-2-2-2-pushè‡³æ‰‹æœºsdå¡ä¸‹" class="headerlink" title="2.2.2.2 pushè‡³æ‰‹æœºsdå¡ä¸‹"></a>2.2.2.2 pushè‡³æ‰‹æœºsdå¡ä¸‹</h5><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">adb</span> <span class="hljs-keyword">push</span> xxxx /sdcard<br></code></pre></td></tr></table></figure><h5 id="2-2-2-3-HOOK-setBundleAssetNameï¼Œloadä¿®æ”¹åbundle"><a href="#2-2-2-3-HOOK-setBundleAssetNameï¼Œloadä¿®æ”¹åbundle" class="headerlink" title="2.2.2.3 HOOK setBundleAssetNameï¼Œloadä¿®æ”¹åbundle"></a>2.2.2.3 HOOK setBundleAssetNameï¼Œloadä¿®æ”¹åbundle</h5><p>å› ä¸ºsetBundleAssetNameæ–¹æ³•ä¼šå¯¹å½“å‰å…¥å‚è·¯å¾„æ‹¼æ¥assets://ï¼Œæ‰€ä»¥åœ¨è¯¥æ–¹æ³•ä¸‹ä¸èƒ½ç®€å•çš„HOOKä¿®æ”¹å…¥å‚ï¼ˆbundleè·¯å¾„ï¼‰ï¼Œæ•…HOOKè¯¥æ–¹æ³•ï¼Œç¯¡æ”¹ä»£ç é€»è¾‘ï¼Œå¼ºåˆ¶èµ°ä¸Šé¢åˆ†æä¸­çš„<strong>å°1</strong>æµç¨‹</p><p>frida hookè„šæœ¬å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> ReactInstanceManagerBuilder = Java.use(<span class="hljs-string">&quot;com.facebook.react.ReactInstanceManagerBuilder&quot;</span>);<br><span class="hljs-keyword">var</span> JSBundleLoader = Java.use(<span class="hljs-string">&quot;com.facebook.react.bridge.JSBundleLoader&quot;</span>)<br>ReactInstanceManagerBuilder.setBundleAssetName.overload(<span class="hljs-string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>) </span>&#123;<br><br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;bundle path is :&quot;</span>,path);<br>    <span class="hljs-keyword">var</span> newPath = <span class="hljs-string">&quot;/storage/emulated/0/index.android.bundle&quot;</span>;<br>   <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.setJSBundleLoader(JSBundleLoader.$new().createFileLoader(newPath));<br>&#125;;<br></code></pre></td></tr></table></figure><p>burpæŠ“åŒ…æœªç¯¡æ”¹jsä¸ç¯¡æ”¹jsåè¯·æ±‚åŒ…å¯¹æ¯”</p><p>æœªç¯¡æ”¹ï¼Œæ•°æ®å·²åŠ å¯†</p><img src="/2021/08/22/ReactNative%E5%88%86%E6%9E%90/images/%E5%8A%A0%E5%AF%86.png" class=""><p>ç¯¡æ”¹åï¼Œæ˜æ–‡</p><img src="/2021/08/22/ReactNative%E5%88%86%E6%9E%90/images/%E8%A7%A3%E5%AF%86.png" class="">]]></content>
    
    
    <categories>
      
      <category>ReactNative</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hook</tag>
      
      <tag>ReactNative</tag>
      
      <tag>é€†å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goäº¤å‰ç¼–è¯‘</title>
    <link href="/2021/08/22/go%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/"/>
    <url>/2021/08/22/go%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/</url>
    
    <content type="html"><![CDATA[<h2 id="æŸ¥çœ‹æ”¯æŒæ¶æ„"><a href="#æŸ¥çœ‹æ”¯æŒæ¶æ„" class="headerlink" title="æŸ¥çœ‹æ”¯æŒæ¶æ„"></a>æŸ¥çœ‹æ”¯æŒæ¶æ„</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">go tool dist list</span><br></code></pre></td></tr></table></figure><h2 id="äº¤å‰ç¼–è¯‘"><a href="#äº¤å‰ç¼–è¯‘" class="headerlink" title="äº¤å‰ç¼–è¯‘"></a>äº¤å‰ç¼–è¯‘</h2><p>Linux elf</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">GOOS</span>=linux <span class="hljs-attribute">GOARCH</span>=amd64 go build hello.go<br></code></pre></td></tr></table></figure><p>armæ¶æ„</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">GOARM</span>=7 <span class="hljs-attribute">GOARCH</span>=arm <span class="hljs-attribute">GOOS</span>=linux go build<br></code></pre></td></tr></table></figure><p>å…¶ä¸­-wä¸ºå»æ‰è°ƒè¯•ä¿¡æ¯ï¼Œ-sä¸ºå»æ‰ç¬¦å·è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs GOOS">GOOS=linux GOARCH=mips64  go build -ldflags &quot;-s -w&quot; main.go<br></code></pre></td></tr></table></figure><p>å‚æ•°è§£æ</p><p>GOOSï¼šç›®æ ‡æ“ä½œç³»ç»Ÿ<br>GOARCHï¼šç›®æ ‡æ“ä½œç³»ç»Ÿçš„æ¶æ„</p><table><thead><tr><th>OS</th><th>ARCH</th><th>OS version</th></tr></thead><tbody><tr><td>linux</td><td>386 / amd64 / arm</td><td>&gt;= Linux 2.6</td></tr><tr><td>darwin</td><td>386 / amd64</td><td>OS X (Snow Leopard + Lion)</td></tr><tr><td>freebsd</td><td>386 / amd64</td><td>&gt;= FreeBSD 7</td></tr><tr><td>windows</td><td>386 / amd64</td><td>&gt;= Windows 2000</td></tr></tbody></table><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><p> åœ¨ç½‘ç»œä¸Šçš„è¯¸å¤šæ•™ç¨‹ä¸­å¯èƒ½ä¼šçœ‹åˆ°ä¸‹é¢çš„ç¼–è¯‘å‘½ä»¤</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">CGO_ENABLED</span>=0 <span class="hljs-attribute">GOOS</span>=linux <span class="hljs-attribute">GOARCH</span>=amd64 go build hello.go<br></code></pre></td></tr></table></figure><p>å…¶ä¸­CGO_ENABLED=0çš„æ„æ€æ˜¯ä½¿ç”¨Cè¯­è¨€ç‰ˆæœ¬çš„GOç¼–è¯‘å™¨ï¼Œ</p><p>å‚æ•°é…ç½®ä¸º0çš„æ—¶å€™å°±å…³é—­Cè¯­è¨€ç‰ˆæœ¬çš„ç¼–è¯‘å™¨äº†ã€‚</p><p>è‡ªä»golang1.5ä»¥ågoå°±ä½¿ç”¨goè¯­è¨€ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘äº†ã€‚</p><p>åœ¨golang1.9å½“ä¸­æ²¡æœ‰ä½¿ç”¨CGO_ENABLEDå‚æ•°å‘ç°ä¾ç„¶å¯ä»¥æ­£å¸¸ç¼–è¯‘ã€‚å½“ç„¶ä½¿ç”¨äº†ä¹Ÿå¯ä»¥æ­£å¸¸ç¼–è¯‘ã€‚</p><p>æ¯”å¦‚æŠŠCGO_ENABLEDå‚æ•°è®¾ç½®æˆ1ï¼Œå³åœ¨ç¼–è¯‘çš„è¿‡ç¨‹å½“ä¸­ä½¿ç”¨CGOç¼–è¯‘å™¨ï¼Œæˆ‘å‘ç°ä¾ç„¶æ˜¯å¯ä»¥æ­£å¸¸ç¼–è¯‘çš„ã€‚</p><p>å®é™…ä¸Šå¦‚æœåœ¨goå½“ä¸­ä½¿ç”¨äº†Cçš„åº“ï¼Œ</p><p>æ¯”å¦‚import â€œCâ€é»˜è®¤ä½¿ç”¨go buildçš„æ—¶å€™å°±ä¼šå¯åŠ¨CGOç¼–è¯‘å™¨ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨CGO_ENABLED=0æ¥æ§åˆ¶go buildæ˜¯å¦ä½¿ç”¨CGOç¼–è¯‘å™¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutterç¼–è¯‘releaseç‰ˆæœ¬</title>
    <link href="/2021/08/22/flutter%E7%BC%96%E8%AF%91release%E7%89%88%E6%9C%AC/"/>
    <url>/2021/08/22/flutter%E7%BC%96%E8%AF%91release%E7%89%88%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<h2 id="1-ç”Ÿæˆjks"><a href="#1-ç”Ÿæˆjks" class="headerlink" title="1. ç”Ÿæˆjks"></a>1. ç”Ÿæˆjks</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">keytool -genkey -v -keystore ~/<span class="hljs-built_in">key</span>.jks -keyalg RSA -keysize <span class="hljs-number">2048</span> -validity <span class="hljs-number">10000</span> -<span class="hljs-built_in">alias</span> <span class="hljs-built_in">key</span><br></code></pre></td></tr></table></figure><h2 id="2-åˆ›å»ºkey-properities"><a href="#2-åˆ›å»ºkey-properities" class="headerlink" title="2. åˆ›å»ºkey.properities"></a>2. åˆ›å»ºkey.properities</h2><p>flutter-project/androidä¸‹åˆ›å»ºkey.properities</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">storePassword</span> = <span class="hljs-number">123456</span><br><span class="hljs-attr">keyPassword</span> = <span class="hljs-number">123456</span><br><span class="hljs-attr">keyAlias</span> = key<br><span class="hljs-attr">storeFile</span> = xxx/xxx/key.jks<br></code></pre></td></tr></table></figure><h2 id="3-ä¿®æ”¹build-gradle"><a href="#3-ä¿®æ”¹build-gradle" class="headerlink" title="3.ä¿®æ”¹build.gradle"></a>3.ä¿®æ”¹build.gradle</h2><p>flutter-project/android/app/build.gradle</p><p>android {}ä¸Šé¢ç²˜è´´</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">def</span> keystorePropertiesFile = rootProject.<span class="hljs-keyword">file</span>(<span class="hljs-string">&quot;key.properties&quot;</span>)<br><span class="hljs-keyword">def</span> keystoreProperties = <span class="hljs-keyword">new</span> Properties()<br>keystoreProperties.load(<span class="hljs-keyword">new</span> FileInputStream(keystorePropertiesFile))<br><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹buildTypes</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">buildTypes</span> &#123;<br>    <span class="hljs-section">release</span> &#123;<br>        <span class="hljs-attribute">signingConfig</span> signingConfigs.release<br>        debuggable <span class="hljs-literal">false</span><br>        minifyEnabled <span class="hljs-literal">true</span><br>        shrinkResources <span class="hljs-literal">true</span><br>       // proguardFile getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹signingConfigs</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css">signingConfigs &#123;<br>    release &#123;<br>        keyAlias keystoreProperties<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;keyAlias&#x27;</span>]</span><br>        keyPassword keystoreProperties<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;keyPassword&#x27;</span>]</span><br>        storeFile keystoreProperties<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;storeFile&#x27;</span>]</span> ? file(keystoreProperties<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;storeFile&#x27;</span>]</span>) : null<br>        storePassword keystoreProperties[<span class="hljs-string">&#x27;storePassword&#x27;</span>]<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-å¯é€‰-è®¾ç½®ç¼–è¯‘æ¶æ„"><a href="#4-å¯é€‰-è®¾ç½®ç¼–è¯‘æ¶æ„" class="headerlink" title="4. [å¯é€‰] è®¾ç½®ç¼–è¯‘æ¶æ„"></a>4. [å¯é€‰] è®¾ç½®ç¼–è¯‘æ¶æ„</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">buildTypes</span> &#123;<br>    <span class="hljs-section">release</span> &#123;<br>        <span class="hljs-attribute">signingConfig</span> signingConfigs.release<br>        ndk &#123;<br>            <span class="hljs-attribute">abiFilters</span> <span class="hljs-string">&#x27;armeabi-v7a&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-ç¼–è¯‘"><a href="#5-ç¼–è¯‘" class="headerlink" title="5. ç¼–è¯‘"></a>5. ç¼–è¯‘</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">flutter build apk</span> <br></code></pre></td></tr></table></figure><h2 id="ç¼–è¯‘é”™è¯¯"><a href="#ç¼–è¯‘é”™è¯¯" class="headerlink" title="ç¼–è¯‘é”™è¯¯"></a>ç¼–è¯‘é”™è¯¯</h2><h3 id="æ‰¾ä¸åˆ°-proæ–‡ä»¶"><a href="#æ‰¾ä¸åˆ°-proæ–‡ä»¶" class="headerlink" title="æ‰¾ä¸åˆ°.proæ–‡ä»¶"></a>æ‰¾ä¸åˆ°.proæ–‡ä»¶</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Execution failed <span class="hljs-keyword">for</span> task <span class="hljs-string">&#x27;:app:minifyReleaseWithProguard&#x27;</span>.             <br>&gt; java.io.IOException: Please correct <span class="hljs-keyword">the</span> above warnings <span class="hljs-keyword">first</span>. <br></code></pre></td></tr></table></figure><p>å°†ä¿®æ”¹ä¿®æ”¹buildTypesé‡Œçš„æ³¨é‡Šæ‰“å¼€ï¼Œå¹¶åœ¨flutter-project/android/app/åˆ›å»ºproguard-rules.pro</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># ä»£ç æ··æ·†å‹ç¼©æ¯”ï¼Œåœ¨0~7ä¹‹é—´ï¼Œé»˜è®¤ä¸º5ï¼Œä¸€èˆ¬ä¸åšä¿®æ”¹</span><br><br>-optimizationpasses <span class="hljs-number">5</span><br><br><span class="hljs-meta"># å»é™¤ç¼–è¯‘æ—¶è­¦å‘Š</span><br><br>-ignorewarnings<br><br><span class="hljs-meta">#ä¸å‹ç¼©è¾“å…¥çš„ç±»æ–‡ä»¶</span><br><br>-dontshrink<br><br><span class="hljs-meta">#ä¸ä¼˜åŒ–è¾“å…¥çš„ç±»æ–‡ä»¶</span><br><br>-dontoptimize<br><br><br><span class="hljs-meta"># æ··åˆæ—¶ä¸ä½¿ç”¨å¤§å°å†™æ··åˆï¼Œæ··åˆåçš„ç±»åä¸ºå°å†™</span><br><br>-dontusemixedcaseclassnames<br><br><span class="hljs-meta"># æŒ‡å®šä¸å»å¿½ç•¥éå…¬å…±åº“çš„ç±»</span><br><br>-dontskipnonpubliclibraryclasses<br><br><span class="hljs-meta"># è¿™å¥è¯èƒ½å¤Ÿä½¿æˆ‘ä»¬çš„é¡¹ç›®æ··æ·†åäº§ç”Ÿæ˜ å°„æ–‡ä»¶</span><br><br><span class="hljs-meta"># åŒ…å«æœ‰ç±»å-&gt;æ··æ·†åç±»åçš„æ˜ å°„å…³ç³»</span><br><br>-verbose<br><br><span class="hljs-meta"># æŒ‡å®šä¸å»å¿½ç•¥éå…¬å…±åº“çš„ç±»æˆå‘˜</span><br><br>-dontskipnonpubliclibraryclassmembers<br><br><span class="hljs-meta"># ä¸åšé¢„æ ¡éªŒï¼Œpreverifyæ˜¯proguardçš„å››ä¸ªæ­¥éª¤ä¹‹ä¸€ï¼ŒAndroidä¸éœ€è¦preverifyï¼Œå»æ‰è¿™ä¸€æ­¥èƒ½å¤ŸåŠ å¿«æ··æ·†é€Ÿåº¦ã€‚</span><br><br>-dontpreverify<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå‘½ä»¤</title>
    <link href="/2021/08/22/docker%E5%91%BD%E4%BB%A4/"/>
    <url>/2021/08/22/docker%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="1-æºè®¾ç½®"><a href="#1-æºè®¾ç½®" class="headerlink" title="1. æºè®¾ç½®"></a>1. æºè®¾ç½®</h2><p>/etc/docker/daemon.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br><br><span class="hljs-attr">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://alzgoonw.mirror.aliyuncs.com&quot;</span>]<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-é•œåƒä»“åº“"><a href="#2-é•œåƒä»“åº“" class="headerlink" title="2. é•œåƒä»“åº“"></a>2. é•œåƒä»“åº“</h2><ol><li><p>docker login [OPTIONS] [SERVER]</p><p>ç™»å½•é•œåƒä»“åº“</p><p>-u:ç”¨æˆ·å</p><p>-p:å¯†ç </p><p>exampleï¼š    </p></li></ol><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">docler <span class="hljs-keyword">login</span> -u username -p <span class="hljs-keyword">password</span><br></code></pre></td></tr></table></figure><ol start="2"><li><p>docker logout</p><p>ç™»å‡ºé•œåƒä»“åº“</p></li><li><p>docker search [OPTIONS] images</p><p>â€“automated :åªåˆ—å‡ºautomated buildç±»å‹çš„é•œåƒ</p><p>â€“no-truncï¼šæ˜¾ç¤ºå®Œæ•´çš„é•œåƒæè¿°</p><p>-sï¼šåˆ—å‡ºæ”¶è—æ•°ä¸å°äºæŒ‡å®šå€¼çš„é•œåƒ</p><p>exampleï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> search -s <span class="hljs-number">20</span> unbuntu  //åˆ—å‡ºæ”¶è—æ•°ä¸å°äº<span class="hljs-number">20</span>çš„ubuntué•œåƒ<br></code></pre></td></tr></table></figure></li><li><p>docker pull [OPTIONS] name[:TAG@DIGEST]</p><p>-aï¼šæ‹‰èµ·æ‰€æœ‰taggedé•œåƒ</p><p>â€“disable-content-trustï¼šå¿½ç•¥é•œåƒæ ¡éªŒï¼Œé»˜è®¤å¼€å¯</p><p>exampleï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker pull unbuntu  <span class="hljs-regexp">//</span>æ‹‰å»ubuntuæœ€æ–°ç‰ˆé•œåƒ<br></code></pre></td></tr></table></figure></li><li><p>docker push [OPTIONS] NAME[:TAG]</p><p>å°†æœ¬åœ°é•œåƒä¸Šä¼ åˆ°é•œåƒä»“åº“ï¼Œé¦–å…ˆè¦ç™»å½•åˆ°é•œåƒä»“åº“ï¼Œè¿˜è¦ç™»å½•åˆ°Docker Hubåˆ›å»ºå¯¹åº”åç§°çš„ä»“åº“ï¼Œç„¶åç”¨tagå‘½ä»¤ç»™é•œåƒæ‰“æ ‡ç­¾ï¼Œåªæœ‰æ‰“å®Œæ ‡ç­¾åæ‰èƒ½ä¸Šä¼ ã€‚</p></li><li><p>docker tag [OPTIONS] IMAGE[:TAG] [REGISTRYHOST/] [USERNAME/] NAME[:TAG]</p><p>æ ‡è®°æœ¬åœ°é•œåƒï¼Œå½’å…¥æŸä¸€ä»“åº“ã€‚</p><p>å®Œæ•´ç‰ˆpushï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> tag ubuntu:latest eara<span class="hljs-number">0</span>/ubuntu:v<span class="hljs-number">1</span><br><span class="hljs-attribute">docker</span> Hubåˆ›å»ºå¯¹åº”ä»“åº“<br><span class="hljs-attribute">docker</span> push area<span class="hljs-number">0</span>/ubuntu:v<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="3-ç”Ÿå‘½å‘¨æœŸ"><a href="#3-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3. ç”Ÿå‘½å‘¨æœŸ"></a>3. ç”Ÿå‘½å‘¨æœŸ</h2><ol><li><p>docker run</p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œ</p><p>å¸¸ç”¨æŒ‡ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sell">-ié€‰é¡¹è¡¨ç¤ºä½¿ç”¨äº¤äº’æ¨¡å¼ï¼Œå§‹ç»ˆä¿æŒè¾“å…¥æµå¼€æ”¾<br>-té€‰é¡¹è¡¨ç¤ºåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼Œä¸€èˆ¬ä¸¤ä¸ªå‚æ•°ç»“åˆæ—¶ä½¿ç”¨-itï¼Œå³å¯åœ¨å®¹å™¨ä¸­åˆ©ç”¨æ‰“å¼€çš„ä¼ªç»ˆç«¯è¿›è¡Œäº¤äº’æ“ä½œ<br>-dé€‰é¡¹: åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID--nameé€‰é¡¹å¯ä»¥æŒ‡å®šdocker runå‘½ä»¤å¯åŠ¨çš„å®¹å™¨åå­—ï¼Œè‹¥æ— æ­¤é€‰é¡¹ï¼ŒDockerå°†ä¸ºå®¹å™¨éšæœºåˆ†é…ä¸€ä¸ªåå­—<br>-cé€‰é¡¹ï¼šç”¨äºç»™è¿è¡Œåœ¨å®¹å™¨ä¸­çš„æ‰€æœ‰è¿›ç¨‹åˆ†é…CPUçš„shareså€¼ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹æƒé‡ï¼Œå®é™…çš„å¤„ç†é€Ÿåº¦è¿˜ä¸å®¿ä¸»æœºçš„CPUç›¸       å…³<br>-mé€‰é¡¹ï¼šç”¨äºé™åˆ¶ä¸ºå®¹å™¨ä¸­æ‰€æœ‰è¿›ç¨‹åˆ†é…çš„å†…å­˜æ€»é‡ï¼Œä»¥Bã€Kã€Mã€Gä¸ºå•ä½-vé€‰é¡¹ï¼šç”¨äºæŒ‚è½½ä¸€ä¸ªvolumeï¼Œå¯ä»¥ç”¨å¤šä¸ª<br>-vå‚æ•°åŒæ—¶æŒ‚è½½å¤šä¸ªvolumeã€‚volumeçš„æ ¼å¼ä¸º[host-dir]:[container-dir]:[rw|ro]<br>-pé€‰é¡¹ï¼šç”¨äºå°†å®¹å™¨å†…éƒ¨ç«¯å£æ˜ å°„ç»™å®¿ä¸»æœºçš„ç«¯å£ï¼Œå…¶å¸¸è§æ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨å†…éƒ¨ç«¯å£<br>-Pé€‰é¡¹ï¼šéšæœºç«¯å£æ˜ å°„ï¼Œå®¹å™¨å†…éƒ¨ç«¯å£éšæœºæ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£<br></code></pre></td></tr></table></figure><p>example:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -it ubuntu /bin/bash    //å¯åŠ¨å¹¶è¿”å›ç»ˆç«¯<br>docker run -itd --name ubuntu-test ubuntu /bin/bash  //åå°å¯åŠ¨å¹¶è¿”å›ç»ˆç«¯<br></code></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>docker start</p><p>å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²ç»åœæ­¢çš„å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker start b750bbbcfd88 <br></code></pre></td></tr></table></figure></li><li><p>docker stop</p><p>åœæ­¢ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker stop b750bbbcfd88<br></code></pre></td></tr></table></figure></li><li><p>docker restart</p><p>é‡å¯å®¹å™¨</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> restart b<span class="hljs-number">750</span>bbbcfd<span class="hljs-number">88</span><br></code></pre></td></tr></table></figure></li><li><p>docker rm</p><p>åˆ é™¤å®¹å™¨</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haml">-<span class="ruby">f <span class="hljs-symbol">:</span>é€šè¿‡SIGKILLä¿¡å·å¼ºåˆ¶åˆ é™¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨</span><br><span class="ruby"></span>-<span class="ruby">l <span class="hljs-symbol">:</span>ç§»é™¤å®¹å™¨é—´çš„ç½‘ç»œè¿æ¥ï¼Œè€Œéå®¹å™¨æœ¬èº«</span><br><span class="ruby"></span>-<span class="ruby">v <span class="hljs-symbol">:-v</span> åˆ é™¤ä¸å®¹å™¨å…³è”çš„å·</span><br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> rm -f b<span class="hljs-number">750</span>bbbcfd<span class="hljs-number">88</span><br></code></pre></td></tr></table></figure></li><li><p>docker kill</p><p>æ€æ‰è¿è¡Œä¸­çš„å®¹å™¨</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> kill -s kill b<span class="hljs-number">750</span>bbbcfd<span class="hljs-number">88</span><br></code></pre></td></tr></table></figure><p>PS.å¸¸è§rmå’Œkillç»„åˆå‘½ä»¤</p><p>æ€æ‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">docker kill <span class="hljs-constructor">$(<span class="hljs-params">docker</span> <span class="hljs-params">ps</span> -<span class="hljs-params">a</span> -<span class="hljs-params">q</span>)</span><br></code></pre></td></tr></table></figure><p>åˆ é™¤æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">docker rm <span class="hljs-constructor">$(<span class="hljs-params">docker</span> <span class="hljs-params">ps</span> -<span class="hljs-params">a</span> -<span class="hljs-params">q</span>)</span><br></code></pre></td></tr></table></figure></li><li><p>docker execå’Œdocker attach</p><p>åœ¨è¿è¡Œä¸­çš„å®¹å™¨æ‰§è¡Œå‘½ä»¤</p><p>attachï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> attach <span class="hljs-number">1</span>e<span class="hljs-number">560</span>fca<span class="hljs-number">3906</span>   // å¦‚æœä»è¿™ä¸ªå®¹å™¨é€€å‡ºï¼Œä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚<br></code></pre></td></tr></table></figure><p>exec:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-d :åˆ†ç¦»æ¨¡å¼: åœ¨åå°è¿è¡Œ</span><br><span class="hljs-deletion">-i :å³ä½¿æ²¡æœ‰é™„åŠ ä¹Ÿä¿æŒSTDIN æ‰“å¼€</span><br><span class="hljs-deletion">-t :åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯</span><br></code></pre></td></tr></table></figure><p>exampleï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker exec -it <span class="hljs-number">243</span>c32535da7 <span class="hljs-regexp">/bin/</span>bash    <span class="hljs-regexp">//</span>è¿”å›shell<br></code></pre></td></tr></table></figure></li></ol><h2 id="4-å¯¼å‡ºå’Œå¯¼å…¥"><a href="#4-å¯¼å‡ºå’Œå¯¼å…¥" class="headerlink" title="4. å¯¼å‡ºå’Œå¯¼å…¥"></a>4. å¯¼å‡ºå’Œå¯¼å…¥</h2><ul><li>exportå’Œimport</li></ul><ol><li><p>docker export</p><p>å¯¼å‡ºé•œåƒ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> export <span class="hljs-number">1</span>e<span class="hljs-number">560</span>fca<span class="hljs-number">3906</span> &gt; ubuntu.tar<br></code></pre></td></tr></table></figure></li><li><p>docker import</p><p>å¯¼å…¥é•œåƒ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cat docker<span class="hljs-regexp">/ubuntu.tar | docker import - demo/u</span>buntu:v1<br>docker import http:<span class="hljs-regexp">//</span>demo.com     <span class="hljs-regexp">//</span>æ”¯æŒä»urlå¯¼å…¥<br></code></pre></td></tr></table></figure></li><li><p>saveå’Œload</p><ol><li>docker save</li></ol><p>å°†æŒ‡å®šé•œåƒä¿å­˜ä¸ºtaræ–‡ä»¶</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">docker <span class="hljs-built_in">save</span> -o nginx.tar nginx:<span class="hljs-built_in">last</span><br></code></pre></td></tr></table></figure><ol start="2"><li>docker load</li></ol><p>å¯¼å…¥ä½¿ç”¨docker saveå‘½ä»¤å¯¼å‡ºçš„é•œåƒ</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker load -<span class="hljs-selector-tag">i</span> nginx<span class="hljs-selector-class">.tar</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="docker-saveå’Œdocker-exportçš„åŒºåˆ«"><a href="#docker-saveå’Œdocker-exportçš„åŒºåˆ«" class="headerlink" title="docker saveå’Œdocker exportçš„åŒºåˆ«"></a>docker saveå’Œdocker exportçš„åŒºåˆ«</h3><ol><li>docker saveä¿å­˜çš„æ˜¯é•œåƒï¼ˆimageï¼‰ï¼Œdocker exportä¿å­˜çš„æ˜¯å®¹å™¨ï¼ˆcontainerï¼‰ï¼›</li><li>docker loadç”¨æ¥è½½å…¥é•œåƒåŒ…ï¼Œdocker importç”¨æ¥è½½å…¥å®¹å™¨åŒ…ï¼Œä½†ä¸¤è€…éƒ½ä¼šæ¢å¤ä¸ºé•œåƒï¼›</li><li>docker loadä¸èƒ½å¯¹è½½å…¥çš„é•œåƒé‡å‘½åï¼Œè€Œdocker importå¯ä»¥ä¸ºé•œåƒæŒ‡å®šæ–°åç§°ã€‚</li></ol><h2 id="5-ç«¯å£"><a href="#5-ç«¯å£" class="headerlink" title="5.ç«¯å£"></a>5.ç«¯å£</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">-<span class="hljs-selector-tag">p</span> <span class="hljs-number">1234</span>-<span class="hljs-number">1236</span>:<span class="hljs-number">1222</span>-<span class="hljs-number">1224</span>     <span class="hljs-comment">//æŒ‡å®šèŒƒå›´æ·»åŠ ç«¯å£</span><br>docker run -d -<span class="hljs-selector-tag">p</span> <span class="hljs-number">5001</span>:<span class="hljs-number">5000</span> training/webapp python app<span class="hljs-selector-class">.py</span> <span class="hljs-comment">//å®¹å™¨5000ç«¯å£æ˜ å°„åˆ°ä¸»æœº5001</span><br>docker port bf08b7f2cd89<span class="hljs-comment">//æŸ¥çœ‹æ˜ å°„ç«¯å£</span><br></code></pre></td></tr></table></figure><h2 id="6-é•œåƒç®¡ç†"><a href="#6-é•œåƒç®¡ç†" class="headerlink" title="6. é•œåƒç®¡ç†"></a>6. é•œåƒç®¡ç†</h2><ol><li><p>docker images</p><p>é€šè¿‡docker imageså‘½ä»¤å¯ä»¥åˆ—å‡ºä¸»æœºä¸Šçš„é•œåƒï¼Œé»˜è®¤åªåˆ—å‡ºæœ€é¡¶å±‚çš„é•œåƒï¼Œå¯ä»¥ä½¿ç”¨-aé€‰é¡¹æ˜¾ç¤ºå‡ºæ‰€æœ‰é•œåƒ</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker images -<span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure></li><li><p>docker rmi</p><p>docker rmiå‘½ä»¤ç”¨äºåˆ é™¤é•œåƒï¼Œåˆ é™¤é•œåƒæ—¶ï¼Œå¦‚æœå·²æœ‰åŸºäºè¯¥é•œåƒå¯åŠ¨çš„å®¹å™¨å­˜åœ¨ï¼Œåˆ™æ— æ³•ç›´æ¥åˆ é™¤ï¼Œéœ€è¦å…ˆç”¨rmå‘½ä»¤åˆ é™¤å®¹å™¨ã€‚è¿™ä¸¤ä¸ªå­å‘½ä»¤éƒ½æä¾› -f é€‰é¡¹ï¼Œå¯å¼ºåˆ¶åˆ é™¤å­˜åœ¨å®¹å™¨çš„é•œåƒæˆ–å¯åŠ¨ä¸­çš„å®¹å™¨ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> rmi kali:<span class="hljs-number">10</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><p>docker commit</p><p>docker commitå‘½ä»¤å¯ä»¥å°†ä¸€ä¸ªå®¹å™¨å›ºåŒ–ä¸ºä¸€ä¸ªæ–°çš„é•œåƒã€‚å½“éœ€è¦åˆ¶å®šç‰¹å®šçš„é•œåƒæ—¶ï¼Œä¼šè¿›è¡Œä¿®æ”¹å®¹å™¨çš„é…ç½®ï¼Œæ¯”å¦‚åœ¨å®¹å™¨ä¸­å®‰è£…ä¸€äº›ç‰¹å®šçš„å·¥å…·ç­‰ï¼Œé€šè¿‡commitå‘½ä»¤å¯ä»¥å°†è¿™äº›ä¿®æ”¹ä¿å­˜èµ·æ¥ï¼Œä½¿å…¶ä¸ä¼šå› ä¸ºå®¹å™¨çš„åœæ­¢è€Œä¸¢å¤±ã€‚</p><ul><li>-a:æäº¤çš„é•œåƒä½œè€…</li><li>-c :ä½¿ç”¨DockerfileæŒ‡ä»¤æ¥åˆ›å»ºé•œåƒ</li><li>-m :æäº¤æ—¶çš„è¯´æ˜æ–‡å­—</li><li>-p :åœ¨commitæ—¶ï¼Œå°†å®¹å™¨æš‚åœ</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> commit -a <span class="hljs-string">&quot;demo&quot;</span> <span class="hljs-number">66</span>d<span class="hljs-number">682605023</span> kali:<span class="hljs-number">10</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="7-è¿ç»´ç›¸å…³"><a href="#7-è¿ç»´ç›¸å…³" class="headerlink" title="7. è¿ç»´ç›¸å…³"></a>7. è¿ç»´ç›¸å…³</h2><ol><li><p>docker ps</p><p>å¸¸ç”¨çš„é€‰é¡¹æœ‰-aå’Œ-lï¼Œ-aé€‰é¡¹å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬åœæ­¢çš„å®¹å™¨ï¼›-lé€‰é¡¹åªæŸ¥çœ‹æœ€æ–°åˆ›å»ºçš„å®¹å™¨ï¼ŒåŒ…æ‹¬ä¸åœ¨è¿è¡Œçš„å®¹å™¨</p></li><li><p>docker rename</p><p>é‡å‘½åå®¹å™¨</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> rename <span class="hljs-number">12312391</span> newname<br></code></pre></td></tr></table></figure></li><li><p>docer stats</p><p>æ˜¾ç¤ºå®¹å™¨èµ„æºçš„ä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> stats <span class="hljs-number">12312391</span><br></code></pre></td></tr></table></figure></li><li><p>docker top</p><p>æŸ¥çœ‹è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯</p></li><li><p>docker cp</p><p>ä¸»æœºä¸å®¹å™¨ä¹‹é—´æ•°æ®æ‹·è´</p><p>exampleï¼š</p><ul><li><p>å°†æœ¬ç›®å½•ä¸‹çš„test.phpæ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨çš„â€™/var/www/html/â€˜ç›®å½•ä¸‹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker cp test.php <span class="hljs-number">5198</span>ec963e43:<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span><br></code></pre></td></tr></table></figure></li><li><p>å°†å®¹å™¨å†…â€™/var/www/html/index.phpâ€™å¤åˆ¶åˆ°æœ¬æœº/rootç›®å½•ä¸‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker cp <span class="hljs-number">5198</span>ec963e43:<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/i</span>ndex.php <span class="hljs-regexp">/root/</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>docker diff</p><p>æŸ¥çœ‹å®¹å™¨æ–‡ä»¶ç»“æ„</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> diff <span class="hljs-number">5198</span>ec<span class="hljs-number">963</span>e<span class="hljs-number">43</span><br></code></pre></td></tr></table></figure></li><li><p>docker events</p><p>ä»æœåŠ¡å™¨è·å–å®æ—¶æ—¶é—´</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-f:æ ¹æ®æ¡ä»¶è¿‡æ»¤äº‹ä»¶</span><br><span class="hljs-deletion">--since:ä»æŒ‡å®šçš„æ—¶é—´æˆ³åæ˜¾ç¤ºæ‰€æœ‰äº‹ä»¶</span><br><span class="hljs-deletion">--until:æµæ°´æ—¶é—´æ˜¾ç¤ºåˆ°æŒ‡å®šçš„æ—¶é—´ä¸ºæ­¢</span><br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> events --since=<span class="hljs-string">&quot;&quot;</span><span class="hljs-number">2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">21</span><span class="hljs-string">&quot; </span><br></code></pre></td></tr></table></figure></li><li><p>docker history</p><p>æŸ¥çœ‹æŒ‡å®šé•œåƒçš„åˆ›å»ºå†å²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">history</span> TAG<br></code></pre></td></tr></table></figure></li><li><p>docker inspect</p><p>æ¥æŸ¥çœ‹ Docker çš„åº•å±‚ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker inspect 243c32535da7<br></code></pre></td></tr></table></figure></li><li><p>docker logs</p><p>æŸ¥çœ‹å®¹å™¨æ‰“å°æ—¥å¿—</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> logs -f bf<span class="hljs-number">08</span>b<span class="hljs-number">7</span>f<span class="hljs-number">2</span>cd<span class="hljs-number">89</span>  //æŸ¥çœ‹æ—¥å¿—<br></code></pre></td></tr></table></figure></li></ol><h2 id="8-æ–‡ä»¶æ˜ å°„"><a href="#8-æ–‡ä»¶æ˜ å°„" class="headerlink" title="8. æ–‡ä»¶æ˜ å°„"></a>8. æ–‡ä»¶æ˜ å°„</h2><ol><li>ä¸»æœºå·çš„æ˜ å°„</li></ol><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">docker run -it -v <span class="hljs-regexp">/root/</span>software:<span class="hljs-regexp">/software --privileged=true  docker.io/</span>centos <span class="hljs-regexp">/bin/</span>bash<br><br>-v æŒ‚è½½ç›®å½•<span class="hljs-regexp">/root/</span>software æœ¬åœ°ç›®å½• /softwareå®¹å™¨ç›®å½•ï¼Œåœ¨åˆ›å»ºå‰å®¹å™¨æ˜¯æ²¡æœ‰softwareç›®å½•çš„å®¹å™¨ä¼šè‡ªå·±åˆ›å»º<br>--privileged=<span class="hljs-keyword">true</span> å…³é—­å®‰å…¨æƒé™ï¼Œå¦åˆ™ä½ å®¹å™¨æ“ä½œæ–‡ä»¶å¤¹æ²¡æœ‰æƒé™<br></code></pre></td></tr></table></figure><ol start="2"><li><p>é€šè¿‡dockeråˆ›å»ºå·</p><p>æ­¤ç§æ–¹å¼ä¸å¿…è€ƒè™‘æƒé™é—®é¢˜ï¼Œdockerä¼šä¸ºæˆ‘ä»¬å¤„ç†å¥½æƒé™ã€‚ </p><ul><li>åˆ›å»º docker volume create â€“name v1</li><li>æŸ¥çœ‹ docker inspect v1</li><li>åˆ é™¤æ•°æ®å· docker volume rm v1</li></ul><p>åˆ›å»ºå®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d -v v1:/usr/local/nginx --name nginx  //v1ä¸ºåˆ›å»ºçš„å·<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨å…±äº«å­˜å‚¨çš„æ˜ å°„</p></li></ol><p>å°†ä¸€å°ä¸»æœºåšä¸ºnfsä¸»æœºï¼Œ åˆ›å»ºç›¸åº”çš„æ–‡ä»¶å¤¹ï¼Œå¹¶å°†å…¶å…±äº«ç»™dockerçš„ä¸¤å°ä¸»æœºï¼Œä¸¤å°dockerä¸»æœºå°†åˆ†äº«çš„æ–‡ä»¶å¤¹æ˜ å°„åˆ°å®¹å™¨ä¸­ï¼Œä½¿å¾—å¯¹åº”çš„å®¹å™¨å¯ä»¥å…±äº«åˆ°nfsä¸»æœºçš„å†…å®¹ã€‚å¯ä»¥å°†httpç­‰æœåŠ¡å™¨çš„ç›¸åº”çš„é¡µé¢æ–‡ä»¶å¤¹ä½¿ç”¨è¿™ç§å½¢å¼ï¼Œä»è€Œå®ç°å¤šä¸ªå®¹å™¨è·‘ä¸€ä¸ªä¸šåŠ¡</p><p>nfsä¸»æœºé…ç½®ã€192.168.6.77ã€‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@nfs ~]# yum -y install nfs-utils<br>[root@nfs ~]# vim /etc/exports<br>/public  *(rw)<br>[root@nfs ~]# systemctl restart nfs-server<br>Failed to restart nfs-serve.service: Unit not found<br>[root@nfs ~]# mkdir /public<br>[root@nfs ~]# cd /public/<br>[root@nfs public]# touch nfs.txt<br>[root@nfs public]# ls<br>nfs.txt<br><br>docker1ä¸»æœºé…ç½®<br>[root@docker1 ~]# vim /etc/fstab <br>192.168.6.77:/public /mnt/nfs nfs defaults,_netdev 0 0<br>[root@docker1 ~]# mkdir  /mnt/nfs <br>[root@docker1 ~]# systemctl restart nfs-server<br>[root@docker1 ~]# mount -a<br>[root@docker1 ~]# df -h<br>192.168.6.77:/public   17G  3.2G   14G   19% /mnt/nfs<br>[root@docker1 ~]# docker run -it -v /mnt/nfs/:/zhuhaiyan 192.168.6.153:5000/myos<br>[root@c7c376e3755a /]# cd /zhuhaiyan <br>[root@c7c376e3755a zhuhaiyan]# ls<br>nfs.txt<br><br>docker2ä¸»æœºé…ç½®<br>[root@docker2 ~]# vim /etc/fstab <br>192.168.6.77:/public /mnt/nfs nfs defaults,_netdev 0 0<br>[root@docker2 ~]# mkdir  /mnt/nfs <br>[root@docker2 ~]# systemctl restart nfs-server<br>[root@docker2 ~]# mount -a<br>[root@docker2 ~]# df -h<br>192.168.6.77:/public   17G  3.2G   14G   19% /mnt/nfs<br>[root@docker2 ~]# docker run -it -v /mnt/nfs/:/zhuhaiyan 192.168.6.153:5000/myos<br>[root@cdd805771d07 /]# cd /zhuhaiyan/<br>[root@cdd805771d07 zhuhaiyan]# ls<br>nfs.txt<br></code></pre></td></tr></table></figure><h2 id="9-ç½‘ç»œè®¾ç½®"><a href="#9-ç½‘ç»œè®¾ç½®" class="headerlink" title="9. ç½‘ç»œè®¾ç½®"></a>9. ç½‘ç»œè®¾ç½®</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker network create -d bridge test  <span class="hljs-regexp">//</span>æ–°å»ºç½‘ç»œ<br><br>-dï¼šå‚æ•°æŒ‡å®š Docker ç½‘ç»œç±»å‹ï¼Œæœ‰ bridgeã€overlayã€‚<br><br>docker network lsã€‚ <span class="hljs-regexp">//</span>æŸ¥çœ‹åˆ›å»ºçš„ç½‘ç»œ<br><br>docker run -itd --name test1 --network test ubuntu <span class="hljs-regexp">/bin/</span>bash   <span class="hljs-regexp">//</span>--networkæŒ‡å®šä½¿ç”¨çš„ç½‘ç»œ<br><br></code></pre></td></tr></table></figure><p>é…ç½® DNS</p><p>å¯ä»¥åœ¨å®¿ä¸»æœºçš„ /etc/docker/daemon.json æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹å†…å®¹æ¥è®¾ç½®å…¨éƒ¨å®¹å™¨çš„ DNSï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;dns&quot;</span> : [<br>    <span class="hljs-string">&quot;114.114.114.114&quot;</span>,<br>    <span class="hljs-string">&quot;8.8.8.8&quot;</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¾ç½®åï¼Œå¯åŠ¨å®¹å™¨çš„ DNS ä¼šè‡ªåŠ¨é…ç½®ä¸º 114.114.114.114 å’Œ 8.8.8.8ã€‚</p><p>é…ç½®å®Œï¼Œéœ€è¦é‡å¯ docker æ‰èƒ½ç”Ÿæ•ˆã€‚</p><p>å¯åŠ¨æ—¶è®¾ç½®DNS</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -it --rm host_ubuntu  --dns=114.114.114.114 --dns-search=test.com ubuntu<br><br>-h HOSTNAMEæˆ–è€…--hostname=HOSTNAME:è®¾å®šå®¹å™¨çš„ä¸»æœºåï¼Œå®ƒä¼šè¢«å†™åˆ°å®¹å™¨å†…çš„ /etc/hostname å’Œ      /etc/hostsã€‚<br>--dns=IP_ADDRESSï¼š æ·»åŠ  DNS æœåŠ¡å™¨åˆ°å®¹å™¨çš„ /etc/resolv.conf ä¸­ï¼Œè®©å®¹å™¨ç”¨è¿™ä¸ªæœåŠ¡å™¨æ¥è§£ææ‰€æœ‰ä¸åœ¨ /etc/hosts ä¸­çš„ä¸»æœºåã€‚<br>--dns-search=DOMAINï¼š è®¾å®šå®¹å™¨çš„æœç´¢åŸŸï¼Œå½“è®¾å®šæœç´¢åŸŸä¸º .example.com æ—¶ï¼Œåœ¨æœç´¢ä¸€ä¸ªåä¸º host çš„ä¸»æœºæ—¶ï¼ŒDNS ä¸ä»…æœç´¢ hostï¼Œè¿˜ä¼šæœç´¢ host.example.comã€‚<br></code></pre></td></tr></table></figure><h2 id="10-Dockerfile"><a href="#10-Dockerfile" class="headerlink" title="10 .Dockerfile"></a>10 .Dockerfile</h2><h3 id="ä»€ä¹ˆæ˜¯-Dockerfileï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Dockerfileï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Dockerfileï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Dockerfileï¼Ÿ</h3><p>Dockerfile æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ–‡æœ¬å†…å®¹åŒ…å«äº†ä¸€æ¡æ¡æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤å’Œè¯´æ˜ã€‚</p><ol><li>æ¡ˆä¾‹ï¼š</li></ol><p>åˆ›å»ºDockerfileæ–‡ä»¶</p><p><strong>vi Dockerfile</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">FROM docker.io/kalilinux/kali-linux-docker<br>RUN echo &#x27;test&#x27; &gt; /root/test<br></code></pre></td></tr></table></figure><p>åˆ›å»ºé•œåƒ</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker build -t kali:test .   // kali:testï¼ˆé•œåƒåç§°:é•œåƒæ ‡ç­¾ï¼‰,æœ€åçš„ . ä»£è¡¨æœ¬æ¬¡æ‰§è¡Œçš„ä¸Šä¸‹æ–‡è·¯å¾„<br></code></pre></td></tr></table></figure><ol start="2"><li><p>FROM å’Œ RUN æŒ‡ä»¤çš„ä½œç”¨</p><p><strong>FROM</strong>ï¼šå®šåˆ¶çš„é•œåƒéƒ½æ˜¯åŸºäº FROM çš„é•œåƒï¼Œè¿™é‡Œçš„ nginx å°±æ˜¯å®šåˆ¶éœ€è¦çš„åŸºç¡€é•œåƒã€‚åç»­çš„æ“ä½œéƒ½æ˜¯åŸºäº nginxã€‚</p><p><strong>RUN</strong>ï¼šç”¨äºæ‰§è¡Œåé¢è·Ÿç€çš„å‘½ä»¤è¡Œå‘½ä»¤ã€‚æœ‰ä»¥ä¸‹ä¿©ç§æ ¼å¼ï¼š</p></li></ol><p>shell æ ¼å¼ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="bash"> &lt;å‘½ä»¤è¡Œå‘½ä»¤&gt;</span><br><span class="hljs-comment"># &lt;å‘½ä»¤è¡Œå‘½ä»¤&gt; ç­‰åŒäºï¼Œåœ¨ç»ˆç«¯æ“ä½œçš„ shell å‘½ä»¤ã€‚</span><br></code></pre></td></tr></table></figure><p>exec æ ¼å¼ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="bash"> [<span class="hljs-string">&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;</span>, <span class="hljs-string">&quot;å‚æ•°1&quot;</span>, <span class="hljs-string">&quot;å‚æ•°2&quot;</span>]</span><br><span class="hljs-comment"># ä¾‹å¦‚ï¼š</span><br><span class="hljs-comment"># RUN [&quot;./test.php&quot;, &quot;dev&quot;, &quot;offline&quot;] ç­‰ä»·äº RUN ./test.php dev offline</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šDockerfile çš„æŒ‡ä»¤æ¯æ‰§è¡Œä¸€æ¬¡éƒ½ä¼šåœ¨ docker ä¸Šæ–°å»ºä¸€å±‚ã€‚æ‰€ä»¥è¿‡å¤šæ— æ„ä¹‰çš„å±‚ï¼Œä¼šé€ æˆé•œåƒè†¨èƒ€è¿‡å¤§ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> centos<br><span class="hljs-keyword">RUN</span><span class="bash"> yum install wget</span><br><span class="hljs-keyword">RUN</span><span class="bash"> wget -O redis.tar.gz <span class="hljs-string">&quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</span></span><br><span class="hljs-keyword">RUN</span><span class="bash"> tar -xvf redis.tar.gz</span><br><br>ä»¥ä¸Šæ‰§è¡Œä¼šåˆ›å»º <span class="hljs-number">3</span> å±‚é•œåƒã€‚å¯ç®€åŒ–ä¸ºä»¥ä¸‹æ ¼å¼ï¼š<br><br><span class="hljs-keyword">FROM</span> centos<br><span class="hljs-keyword">RUN</span><span class="bash"> yum install wget \</span><br><span class="bash">  &amp;&amp; wget -O redis.tar.gz <span class="hljs-string">&quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</span> \</span><br><span class="bash">  &amp;&amp; tar -xvf redis.tar.gz</span><br><br>å¦‚ä¸Šï¼Œä»¥ &amp;&amp; ç¬¦å·è¿æ¥å‘½ä»¤ï¼Œè¿™æ ·æ‰§è¡Œåï¼Œåªä¼šåˆ›å»º <span class="hljs-number">1</span> å±‚é•œåƒã€‚<br></code></pre></td></tr></table></figure><h3 id="ä¸Šä¸‹æ–‡è·¯å¾„"><a href="#ä¸Šä¸‹æ–‡è·¯å¾„" class="headerlink" title="ä¸Šä¸‹æ–‡è·¯å¾„"></a>ä¸Šä¸‹æ–‡è·¯å¾„</h3><p>ä¸Šé¢ä¸­ï¼Œæœ‰æåˆ°æŒ‡ä»¤æœ€åä¸€ä¸ª <strong>.</strong> æ˜¯ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡è·¯å¾„å‘¢ï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker build -t kali:test .<br></code></pre></td></tr></table></figure><p>ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œæ˜¯æŒ‡ docker åœ¨æ„å»ºé•œåƒï¼Œæœ‰æ—¶å€™æƒ³è¦ä½¿ç”¨åˆ°æœ¬æœºçš„æ–‡ä»¶ï¼ˆæ¯”å¦‚å¤åˆ¶ï¼‰ï¼Œdocker build å‘½ä»¤å¾—çŸ¥è¿™ä¸ªè·¯å¾„åï¼Œä¼šå°†è·¯å¾„ä¸‹çš„æ‰€æœ‰å†…å®¹æ‰“åŒ…ã€‚</p><p><strong>è§£æ</strong>ï¼šç”±äº docker çš„è¿è¡Œæ¨¡å¼æ˜¯ C/Sã€‚æˆ‘ä»¬æœ¬æœºæ˜¯ Cï¼Œdocker å¼•æ“æ˜¯ Sã€‚å®é™…çš„æ„å»ºè¿‡ç¨‹æ˜¯åœ¨ docker å¼•æ“ä¸‹å®Œæˆçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æ— æ³•ç”¨åˆ°æˆ‘ä»¬æœ¬æœºçš„æ–‡ä»¶ã€‚è¿™å°±éœ€è¦æŠŠæˆ‘ä»¬æœ¬æœºçš„æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ä¸€èµ·æ‰“åŒ…æä¾›ç»™ docker å¼•æ“ä½¿ç”¨ã€‚</p><p>å¦‚æœæœªè¯´æ˜æœ€åä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆé»˜è®¤ä¸Šä¸‹æ–‡è·¯å¾„å°±æ˜¯ Dockerfile æ‰€åœ¨çš„ä½ç½®ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šä¸Šä¸‹æ–‡è·¯å¾„ä¸‹ä¸è¦æ”¾æ— ç”¨çš„æ–‡ä»¶ï¼Œå› ä¸ºä¼šä¸€èµ·æ‰“åŒ…å‘é€ç»™ docker å¼•æ“ï¼Œå¦‚æœæ–‡ä»¶è¿‡å¤šä¼šé€ æˆè¿‡ç¨‹ç¼“æ…¢ã€‚</p><h3 id="æŒ‡ä»¤è¯¦è§£"><a href="#æŒ‡ä»¤è¯¦è§£" class="headerlink" title="æŒ‡ä»¤è¯¦è§£"></a>æŒ‡ä»¤è¯¦è§£</h3><h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p>å¤åˆ¶æŒ‡ä»¤ï¼Œä»ä¸Šä¸‹æ–‡ç›®å½•ä¸­å¤åˆ¶æ–‡ä»¶æˆ–è€…ç›®å½•åˆ°å®¹å™¨é‡ŒæŒ‡å®šè·¯å¾„ã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bnf">COPY [--chown=<span class="hljs-attribute">&lt;user&gt;</span>:<span class="hljs-attribute">&lt;group&gt;</span>] <span class="hljs-attribute">&lt;æºè·¯å¾„1&gt;</span>...  <span class="hljs-attribute">&lt;ç›®æ ‡è·¯å¾„&gt;</span><br>COPY [--chown=<span class="hljs-attribute">&lt;user&gt;</span>:<span class="hljs-attribute">&lt;group&gt;</span>] [&quot;<span class="hljs-attribute">&lt;æºè·¯å¾„1&gt;</span>&quot;,...  &quot;<span class="hljs-attribute">&lt;ç›®æ ‡è·¯å¾„&gt;</span>&quot;]<br></code></pre></td></tr></table></figure><p>**[â€“chown=:]**ï¼šå¯é€‰å‚æ•°ï¼Œç”¨æˆ·æ”¹å˜å¤åˆ¶åˆ°å®¹å™¨å†…æ–‡ä»¶çš„æ‹¥æœ‰è€…å’Œå±ç»„ã€‚</p><p>**&lt;æºè·¯å¾„&gt;**ï¼šæºæ–‡ä»¶æˆ–è€…æºç›®å½•ï¼Œè¿™é‡Œå¯ä»¥æ˜¯é€šé…ç¬¦è¡¨è¾¾å¼ï¼Œå…¶é€šé…ç¬¦è§„åˆ™è¦æ»¡è¶³ Go çš„ filepath.Match è§„åˆ™ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">COPY</span> hom* <span class="hljs-regexp">/mydir/</span><br><span class="hljs-keyword">COPY</span> hom?.txt <span class="hljs-regexp">/mydir/</span><br></code></pre></td></tr></table></figure><p>**&lt;ç›®æ ‡è·¯å¾„&gt;**ï¼šå®¹å™¨å†…çš„æŒ‡å®šè·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸ç”¨äº‹å…ˆå»ºå¥½ï¼Œè·¯å¾„ä¸å­˜åœ¨çš„è¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚</p><h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p>ADD æŒ‡ä»¤å’Œ COPY çš„ä½¿ç”¨æ ¼å¼ä¸€è‡´ï¼ˆåŒæ ·éœ€æ±‚ä¸‹ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ COPYï¼‰ã€‚åŠŸèƒ½ä¹Ÿç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„å¦‚ä¸‹ï¼š</p><ul><li>ADD çš„ä¼˜ç‚¹ï¼šåœ¨æ‰§è¡Œ &lt;æºæ–‡ä»¶&gt; ä¸º tar å‹ç¼©æ–‡ä»¶çš„è¯ï¼Œå‹ç¼©æ ¼å¼ä¸º gzip, bzip2 ä»¥åŠ xz çš„æƒ…å†µä¸‹ï¼Œä¼šè‡ªåŠ¨å¤åˆ¶å¹¶è§£å‹åˆ° &lt;ç›®æ ‡è·¯å¾„&gt;ã€‚</li><li>ADD çš„ç¼ºç‚¹ï¼šåœ¨ä¸è§£å‹çš„å‰æä¸‹ï¼Œæ— æ³•å¤åˆ¶ tar å‹ç¼©æ–‡ä»¶ã€‚ä¼šä»¤é•œåƒæ„å»ºç¼“å­˜å¤±æ•ˆï¼Œä»è€Œå¯èƒ½ä¼šä»¤é•œåƒæ„å»ºå˜å¾—æ¯”è¾ƒç¼“æ…¢ã€‚å…·ä½“æ˜¯å¦ä½¿ç”¨ï¼Œå¯ä»¥æ ¹æ®æ˜¯å¦éœ€è¦è‡ªåŠ¨è§£å‹æ¥å†³å®šã€‚</li></ul><pre><code>    å› æ­¤åœ¨ COPY å’Œ ADD æŒ‡ä»¤ä¸­é€‰æ‹©çš„æ—¶å€™ï¼Œå¯ä»¥éµå¾ªè¿™æ ·çš„åŸåˆ™ï¼Œ**æ‰€æœ‰çš„æ–‡ä»¶å¤åˆ¶å‡ä½¿ç”¨ COPY æŒ‡ä»¤ï¼Œä»…åœ¨éœ€è¦è‡ªåŠ¨è§£å‹ç¼©çš„åœºåˆä½¿ç”¨ ADD ã€‚**</code></pre><h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>ç±»ä¼¼äº RUN æŒ‡ä»¤ï¼Œç”¨äºè¿è¡Œç¨‹åºï¼Œä½†äºŒè€…è¿è¡Œçš„æ—¶é—´ç‚¹ä¸åŒ:</p><ul><li>CMD åœ¨docker run æ—¶è¿è¡Œã€‚</li><li>RUN æ˜¯åœ¨ docker buildã€‚</li></ul><p><strong>ä½œç”¨</strong>ï¼šä¸ºå¯åŠ¨çš„å®¹å™¨æŒ‡å®šé»˜è®¤è¦è¿è¡Œçš„ç¨‹åºï¼Œç¨‹åºè¿è¡Œç»“æŸï¼Œå®¹å™¨ä¹Ÿå°±ç»“æŸã€‚CMD æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºå¯è¢« docker run å‘½ä»¤è¡Œå‚æ•°ä¸­æŒ‡å®šè¦è¿è¡Œçš„ç¨‹åºæ‰€è¦†ç›–ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœ Dockerfile ä¸­å¦‚æœå­˜åœ¨å¤šä¸ª CMD æŒ‡ä»¤ï¼Œä»…æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">CMD</span><span class="bash"> &lt;shell å‘½ä»¤&gt; </span><br><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;&lt;å¯æ‰§è¡Œæ–‡ä»¶æˆ–å‘½ä»¤&gt;&quot;</span>,<span class="hljs-string">&quot;&lt;param1&gt;&quot;</span>,<span class="hljs-string">&quot;&lt;param2&gt;&quot;</span>,...] </span><br><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;&lt;param1&gt;&quot;</span>,<span class="hljs-string">&quot;&lt;param2&gt;&quot;</span>,...]  <span class="hljs-comment"># è¯¥å†™æ³•æ˜¯ä¸º ENTRYPOINT æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºæä¾›é»˜è®¤å‚æ•°</span></span><br></code></pre></td></tr></table></figure><p>æ¨èä½¿ç”¨ç¬¬äºŒç§æ ¼å¼ï¼Œæ‰§è¡Œè¿‡ç¨‹æ¯”è¾ƒæ˜ç¡®ã€‚ç¬¬ä¸€ç§æ ¼å¼å®é™…ä¸Šåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šè‡ªåŠ¨è½¬æ¢æˆç¬¬äºŒç§æ ¼å¼è¿è¡Œï¼Œå¹¶ä¸”é»˜è®¤å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ shã€‚</p><h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>ç±»ä¼¼äº CMD æŒ‡ä»¤ï¼Œä½†å…¶ä¸ä¼šè¢« docker run çš„å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šçš„æŒ‡ä»¤æ‰€è¦†ç›–ï¼Œè€Œä¸”è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“ä½œå‚æ•°é€ç»™ ENTRYPOINT æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºã€‚</p><p>ä½†æ˜¯, å¦‚æœè¿è¡Œ docker run æ—¶ä½¿ç”¨äº† â€“entrypoint é€‰é¡¹ï¼Œæ­¤é€‰é¡¹çš„å‚æ•°å¯å½“ä½œè¦è¿è¡Œçš„ç¨‹åºè¦†ç›– ENTRYPOINT æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼šåœ¨æ‰§è¡Œ docker run çš„æ—¶å€™å¯ä»¥æŒ‡å®š ENTRYPOINT è¿è¡Œæ‰€éœ€çš„å‚æ•°ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœ Dockerfile ä¸­å¦‚æœå­˜åœ¨å¤šä¸ª ENTRYPOINT æŒ‡ä»¤ï¼Œä»…æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">ENTRYPOINT <span class="hljs-selector-attr">[<span class="hljs-string">&quot;&lt;executeable&gt;&quot;</span>,<span class="hljs-string">&quot;&lt;param1&gt;&quot;</span>,<span class="hljs-string">&quot;&lt;param2&gt;&quot;</span>,...]</span><br></code></pre></td></tr></table></figure><p>å½“æŒ‡å®šäº† ENTRYPOINT åï¼Œ CMD çš„å«ä¹‰å°±å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†æ˜¯ç›´æ¥çš„è¿è¡Œå…¶å‘½ä»¤ï¼Œè€Œæ˜¯å°†CMD çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ ç»™ ENTRYPOINT æŒ‡ä»¤ï¼Œæ¢å¥è¯è¯´å®é™…æ‰§è¡Œæ—¶ï¼Œå°†å˜ä¸ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ENTRYPOINT</span>&gt;</span> &quot;<span class="hljs-tag">&lt;<span class="hljs-name">CMD</span>&gt;</span>&quot;<br></code></pre></td></tr></table></figure><p>å¯ä»¥æ­é… CMD å‘½ä»¤ä½¿ç”¨ï¼šä¸€èˆ¬æ˜¯å˜å‚æ‰ä¼šä½¿ç”¨ CMD ï¼Œè¿™é‡Œçš„ CMD ç­‰äºæ˜¯åœ¨ç»™ ENTRYPOINT ä¼ å‚ï¼Œä»¥ä¸‹ç¤ºä¾‹ä¼šæåˆ°ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p>å‡è®¾å·²é€šè¿‡ Dockerfile æ„å»ºäº† nginx:test é•œåƒï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> nginx<br><br><span class="hljs-keyword">ENTRYPOINT</span><span class="bash"> [<span class="hljs-string">&quot;nginx&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>] <span class="hljs-comment"># å®šå‚</span></span><br><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;/etc/nginx/nginx.conf&quot;</span>] <span class="hljs-comment"># å˜å‚ </span></span><br></code></pre></td></tr></table></figure><p>1ã€ä¸ä¼ å‚è¿è¡Œ</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">$ docker <span class="hljs-keyword">run</span><span class="bash">  nginx:<span class="hljs-built_in">test</span></span><br></code></pre></td></tr></table></figure><p>å®¹å™¨å†…ä¼šé»˜è®¤è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">nginx -c <span class="hljs-regexp">/etc/</span>nginx/nginx.conf<br></code></pre></td></tr></table></figure><p>2ã€ä¼ å‚è¿è¡Œ</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">$ docker run  nginx:test -c <span class="hljs-regexp">/etc/</span>nginx/<span class="hljs-keyword">new</span>.conf<br></code></pre></td></tr></table></figure><p>å®¹å™¨å†…ä¼šé»˜è®¤è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹(/etc/nginx/new.conf:å‡è®¾å®¹å™¨å†…å·²æœ‰æ­¤æ–‡ä»¶)</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">nginx -c <span class="hljs-regexp">/etc/</span>nginx/<span class="hljs-keyword">new</span>.conf<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæœ‰äº† CMD åï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ ENTRYPOINT å‘¢ï¼Ÿè¿™ç§ <code> &quot;&quot;</code> æœ‰ä»€ä¹ˆå¥½å¤„ä¹ˆï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªåœºæ™¯ã€‚</p><p>åœºæ™¯ä¸€ï¼šè®©é•œåƒå˜æˆåƒå‘½ä»¤ä¸€æ ·ä½¿ç”¨</p><p>â€ƒâ€ƒå‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¾—çŸ¥è‡ªå·±å½“å‰å…¬ç½‘ IP çš„é•œåƒï¼Œé‚£ä¹ˆå¯ä»¥å…ˆç”¨ CMD æ¥å®ç°ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">FROM ubuntu:<span class="hljs-number">16.04</span><br>RUN apt-get update \<br>&amp;&amp; apt-get install -y curl \<br>&amp;&amp; rm -rf <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/apt/</span>lists/*<br>CMD [ <span class="hljs-string">&quot;curl&quot;</span>, <span class="hljs-string">&quot;-s&quot;</span>, <span class="hljs-string">&quot;http://ip.cn&quot;</span> ]<br></code></pre></td></tr></table></figure><p>å‡å¦‚æˆ‘ä»¬ä½¿ç”¨ <code>docker build -t myip .</code> æ¥æ„å»ºé•œåƒçš„è¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŸ¥è¯¢å½“å‰å…¬ç½‘ IPï¼Œåªéœ€è¦æ‰§è¡Œï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ docker <span class="hljs-builtin-name">run</span> myip<br>å½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š<br></code></pre></td></tr></table></figure><p>å—¯ï¼Œè¿™ä¹ˆçœ‹èµ·æ¥å¥½åƒå¯ä»¥ç›´æ¥æŠŠé•œåƒå½“åšå‘½ä»¤ä½¿ç”¨äº†ï¼Œä¸è¿‡å‘½ä»¤æ€»æœ‰å‚æ•°ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åŠ å‚æ•°å‘¢ï¼Ÿæ¯”å¦‚ä»ä¸Šé¢çš„ CMD ä¸­å¯ä»¥çœ‹åˆ°å®è´¨çš„å‘½ä»¤æ˜¯ curl ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›æ˜¾ç¤º HTTPå¤´ä¿¡æ¯ï¼Œå°±éœ€è¦åŠ ä¸Š -i å‚æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥åŠ  <code>-i å‚æ•°</code>ç»™ <code>docker run myip</code> ä¹ˆï¼Ÿ</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs swift">$ docker run myip <span class="hljs-operator">-</span>i<br>docker: <span class="hljs-type">Error</span> response from daemon: invalid header field value <span class="hljs-string">&quot;oci runtime error: con</span><br><span class="hljs-string">tainer_linux.go:247: starting container process caused <span class="hljs-subst">\&quot;</span>exec: <span class="hljs-subst">\\</span><span class="hljs-subst">\&quot;</span>-i<span class="hljs-subst">\\</span><span class="hljs-subst">\&quot;</span>: executable</span><br><span class="hljs-string">file not found in $PATH<span class="hljs-subst">\&quot;</span><span class="hljs-subst">\n</span>&quot;</span>.<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ‰¾ä¸åˆ°çš„æŠ¥é”™ï¼Œ <code>executable file not found</code> ã€‚ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œè·Ÿåœ¨é•œåƒååé¢çš„æ˜¯ command ï¼Œè¿è¡Œæ—¶ä¼šæ›¿æ¢ CMD çš„é»˜è®¤å€¼ã€‚å› æ­¤è¿™é‡Œçš„ -i æ›¿æ¢äº†åŸæ¥çš„ CMD ï¼Œè€Œä¸æ˜¯æ·»åŠ åœ¨åŸæ¥çš„ <code>curl -s http://ip.cn</code> åé¢ã€‚è€Œ -i æ ¹æœ¬ä¸æ˜¯å‘½ä»¤ï¼Œæ‰€ä»¥è‡ªç„¶æ‰¾ä¸åˆ°ã€‚</p><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›åŠ å…¥ -i è¿™å‚æ•°ï¼Œæˆ‘ä»¬å°±å¿…é¡»é‡æ–°å®Œæ•´çš„è¾“å…¥è¿™ä¸ªå‘½ä»¤ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">$ docker run myip curl -s http:<span class="hljs-comment">//ip.cn -i</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¾ç„¶ä¸æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä½¿ç”¨ ENTRYPOINT å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç°åœ¨æˆ‘ä»¬é‡æ–°ç”¨ ENTRYPOINT æ¥å®ç°è¿™ä¸ªé•œåƒï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">FROM ubuntu:<span class="hljs-number">16.04</span><br>RUN apt-get update \<br>&amp;&amp; apt-get install -y curl \<br>&amp;&amp; rm -rf <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/apt/</span>lists/*<br>ENTRYPOINT [ <span class="hljs-string">&quot;curl&quot;</span>, <span class="hljs-string">&quot;-s&quot;</span>, <span class="hljs-string">&quot;http://ip.cn&quot;</span> ]<br></code></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘ä»¬å†æ¥å°è¯•ç›´æ¥ä½¿ç”¨ docker run myip -i ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ docker run myip<br>å½“å‰ IPï¼š<span class="hljs-number">61.148</span><span class="hljs-number">.226</span><span class="hljs-number">.66</span> æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š<br>$ docker run myip -i<br>HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-keyword">Server</span>: nginx/<span class="hljs-number">1.8</span><span class="hljs-number">.0</span><br><span class="hljs-type">Date</span>: Tue, <span class="hljs-number">22</span> Nov <span class="hljs-number">2016</span> <span class="hljs-number">05</span>:<span class="hljs-number">12</span>:<span class="hljs-number">40</span> GMT<br>Content-<span class="hljs-keyword">Type</span>: <span class="hljs-type">text</span>/html; charset=UTF<span class="hljs-number">-8</span><br>Vary: Accept-<span class="hljs-keyword">Encoding</span><br>X-Powered-<span class="hljs-keyword">By</span>: PHP/<span class="hljs-number">5.6</span><span class="hljs-number">.24</span><span class="hljs-number">-1</span>~dotdeb+<span class="hljs-number">7.1</span><br>X-<span class="hljs-keyword">Cache</span>: MISS from <span class="hljs-keyword">cache</span><span class="hljs-number">-2</span><br>X-<span class="hljs-keyword">Cache</span>-Lookup: MISS from <span class="hljs-keyword">cache</span><span class="hljs-number">-2</span>:<span class="hljs-number">80</span><br>X-<span class="hljs-keyword">Cache</span>: MISS from proxy<span class="hljs-number">-2</span>_6<br>Transfer-<span class="hljs-keyword">Encoding</span>: chunked<br>Via: <span class="hljs-number">1.1</span> <span class="hljs-keyword">cache</span><span class="hljs-number">-2</span>:<span class="hljs-number">80</span>, <span class="hljs-number">1.1</span> proxy<span class="hljs-number">-2</span>_6:<span class="hljs-number">8006</span><br><span class="hljs-keyword">Connection</span>: keep-alive<br><br>å½“å‰ IPï¼š<span class="hljs-number">61.148</span><span class="hljs-number">.226</span><span class="hljs-number">.66</span> æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š<br></code></pre></td></tr></table></figure><p>â€ƒâ€ƒå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¬¡æˆåŠŸäº†ã€‚è¿™æ˜¯å› ä¸ºå½“å­˜åœ¨ ENTRYPOINT åï¼Œ CMD çš„å†…å®¹å°†ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ ENTRYPOINT ï¼Œè€Œè¿™é‡Œ -i å°±æ˜¯æ–°çš„ CMD ï¼Œå› æ­¤ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ curl ï¼Œä»è€Œè¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœã€‚</p><p>åœºæ™¯äºŒï¼šåº”ç”¨è¿è¡Œå‰çš„å‡†å¤‡å·¥ä½œ</p><p>â€ƒâ€ƒå¯åŠ¨å®¹å™¨å°±æ˜¯å¯åŠ¨ä¸»è¿›ç¨‹ï¼Œä½†æœ‰äº›æ—¶å€™ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹å‰ï¼Œéœ€è¦ä¸€äº›å‡†å¤‡å·¥ä½œã€‚æ¯”å¦‚ mysql ç±»çš„æ•°æ®åº“ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ•°æ®åº“é…ç½®ã€åˆå§‹åŒ–çš„å·¥ä½œï¼Œè¿™äº›å·¥ä½œè¦åœ¨æœ€ç»ˆçš„ mysql æœåŠ¡å™¨è¿è¡Œä¹‹å‰è§£å†³ã€‚</p><p>â€ƒâ€ƒæ­¤å¤–ï¼Œå¯èƒ½å¸Œæœ›é¿å…ä½¿ç”¨ root ç”¨æˆ·å»å¯åŠ¨æœåŠ¡ï¼Œä»è€Œæé«˜å®‰å…¨æ€§ï¼Œè€Œåœ¨å¯åŠ¨æœåŠ¡å‰è¿˜éœ€è¦ä»¥ root èº«ä»½æ‰§è¡Œä¸€äº›å¿…è¦çš„å‡†å¤‡å·¥ä½œï¼Œæœ€ååˆ‡æ¢åˆ°æœåŠ¡ç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡ã€‚æˆ–è€…é™¤äº†æœåŠ¡å¤–ï¼Œå…¶å®ƒå‘½ä»¤ä¾æ—§å¯ä»¥ä½¿ç”¨ root èº«ä»½æ‰§è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•ç­‰ã€‚</p><p>â€ƒâ€ƒè¿™äº›å‡†å¤‡å·¥ä½œæ˜¯å’Œå®¹å™¨ CMD æ— å…³çš„ï¼Œæ— è®º CMD ä¸ºä»€ä¹ˆï¼Œéƒ½éœ€è¦äº‹å…ˆè¿›è¡Œä¸€ä¸ªé¢„å¤„ç†çš„å·¥ä½œã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œç„¶åæ”¾å…¥ ENTRYPOINT ä¸­å»æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè„šæœ¬ä¼šå°†æ¥åˆ°çš„å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ ï¼‰ä½œä¸ºå‘½ä»¤ï¼Œåœ¨è„šæœ¬æœ€åæ‰§è¡Œã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ redis ä¸­å°±æ˜¯è¿™ä¹ˆåšçš„ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> alpine:<span class="hljs-number">3.4</span><br><br>...<br><br><span class="hljs-keyword">RUN</span><span class="bash"> addgroup -S redis &amp;&amp; adduser -S -G redis redis</span><br><br>...<br><br><span class="hljs-keyword">ENTRYPOINT</span><span class="bash"> [<span class="hljs-string">&quot;docker-entrypoint.sh&quot;</span>]</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">6379</span><br><br><span class="hljs-keyword">CMD</span><span class="bash"> [ <span class="hljs-string">&quot;redis-server&quot;</span> ]</span><br></code></pre></td></tr></table></figure><p>â€ƒâ€ƒå¯ä»¥çœ‹åˆ°å…¶ä¸­ä¸ºäº† redis æœåŠ¡åˆ›å»ºäº† redis ç”¨æˆ·ï¼Œå¹¶åœ¨æœ€åæŒ‡å®šäº† ENTRYPOINT ä¸º dockerentrypoint.sh è„šæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><br>...<br><span class="hljs-comment"># allow the container to be started with `--user`</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> = <span class="hljs-string">&#x27;redis-server&#x27;</span> -a <span class="hljs-string">&quot;<span class="hljs-subst">$(id -u)</span>&quot;</span> = <span class="hljs-string">&#x27;0&#x27;</span> ]; <span class="hljs-keyword">then</span><br><br>    chown -R redis .<br>    <span class="hljs-built_in">exec</span> su-exec redis <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br></code></pre></td></tr></table></figure><p>â€ƒâ€ƒè¯¥è„šæœ¬çš„å†…å®¹å°±æ˜¯æ ¹æ® CMD çš„å†…å®¹æ¥åˆ¤æ–­ï¼Œå¦‚æœæ˜¯ redis-server çš„è¯ï¼Œåˆ™åˆ‡æ¢åˆ° redis ç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦åˆ™ä¾æ—§ä½¿ç”¨ root èº«ä»½æ‰§è¡Œã€‚æ¯”å¦‚ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ docker <span class="hljs-builtin-name">run</span> -it redis id<br><span class="hljs-attribute">uid</span>=0(root) <span class="hljs-attribute">gid</span>=0(root) <span class="hljs-attribute">groups</span>=0(root)<br></code></pre></td></tr></table></figure><p>â€ƒâ€ƒè€Œä½¿ç”¨ <code>service nginx start</code> å‘½ä»¤ï¼Œåˆ™æ˜¯å¸Œæœ› <code>systemd</code> æ¥ä»¥åå°å®ˆæŠ¤è¿›ç¨‹å½¢å¼å¯åŠ¨ nginx æœåŠ¡ã€‚è€Œåˆšæ‰è¯´äº† <code>CMD service nginx start</code> ä¼šè¢«ç†è§£ä¸º CMD [ â€œshâ€, â€œ-câ€, â€œservice nginxstartâ€] ï¼Œ<strong>å› æ­¤ä¸»è¿›ç¨‹å®é™…ä¸Šæ˜¯ sh ã€‚é‚£ä¹ˆå½“ service nginx start å‘½ä»¤ç»“æŸåï¼Œ sh ä¹Ÿå°±ç»“æŸäº†ï¼Œ sh ä½œä¸ºä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œè‡ªç„¶å°±ä¼šä»¤å®¹å™¨é€€å‡ºã€‚</strong></p><p>â€ƒâ€ƒæ­£ç¡®çš„åšæ³•æ˜¯<strong>ç›´æ¥æ‰§è¡Œ nginx å¯æ‰§è¡Œæ–‡ä»¶</strong>ï¼Œå¹¶ä¸”è¦æ±‚ä»¥å‰å°å½¢å¼è¿è¡Œã€‚æ¯”å¦‚ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">CMD <span class="hljs-selector-attr">[<span class="hljs-string">&quot;nginx&quot;</span>, <span class="hljs-string">&quot;-g&quot;</span>, <span class="hljs-string">&quot;daemon off;&quot;</span>]</span><br></code></pre></td></tr></table></figure><h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><p>ä»…ä»…åªæ˜¯å£°æ˜ç«¯å£ã€‚</p><p><strong>EXPOSE æŒ‡ä»¤æ˜¯å£°æ˜è¿è¡Œæ—¶å®¹å™¨æä¾›æœåŠ¡ç«¯å£ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œåœ¨è¿è¡Œæ—¶å¹¶ä¸ä¼šå› ä¸ºè¿™ä¸ªå£°æ˜åº”ç”¨å°±ä¼šå¼€å¯è¿™ä¸ªç«¯å£çš„æœåŠ¡ã€‚</strong></p><p>ä½œç”¨ï¼š</p><ul><li>å¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œä»¥æ–¹ä¾¿é…ç½®æ˜ å°„ã€‚</li><li>åœ¨è¿è¡Œæ—¶ä½¿ç”¨éšæœºç«¯å£æ˜ å°„æ—¶ï¼Œä¹Ÿå°±æ˜¯ docker run -P æ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„ EXPOSE çš„ç«¯å£ã€‚</li></ul><p>æ ¼å¼ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">EXPOSE</span> &lt;ç«¯å£<span class="hljs-number">1</span>&gt;<span class="hljs-meta"> [&lt;ç«¯å£2&gt;...]</span><br></code></pre></td></tr></table></figure><h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h3><p>æŒ‡å®šå·¥ä½œç›®å½•ã€‚ç”¨ WORKDIR æŒ‡å®šçš„å·¥ä½œç›®å½•ï¼Œä¼šåœ¨æ„å»ºé•œåƒçš„æ¯ä¸€å±‚ä¸­éƒ½å­˜åœ¨ã€‚ï¼ˆWORKDIR æŒ‡å®šçš„å·¥ä½œç›®å½•ï¼Œå¿…é¡»æ˜¯æå‰åˆ›å»ºå¥½çš„ï¼‰ã€‚</p><p>docker build æ„å»ºé•œåƒè¿‡ç¨‹ä¸­çš„ï¼Œæ¯ä¸€ä¸ª RUN å‘½ä»¤éƒ½æ˜¯æ–°å»ºçš„ä¸€å±‚ã€‚åªæœ‰é€šè¿‡ WORKDIR åˆ›å»ºçš„ç›®å½•æ‰ä¼šä¸€ç›´å­˜åœ¨ã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bnf">WORKDIR <span class="hljs-attribute">&lt;å·¥ä½œç›®å½•è·¯å¾„&gt;</span><br></code></pre></td></tr></table></figure><h3 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h3><p>ç”¨äºæŒ‡å®šæ‰§è¡Œåç»­å‘½ä»¤çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œè¿™è¾¹åªæ˜¯åˆ‡æ¢åç»­å‘½ä»¤æ‰§è¡Œçš„ç”¨æˆ·ï¼ˆç”¨æˆ·å’Œç”¨æˆ·ç»„å¿…é¡»æå‰å·²ç»å­˜åœ¨ï¼‰ã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bnf">USER <span class="hljs-attribute">&lt;ç”¨æˆ·å&gt;</span>[:<span class="hljs-attribute">&lt;ç”¨æˆ·ç»„&gt;</span>]<br></code></pre></td></tr></table></figure><h3 id="VOLUME-å®šä¹‰åŒ¿åå·"><a href="#VOLUME-å®šä¹‰åŒ¿åå·" class="headerlink" title="VOLUME å®šä¹‰åŒ¿åå·"></a>VOLUME å®šä¹‰åŒ¿åå·</h3><p>æ ¼å¼ä¸ºï¼š</p> <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">VOLUME</span><span class="bash"> [<span class="hljs-string">&quot;&lt;è·¯å¾„1&gt;&quot;</span>, <span class="hljs-string">&quot;&lt;è·¯å¾„2&gt;&quot;</span>...]</span><br><span class="hljs-keyword">VOLUME</span><span class="bash"> &lt;è·¯å¾„&gt;</span><br></code></pre></td></tr></table></figure><p>â€ƒâ€ƒå®¹å™¨è¿è¡Œæ—¶åº”è¯¥å°½é‡ä¿æŒå®¹å™¨å­˜å‚¨å±‚ä¸å‘ç”Ÿå†™æ“ä½œï¼Œå¯¹äºæ•°æ®åº“ç±»éœ€è¦ä¿å­˜åŠ¨æ€æ•°æ®çš„åº”ç”¨ï¼Œå…¶æ•°æ®åº“æ–‡ä»¶åº”è¯¥ä¿å­˜äºå·(volume)ä¸­ã€‚ä¸ºäº†é˜²æ­¢è¿è¡Œæ—¶ç”¨æˆ·å¿˜è®°å°†åŠ¨æ€æ–‡ä»¶æ‰€ä¿å­˜ç›®å½•æŒ‚è½½ä¸ºå·ï¼Œåœ¨ Dockerfile ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å¦‚æœç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½ï¼Œå…¶åº”ç”¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®ã€‚</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-type">VOLUME</span> /<span class="hljs-class"><span class="hljs-keyword">data</span></span><br></code></pre></td></tr></table></figure><p>â€ƒâ€ƒè¿™é‡Œçš„ <code>/data</code> ç›®å½•å°±ä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œä»»ä½•å‘ /data ä¸­å†™å…¥çš„ä¿¡æ¯éƒ½ä¸ä¼šè®°å½•è¿›å®¹å™¨å­˜å‚¨å±‚ï¼Œä»è€Œä¿è¯äº†å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€åŒ–ã€‚å½“ç„¶ï¼Œè¿è¡Œæ—¶å¯ä»¥è¦†ç›–è¿™ä¸ªæŒ‚è½½è®¾ç½®ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">docker</span> run -d -v mydata:/<span class="hljs-class"><span class="hljs-keyword">data</span> xxxx</span><br></code></pre></td></tr></table></figure><p>â€ƒâ€ƒåœ¨è¿™è¡Œå‘½ä»¤ä¸­ï¼Œå°±ä½¿ç”¨äº† mydata è¿™ä¸ªå‘½åå·æŒ‚è½½åˆ°äº† <code>/data</code> è¿™ä¸ªä½ç½®ï¼Œæ›¿ä»£äº† Dockerfile ä¸­å®šä¹‰çš„åŒ¿åå·çš„æŒ‚è½½é…ç½®ã€‚</p><p>â€ƒ</p><h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå®šä¹‰äº†ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆåœ¨åç»­çš„æŒ‡ä»¤ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">ENV <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span><br>ENV <span class="hljs-tag">&lt;<span class="hljs-name">key1</span>&gt;</span>=<span class="hljs-tag">&lt;<span class="hljs-name">value1</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">key2</span>&gt;</span>=<span class="hljs-tag">&lt;<span class="hljs-name">value2</span>&gt;</span>...<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹è®¾ç½® NODE_VERSION = 7.2.0 ï¼Œ åœ¨åç»­çš„æŒ‡ä»¤ä¸­å¯ä»¥é€šè¿‡ $NODE_VERSION å¼•ç”¨ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENV</span> NODE_VERSION <span class="hljs-number">7.2</span>.<span class="hljs-number">0</span><br><br><span class="hljs-keyword">RUN</span><span class="bash"> curl -SLO <span class="hljs-string">&quot;https://nodejs.org/dist/v<span class="hljs-variable">$NODE_VERSION</span>/node-v<span class="hljs-variable">$NODE_VERSION</span>-linux-x64.tar.xz&quot;</span> \</span><br><span class="bash">  &amp;&amp; curl -SLO <span class="hljs-string">&quot;https://nodejs.org/dist/v<span class="hljs-variable">$NODE_VERSION</span>/SHASUMS256.txt.asc&quot;</span></span><br></code></pre></td></tr></table></figure><h3 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h3><p>æ„å»ºå‚æ•°ï¼Œä¸ ENV ä½œç”¨ä¸€è‡³ã€‚ä¸è¿‡ä½œç”¨åŸŸä¸ä¸€æ ·ã€‚ARG è®¾ç½®çš„ç¯å¢ƒå˜é‡ä»…å¯¹ Dockerfile å†…æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ docker build çš„è¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œæ„å»ºå¥½çš„é•œåƒå†…ä¸å­˜åœ¨æ­¤ç¯å¢ƒå˜é‡ã€‚</p><p>æ„å»ºå‘½ä»¤ docker build ä¸­å¯ä»¥ç”¨ â€“build-arg &lt;å‚æ•°å&gt;=&lt;å€¼&gt; æ¥è¦†ç›–ã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bnf">ARG <span class="hljs-attribute">&lt;å‚æ•°å&gt;</span>[=<span class="hljs-attribute">&lt;é»˜è®¤å€¼&gt;</span>]<br></code></pre></td></tr></table></figure><h3 id="HEALTHCHECK"><a href="#HEALTHCHECK" class="headerlink" title="HEALTHCHECK"></a>HEALTHCHECK</h3><p>ç”¨äºæŒ‡å®šæŸä¸ªç¨‹åºæˆ–è€…æŒ‡ä»¤æ¥ç›‘æ§ docker å®¹å™¨æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dos">HEALTHCHECK [é€‰é¡¹] <span class="hljs-built_in">CMD</span> &lt;å‘½ä»¤&gt;ï¼šè®¾ç½®æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶å†µçš„å‘½ä»¤<br>HEALTHCHECK NONEï¼šå¦‚æœåŸºç¡€é•œåƒæœ‰å¥åº·æ£€æŸ¥æŒ‡ä»¤ï¼Œä½¿ç”¨è¿™è¡Œå¯ä»¥å±è”½æ‰å…¶å¥åº·æ£€æŸ¥æŒ‡ä»¤<br><br>HEALTHCHECK [é€‰é¡¹] <span class="hljs-built_in">CMD</span> &lt;å‘½ä»¤&gt; : è¿™è¾¹ <span class="hljs-built_in">CMD</span> åé¢è·Ÿéšçš„å‘½ä»¤ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ <span class="hljs-built_in">CMD</span> çš„ç”¨æ³•ã€‚<br></code></pre></td></tr></table></figure><h3 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h3><p>ç”¨äºå»¶è¿Ÿæ„å»ºå‘½ä»¤çš„æ‰§è¡Œã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ Dockerfile é‡Œç”¨ ONBUILD æŒ‡å®šçš„å‘½ä»¤ï¼Œåœ¨æœ¬æ¬¡æ„å»ºé•œåƒçš„è¿‡ç¨‹ä¸­ä¸ä¼šæ‰§è¡Œï¼ˆå‡è®¾é•œåƒä¸º test-buildï¼‰ã€‚å½“æœ‰æ–°çš„ Dockerfile ä½¿ç”¨äº†ä¹‹å‰æ„å»ºçš„é•œåƒ FROM test-build ï¼Œè¿™æ˜¯æ‰§è¡Œæ–°é•œåƒçš„ Dockerfile æ„å»ºæ—¶å€™ï¼Œä¼šæ‰§è¡Œ test-build çš„ Dockerfile é‡Œçš„ ONBUILD æŒ‡å®šçš„å‘½ä»¤ã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bnf">ONBUILD <span class="hljs-attribute">&lt;å…¶å®ƒæŒ‡ä»¤&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SOå‡½æ•°è¿è¡Œé¡ºåº</title>
    <link href="/2021/08/22/so%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F/"/>
    <url>/2021/08/22/so%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="åŠ è½½è¿è¡Œæµç¨‹"><a href="#åŠ è½½è¿è¡Œæµç¨‹" class="headerlink" title="åŠ è½½è¿è¡Œæµç¨‹"></a>åŠ è½½è¿è¡Œæµç¨‹</h2> <img src="/2021/08/22/so%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F/images/%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B.png" class=""><h3 id="1-init"><a href="#1-init" class="headerlink" title="1. _init"></a>1. _init</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> <span class="hljs-keyword">void</span> _init(<span class="hljs-keyword">void</span>) &#123; &#125; <br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ç”Ÿæˆåä¼šåœ¨<code>.init</code>æ®µ</p> <img src="/2021/08/22/so%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F/images/readelf.png" class=""><p>IDAåç¼–è¯‘å¯¹åº”<code>_init_proc</code>æ–¹æ³•</p> <img src="/2021/08/22/so%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F/images/init_proc.png" class="" width="600" height="1100"><h3 id="2-constructor"><a href="#2-constructor" class="headerlink" title="2. constructor"></a>2. constructor</h3><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs delphi">__attribute__( (<span class="hljs-function"><span class="hljs-keyword">constructor</span><span class="hljs-params">(1)</span>) ) <span class="hljs-title">void</span> <span class="hljs-title">aaaa</span><span class="hljs-params">( void )</span></span><br><span class="hljs-function"><span class="hljs-comment">&#123;</span></span><br><span class="hljs-comment"><span class="hljs-function">LOGI( &quot;constructor constructor 1 called&quot; );</span></span><br><span class="hljs-comment"><span class="hljs-function"></span></span><br><span class="hljs-comment"><span class="hljs-function">&#125;</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">__<span class="hljs-title">attribute__</span><span class="hljs-params">( (<span class="hljs-keyword">constructor</span>(2)</span>) ) <span class="hljs-title">void</span> <span class="hljs-title">aaaa</span><span class="hljs-params">( void )</span></span><br><span class="hljs-function"><span class="hljs-comment">&#123;</span></span><br><span class="hljs-comment"><span class="hljs-function">LOGI( &quot;constructor constructor 2 called&quot; );</span></span><br><span class="hljs-comment"><span class="hljs-function"></span></span><br><span class="hljs-comment"><span class="hljs-function">&#125;</span></span><br></code></pre></td></tr></table></figure><p>æ ¹æ®è®¾ç½®çš„ä¼˜å…ˆçº§ä¾æ¬¡è°ƒç”¨,ç¼–è¯‘ç”Ÿæˆåä¼šåœ¨.init_arrayæ®µ</p> <img src="/2021/08/22/so%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F/images/init_array.png" class=""><p>IDAåˆ†æ ctrl+så®šä½åˆ°.init_arrayæ®µ</p> <img src="/2021/08/22/so%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F/images/ida_init_array.png" class=""><p>ç‚¹å‡»è¿›å…¥æ–¹æ³•å®ç°</p> <img src="/2021/08/22/so%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F/images/%E8%BF%9B%E5%85%A5%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0.png" class="" width="600" height="400"><h3 id="3-JNI-OnLoad"><a href="#3-JNI-OnLoad" class="headerlink" title="3. JNI_OnLoad"></a>3. JNI_OnLoad</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">JNIEXPORT jint JNICALL <span class="hljs-title">JNI_OnLoad</span><span class="hljs-params">(JavaVM* vm, <span class="hljs-keyword">void</span>* reserved)</span></span>&#123;<br>    <span class="hljs-built_in">LOGI</span>(<span class="hljs-string">&quot;jni onload called&quot;</span>);<br>   <span class="hljs-comment">//TODO</span><br>    <span class="hljs-keyword">return</span> JNI_VERSION_1_4;  <span class="hljs-comment">//è¿™é‡Œå¾ˆé‡è¦ï¼Œå¿…é¡»è¿”å›ç‰ˆæœ¬ï¼Œå¦åˆ™åŠ è½½ä¼šå¤±è´¥ã€‚</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æºç åˆ†æï¼ˆAndroid10ï¼‰"><a href="#æºç åˆ†æï¼ˆAndroid10ï¼‰" class="headerlink" title="æºç åˆ†æï¼ˆAndroid10ï¼‰"></a>æºç åˆ†æï¼ˆAndroid10ï¼‰</h2><p>AndroidåŠ è½½åŠ¨æ€åº“æœ‰ä¸‰ç§æ–¹å¼</p><ul><li><p>System.loadLibrary  </p><p>javaä¸­æ–¹æ³•,ä¸éœ€è¦æŒ‡å®šsoè·¯å¾„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¡¥å…¨</p></li><li><p>System.load</p><p>javaä¸­æ–¹æ³•,éœ€è¦æŒ‡å®šsoè·¯å¾„</p></li><li><p>dlopen</p><p>bionicåº“ä¸­æ–¹æ³•ï¼Œéœ€è¦æŒ‡å®šsoè·¯å¾„</p></li></ul><h3 id="java-load-so"><a href="#java-load-so" class="headerlink" title="java load so"></a>java load so</h3><p> System.loadLibraryä¸System.loadçš„å®ç°åœ¨<code>/libcore/ojluni/src/main/java/java/lang/System.java</code>ä¸­</p><p>æœ€ç»ˆéƒ½ä¼šè°ƒç”¨<code>/libcore/ojluni/src/main/java/java/lang/Runtime.java</code>ä¸‹çš„nativeæ–¹æ³•<code>nativeLoad</code></p><p>å› ä¸º<code>System.load </code>çš„å…¥å‚ä¸æ˜¯soæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿéœ€è¦ä»<code>java.library.path</code>å±æ€§ä¸­è·å–ç³»ç»Ÿåº“çš„åœ°å€ï¼Œéå†è¯¥soæ–‡ä»¶åœ¨å“ªä¸ªè·¯å¾„ä¸‹ï¼Œæœ€ç»ˆè¿”å›ç»å¯¹è·¯å¾„ï¼Œä¸€èˆ¬çš„<code>java.library.path</code>ä¸º</p><ul><li><p>/vendor/lib</p></li><li><p>/system/lib</p></li><li><p>/data/app-lib/com.xxxxx-1</p></li></ul><p>nativeLoadçš„JNIå®ç°åœ¨<code>/libcore/ojluni/src/main/native/Runtime.c</code>ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">JNIEXPORT jstring JNICALL</span><br><span class="hljs-function"><span class="hljs-title">Runtime_nativeLoad</span><span class="hljs-params">(JNIEnv* env, jclass ignored, jstring javaFilename,</span></span><br><span class="hljs-params"><span class="hljs-function">                   jobject javaLoader, jclass caller)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> JVM_NativeLoad(env, javaFilename, javaLoader, caller);<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨<code>/art/openjdkjvm/OpenjdkJvm.cc</code>ä¸‹å¾—<code>JVM_NativeLoad</code>æ–¹æ³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">JNIEXPORT jstring <span class="hljs-title">JVM_NativeLoad</span><span class="hljs-params">(JNIEnv* env,</span></span><br><span class="hljs-params"><span class="hljs-function">                                 jstring javaFilename,</span></span><br><span class="hljs-params"><span class="hljs-function">                                 jobject javaLoader,</span></span><br><span class="hljs-params"><span class="hljs-function">                                 jclass caller)</span> </span>&#123;<br>  <br>    art::JavaVMExt* vm = art::Runtime::<span class="hljs-built_in">Current</span>()-&gt;<span class="hljs-built_in">GetJavaVM</span>();<br>    <span class="hljs-keyword">bool</span> success = vm-&gt;<span class="hljs-built_in">LoadNativeLibrary</span>(env,<br>                                         filename.<span class="hljs-built_in">c_str</span>(),<br>                                         javaLoader,<br>                                         caller,<br>                                         &amp;error_msg);<br>  <span class="hljs-comment">// Don&#x27;t let a pending exception from JNI_OnLoad cause a CheckJNI issue with NewStringUTF.</span><br>  env-&gt;<span class="hljs-built_in">ExceptionClear</span>();<br>  <span class="hljs-keyword">return</span> env-&gt;<span class="hljs-built_in">NewStringUTF</span>(error_msg.<span class="hljs-built_in">c_str</span>());<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨å½“å‰æ–‡ä»¶ä¸­çš„<code>LoadNativeLibrary</code>æ–¹æ³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">JavaVMExt::LoadNativeLibrary</span><span class="hljs-params">(JNIEnv* env,</span></span><br><span class="hljs-params"><span class="hljs-function">                                  <span class="hljs-keyword">const</span> std::string&amp; path,</span></span><br><span class="hljs-params"><span class="hljs-function">                                  jobject class_loader,</span></span><br><span class="hljs-params"><span class="hljs-function">                                  jclass caller_class,</span></span><br><span class="hljs-params"><span class="hljs-function">                                  std::string* error_msg)</span> </span>&#123;<br>     ......<br><br>  <span class="hljs-keyword">void</span>* handle = android::<span class="hljs-built_in">OpenNativeLibrary</span>(<br>      env,<br>      runtime_-&gt;<span class="hljs-built_in">GetTargetSdkVersion</span>(),<br>      path_str,<br>      class_loader,<br>      (caller_location.<span class="hljs-built_in">empty</span>() ? <span class="hljs-literal">nullptr</span> : caller_location.<span class="hljs-built_in">c_str</span>()),<br>      library_path.<span class="hljs-built_in">get</span>(),<br>      &amp;needs_native_bridge,<br>      &amp;nativeloader_error_msg);<br><br>  <br>  <span class="hljs-keyword">bool</span> was_successful = <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">void</span>* sym = library-&gt;<span class="hljs-built_in">FindSymbol</span>(<span class="hljs-string">&quot;JNI_OnLoad&quot;</span>, <span class="hljs-literal">nullptr</span>);<br>  <span class="hljs-keyword">if</span> (sym == <span class="hljs-literal">nullptr</span>) &#123;<br>    was_successful = <span class="hljs-literal">true</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">VLOG</span>(jni) &lt;&lt; <span class="hljs-string">&quot;[Calling JNI_OnLoad in \&quot;&quot;</span> &lt;&lt; path &lt;&lt; <span class="hljs-string">&quot;\&quot;]&quot;</span>;<br>    <span class="hljs-keyword">using</span> JNI_OnLoadFn = <span class="hljs-built_in"><span class="hljs-keyword">int</span></span>(*)(JavaVM*, <span class="hljs-keyword">void</span>*);<br>    JNI_OnLoadFn jni_on_load = <span class="hljs-keyword">reinterpret_cast</span>&lt;JNI_OnLoadFn&gt;(sym);<br>    <span class="hljs-keyword">int</span> version = (*jni_on_load)(<span class="hljs-keyword">this</span>, <span class="hljs-literal">nullptr</span>);<br><br>.........<br><br>    <span class="hljs-keyword">if</span> (version == JNI_ERR) &#123;<br>      <span class="hljs-built_in">StringAppendF</span>(error_msg, <span class="hljs-string">&quot;JNI_ERR returned from JNI_OnLoad in \&quot;%s\&quot;&quot;</span>, path.<span class="hljs-built_in">c_str</span>());<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (JavaVMExt::<span class="hljs-built_in">IsBadJniVersion</span>(version)) &#123;<br>      <span class="hljs-built_in">StringAppendF</span>(error_msg, <span class="hljs-string">&quot;Bad JNI version returned from JNI_OnLoad in \&quot;%s\&quot;: %d&quot;</span>,<br>                    path.<span class="hljs-built_in">c_str</span>(), version);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      was_successful = <span class="hljs-literal">true</span>;<br>    &#125;<br>  &#125;<br><br>  library-&gt;<span class="hljs-built_in">SetResult</span>(was_successful);<br>  <span class="hljs-keyword">return</span> was_successful;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆè°ƒç”¨äº†<code>android::OpenNativeLibrary</code>æ–¹æ³•åŠ è½½SOæ–‡ä»¶ï¼ŒåŠ è½½æˆåŠŸåä¼šæŸ¥æ‰¾ç¬¦å·è¡¨æ˜¯å¦æœ‰<code>JNI_OnLoad</code>,å¦‚æœæœ‰åˆ™æ ¹æ®<code>JNI_OnLoad</code>çš„åœ°å€è¿›è¡Œè°ƒç”¨ï¼Œç„¶ååˆ¤æ–­è¿”å›å€¼<code>version</code>æ˜¯å¦æ­£ç¡®,è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ<code>JNI_OnLoad</code>è¦è¿”å›ç‰ˆæœ¬çš„åŸå› ã€‚</p><p>æ‰€ä»¥å¯ä»¥é€šè¿‡<code>OpenNativeLibrary</code>æ–¹æ³•å¯¹<code>JNI_OnLoad</code>è¿›è¡ŒHOOKï¼ˆæ­¤æ—¶SOå·²åŠ è½½ä½†è¿˜æœªæ‰§è¡ŒJNI_OnLoadæ–¹æ³•ï¼‰</p><p>ä¸Šé¢çš„è¿è¡Œæµç¨‹ä¸­<code>JNI_OnLoad</code>æ’åœ¨ç¬¬ä¸‰ä½ï¼Œä¹Ÿå°±æ˜¯è¯´<code>_init</code>å’Œ<code>constructor</code>åœ¨<code>OpenNativeLibrary</code>æ–¹æ³•ä¸­å°±ä»¥æ‰§è¡Œ</p><p>ç»§ç»­åˆ†æ<code>OpenNativeLibrary</code>æ–¹æ³•ï¼Œåœ¨<code>/system/core/libnativeloader/native_loader.cpp</code>ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">OpenNativeLibrary</span><span class="hljs-params">(JNIEnv* env, <span class="hljs-keyword">int32_t</span> target_sdk_version, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* path,</span></span><br><span class="hljs-params"><span class="hljs-function">                        jobject class_loader, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* caller_location, jstring library_path,</span></span><br><span class="hljs-params"><span class="hljs-function">                        <span class="hljs-keyword">bool</span>* needs_native_bridge, <span class="hljs-keyword">char</span>** error_msg)</span> </span>&#123;<br> <br>  <br>  <span class="hljs-keyword">if</span> (class_loader == <span class="hljs-literal">nullptr</span>) &#123;<br>    *needs_native_bridge = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">if</span> (caller_location != <span class="hljs-literal">nullptr</span>) &#123;<br>      <span class="hljs-keyword">android_namespace_t</span>* boot_namespace = <span class="hljs-built_in">FindExportedNamespace</span>(caller_location);<br>      <span class="hljs-keyword">if</span> (boot_namespace != <span class="hljs-literal">nullptr</span>) &#123;<br>        <span class="hljs-keyword">const</span> android_dlextinfo dlextinfo = &#123;<br>            .flags = ANDROID_DLEXT_USE_NAMESPACE,<br>            .library_namespace = boot_namespace,<br>        &#125;;<br>        <span class="hljs-keyword">void</span>* handle = <span class="hljs-built_in">android_dlopen_ext</span>(path, RTLD_NOW, &amp;dlextinfo);<br>        <span class="hljs-keyword">if</span> (handle == <span class="hljs-literal">nullptr</span>) &#123;<br>          *error_msg = <span class="hljs-built_in">strdup</span>(<span class="hljs-built_in">dlerror</span>());<br>        &#125;<br>        <span class="hljs-keyword">return</span> handle;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">void</span>* handle = <span class="hljs-built_in">dlopen</span>(path, RTLD_NOW);<br>    <span class="hljs-keyword">if</span> (handle == <span class="hljs-literal">nullptr</span>) &#123;<br>      *error_msg = <span class="hljs-built_in">strdup</span>(<span class="hljs-built_in">dlerror</span>());<br>    &#125;<br>    <span class="hljs-keyword">return</span> handle;<br>  &#125;<br> <br> ........<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">OpenNativeLibraryInNamespace</span>(ns, path, needs_native_bridge, error_msg);<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">OpenNativeLibraryInNamespace</span><span class="hljs-params">(NativeLoaderNamespace* ns, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* path,</span></span><br><span class="hljs-params"><span class="hljs-function">                                   <span class="hljs-keyword">bool</span>* needs_native_bridge, <span class="hljs-keyword">char</span>** error_msg)</span> </span>&#123;<br>  <span class="hljs-keyword">if</span> (ns-&gt;<span class="hljs-built_in">is_android_namespace</span>()) &#123;<br>    android_dlextinfo extinfo;<br>    extinfo.flags = ANDROID_DLEXT_USE_NAMESPACE;<br>    extinfo.library_namespace = ns-&gt;<span class="hljs-built_in">get_android_ns</span>();<br><br>    <span class="hljs-keyword">void</span>* handle = <span class="hljs-built_in">android_dlopen_ext</span>(path, RTLD_NOW, &amp;extinfo);<br>    <span class="hljs-keyword">if</span> (handle == <span class="hljs-literal">nullptr</span>) &#123;<br>      *error_msg = <span class="hljs-built_in">strdup</span>(<span class="hljs-built_in">dlerror</span>());<br>    &#125;<br>    *needs_native_bridge = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> handle;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">void</span>* handle = <span class="hljs-built_in">NativeBridgeLoadLibraryExt</span>(path, RTLD_NOW, ns-&gt;<span class="hljs-built_in">get_native_bridge_ns</span>());<br>    <span class="hljs-keyword">if</span> (handle == <span class="hljs-literal">nullptr</span>) &#123;<br>      *error_msg = <span class="hljs-built_in">strdup</span>(<span class="hljs-built_in">NativeBridgeGetError</span>());<br>    &#125;<br>    *needs_native_bridge = <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">return</span> handle;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨<code>/bionic/libdl/libdl.cpp</code>ä¸­çš„<code>android_dlopen_ext</code>æ–¹æ³•åŠ è½½SO,è¯¥æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨linkerä¸­çš„<code>do_dlopen</code>,linkerçš„å®ç°åœ¨<code>/bionic/linker/linker.cpp</code>ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">do_dlopen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* name, <span class="hljs-keyword">int</span> flags,</span></span><br><span class="hljs-params"><span class="hljs-function">                <span class="hljs-keyword">const</span> android_dlextinfo* extinfo,</span></span><br><span class="hljs-params"><span class="hljs-function">                <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>* caller_addr)</span> </span>&#123;<br><br>  .......<br>    <br>  soinfo* si = <span class="hljs-built_in">find_library</span>(ns, translated_name, flags, extinfo, caller);<br>  <span class="hljs-keyword">if</span> (si != <span class="hljs-literal">nullptr</span>) &#123;<br>    <span class="hljs-keyword">void</span>* handle = si-&gt;<span class="hljs-built_in">to_handle</span>();<br>    si-&gt;<span class="hljs-built_in">call_constructors</span>();<br>    <span class="hljs-keyword">return</span> handle;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>find_libraryæ–¹æ³•æ‰æ˜¯çœŸæ­£çš„åŠ è½½SOï¼Œæ‰§è¡Œå®šä½åŠ¨æ€èŠ‚ã€è§£æåŠ¨æ€èŠ‚ã€åŠ è½½åŠ¨æ€èŠ‚ ã€é‡å®šä½ç­‰ï¼ŒåƒSOæŠ¹å¤´ã€è‡ªå®šä¹‰Linkerç­‰åŠ å›ºæ–¹å¼éƒ½æ˜¯åœ¨è¿™é‡Œåšçš„æ–‡ç« ã€‚åœ¨ä½ç‰ˆæœ¬ä¸­åŠ è½½SOæ–‡ä»¶åè¿”å›çš„æ˜¯soinfoç»“æ„ä½“ï¼Œé«˜ç‰ˆæœ¬è¿”å›çš„æ˜¯to_handleåçš„æŒ‡é’ˆã€‚</p><p><code>do_dlopen</code>æ–¹æ³•è°ƒç”¨äº†<code>call_constructors</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">soinfo::call_constructors</span><span class="hljs-params">()</span> </span>&#123;<br> <br>......<br>    <br>  <span class="hljs-built_in">call_function</span>(<span class="hljs-string">&quot;DT_INIT&quot;</span>, init_func_, <span class="hljs-built_in">get_realpath</span>());<br>  <span class="hljs-built_in">call_array</span>(<span class="hljs-string">&quot;DT_INIT_ARRAY&quot;</span>, init_array_, init_array_count_, <span class="hljs-literal">false</span>, <span class="hljs-built_in">get_realpath</span>());<br><br>.......<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨call_functionå’Œcall_arrayå¹¶æ ¹æ®<code>init_func_</code>,<code>init_array_</code>ç¬¦å·åœ°å€æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•</p><p>è·å–ç¬¦å·è¡¨çš„å®ç°<code>/bionic/linker/linker.cpp</code>ä¸­çš„<code>soinfo::prelink_image</code>æ–¹æ³•ï¼Œåœ¨<code>find_library</code>æ–¹æ³•æ‰§è¡Œå®Œæˆåå°±å·²è·å–åˆ°ç¬¦å·ä¿¡æ¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">soinfo::prelink_image</span><span class="hljs-params">()</span> </span>&#123;<br><br>........<br><br><span class="hljs-keyword">case</span> DT_INIT:<br>  init_func_ = <span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-keyword">linker_ctor_function_t</span>&gt;(load_bias + d-&gt;d_un.d_ptr);<br>  <span class="hljs-keyword">break</span>;<br><br><span class="hljs-keyword">case</span> DT_FINI:<br>  fini_func_ = <span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-keyword">linker_dtor_function_t</span>&gt;(load_bias + d-&gt;d_un.d_ptr);<br>  <span class="hljs-keyword">break</span>;<br><br><span class="hljs-keyword">case</span> DT_INIT_ARRAY:<br>  init_array_ = <span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-keyword">linker_ctor_function_t</span>*&gt;(load_bias + d-&gt;d_un.d_ptr);<br>  <span class="hljs-keyword">break</span>;<br><br><span class="hljs-keyword">case</span> DT_INIT_ARRAYSZ:<br>  init_array_count_ = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">uint32_t</span>&gt;(d-&gt;d_un.d_val) / <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-built_in">ElfW</span>(Addr));<br>  <span class="hljs-keyword">break</span>;<br>........<br>&#125;<br></code></pre></td></tr></table></figure><p>call_functionå®ç°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-function"><span class="hljs-title">call_function</span>(<span class="hljs-params"><span class="hljs-keyword">const</span> char* function_name __unused,</span></span><br><span class="hljs-params"><span class="hljs-function">                          linker_ctor_function_t <span class="hljs-keyword">function</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                          <span class="hljs-keyword">const</span> char* realpath __unused</span>)</span> &#123;<br> ......<br>    <br>  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">g_argc, g_argv, g_envp</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>call_arrayå®ç°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> F&gt;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">call_array</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* array_name __unused,F* functions, <span class="hljs-keyword">size_t</span> count,</span></span><br><span class="hljs-params"><span class="hljs-function">                       <span class="hljs-keyword">bool</span> reverse,</span></span><br><span class="hljs-params"><span class="hljs-function">                       <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* realpath)</span> </span>&#123; <br>  <br>  <span class="hljs-keyword">int</span> begin = reverse ? (count - <span class="hljs-number">1</span>) : <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">int</span> end = reverse ? <span class="hljs-number">-1</span> : count;<br>  <span class="hljs-keyword">int</span> step = reverse ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = begin; i != end; i += step) &#123;<br>    <span class="hljs-built_in">call_function</span>(<span class="hljs-string">&quot;function&quot;</span>, functions[i], realpath);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>call_arrayæœ€ç»ˆéå†æ‰€æœ‰<code>DT_INIT_ARRAY</code>çš„åœ°å€åè°ƒç”¨<code>call_function</code>æ–¹æ³•æ‰§è¡Œã€‚</p><p>æ‰€ä»¥å¯¹äº<code>_init</code>å’Œ<code>construcor</code>æ–¹æ³•çš„HOOKæ—¶æœºï¼Œå¯ä»¥é€‰æ‹©<code>call_function</code>æ–¹æ³•(SOå·²å®ŒæˆåŠ è½½,_initã€construcorè¿˜æœªæ‰§è¡Œ)</p><h3 id="Native-load-so"><a href="#Native-load-so" class="headerlink" title="Native load so"></a>Native load so</h3><p>native <code>dlopen</code>çš„å®ç°åœ¨<code> /bionic/libdl/libdl.cpp</code>ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">__attribute__((__weak__))<br><span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">dlopen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, <span class="hljs-keyword">int</span> flag)</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>* caller_addr = __builtin_return_address(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> __loader_dlopen(filename, flag, caller_addr);<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆä¼šè°ƒç”¨<code>/bionic/linker/linker.cpp</code>ä¸­çš„<code>do_dlopen</code>æ–¹æ³•ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>javaå±‚loadsoæ‰§è¡Œæ–¹æ³•é¡ºåº <code>_init--&gt;constructor--&gt;JNI_OnLoad</code></li><li>NDKå¼€å‘dlopenæ–¹æ³•loadsoæ‰§è¡Œæ–¹æ³•é¡ºåº <code>_init--&gt;constructor</code></li><li>æ— è®ºJavaå±‚è¿˜æ˜¯NDKå¼€å‘ä¸­çš„dlopenæœ€ç»ˆéƒ½ä¼šè°ƒç”¨linkerçš„<code>do_dlopen</code>æ–¹æ³•</li><li>å¯ä»¥é€‰æ‹©<code>OpenNativeLibrary</code>ã€<code>call_function</code>å®Œæˆå¯¹<code>JNI_OnLoad</code>ã€<code>_init</code>ã€<code>constructor</code>æ–¹æ³•çš„HOOK</li></ul>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JDBè°ƒè¯•APP</title>
    <link href="/2021/08/22/JDB%E8%B0%83%E8%AF%95APP/"/>
    <url>/2021/08/22/JDB%E8%B0%83%E8%AF%95APP/</url>
    
    <content type="html"><![CDATA[<h2 id="1-ä»¥è°ƒè¯•æ¨¡å¼è¿è¡ŒAPP"><a href="#1-ä»¥è°ƒè¯•æ¨¡å¼è¿è¡ŒAPP" class="headerlink" title="1. ä»¥è°ƒè¯•æ¨¡å¼è¿è¡ŒAPP"></a>1. ä»¥è°ƒè¯•æ¨¡å¼è¿è¡ŒAPP</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">adb <span class="hljs-keyword">shell</span> <span class="hljs-keyword">am</span> start -D  <span class="hljs-keyword">com</span>.cola.jni/<span class="hljs-keyword">com</span>.cola.jni.MainActivity<br></code></pre></td></tr></table></figure><h2 id="2-è½¬å‘ç«¯å£åˆ°æœ¬åœ°"><a href="#2-è½¬å‘ç«¯å£åˆ°æœ¬åœ°" class="headerlink" title="2.è½¬å‘ç«¯å£åˆ°æœ¬åœ°"></a>2.è½¬å‘ç«¯å£åˆ°æœ¬åœ°</h2><p>ä½¿ç”¨<code>DDMS</code>è½¬å‘ç«¯å£</p> <img src="/2021/08/22/JDB%E8%B0%83%E8%AF%95APP/images/ddms.png" class=""><p>æˆ–è€…é€šè¿‡<code>adb</code>è½¬å‘åˆ°æœ¬åœ°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">adb jdwp  <span class="hljs-comment">#è·å–å¯è°ƒè¯•APP PID(åˆ¤æ–­ç›®æ ‡APPæ˜¯å¦å¯è°ƒè¯•ï¼Œå°†ro.debuggableè®¾ä¸º1å¯è°ƒè¯•æ‰€æœ‰APP)</span><br>adb forward tcp:<span class="hljs-number">8700</span> jdwp:$jdwp_pid<br></code></pre></td></tr></table></figure><h2 id="JDBé™„åŠ "><a href="#JDBé™„åŠ " class="headerlink" title="JDBé™„åŠ "></a>JDBé™„åŠ </h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">jdb -connect com<span class="hljs-selector-class">.sun</span><span class="hljs-selector-class">.jdi</span><span class="hljs-selector-class">.SocketAttach</span>:hostname=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>,port=<span class="hljs-number">8700</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>jdb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AOSPå¯¼å…¥IDE</title>
    <link href="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/"/>
    <url>/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/</url>
    
    <content type="html"><![CDATA[<h2 id="Javaä»£ç å¯¼å…¥-Android-Studio"><a href="#Javaä»£ç å¯¼å…¥-Android-Studio" class="headerlink" title="Javaä»£ç å¯¼å…¥ Android Studio"></a>Javaä»£ç å¯¼å…¥ Android Studio</h2><h3 id="1-source-build-envsetup-sh"><a href="#1-source-build-envsetup-sh" class="headerlink" title="1.source build/envsetup.sh"></a>1.source build/envsetup.sh</h3><h3 id="2-ç¼–è¯‘ç”Ÿæˆ-idegen-jar"><a href="#2-ç¼–è¯‘ç”Ÿæˆ-idegen-jar" class="headerlink" title="2.ç¼–è¯‘ç”Ÿæˆ idegen.jar"></a>2.ç¼–è¯‘ç”Ÿæˆ idegen.jar</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mmm development<span class="hljs-regexp">/tools/i</span>degen/ <br></code></pre></td></tr></table></figure><p>è¿è¡Œå®Œæ¯•ä¸Šé¢çš„å‘½ä»¤ä¹‹åï¼Œå°±åœ¨æ ¹ç›®å½•ç”Ÿæˆäº†2ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">android.ipr </span>å’Œ <span class="hljs-keyword">android.iml</span><br></code></pre></td></tr></table></figure><h3 id="3-æ’é™¤ä¸å¿…è¦çš„æ¨¡å—ï¼Œæé«˜åŠ è½½é€Ÿåº¦"><a href="#3-æ’é™¤ä¸å¿…è¦çš„æ¨¡å—ï¼Œæé«˜åŠ è½½é€Ÿåº¦" class="headerlink" title="3.æ’é™¤ä¸å¿…è¦çš„æ¨¡å—ï¼Œæé«˜åŠ è½½é€Ÿåº¦"></a>3.æ’é™¤ä¸å¿…è¦çš„æ¨¡å—ï¼Œæé«˜åŠ è½½é€Ÿåº¦</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">æ‰“å¼€<span class="hljs-keyword">android.iml, </span>æ‰¾åˆ°excludeFolderå±æ€§,åªæ·»åŠ framework<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/abi&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/art&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/bionic&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/bootable&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/build&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/cts&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/dalvik&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/developers&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/development&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/device&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/docs&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/external&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/hardware&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/libcore&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/libnativehelper&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/ndk&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/out&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/pdk&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/prebuilts&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/sdk&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/system&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/tools&quot;</span>/&gt;<br>&lt;excludeFolder <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$MODULE_DIR</span>$/kernel&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h3 id="4-ä½¿ç”¨Android-Studioç›´æ¥android-ipræ–‡ä»¶"><a href="#4-ä½¿ç”¨Android-Studioç›´æ¥android-ipræ–‡ä»¶" class="headerlink" title="4.ä½¿ç”¨Android Studioç›´æ¥android.ipræ–‡ä»¶"></a>4.ä½¿ç”¨Android Studioç›´æ¥android.ipræ–‡ä»¶</h3><h3 id="5-å­˜åœ¨é—®é¢˜"><a href="#5-å­˜åœ¨é—®é¢˜" class="headerlink" title="5.å­˜åœ¨é—®é¢˜"></a>5.å­˜åœ¨é—®é¢˜</h3><p>æ‰“å¼€çš„Javaä»£ç ï¼ŒæŸ¥çœ‹é›†æˆå…³ç³»æˆ–è€…è°ƒç”¨å…³ç³»çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä¼šè·³è½¬åˆ°.classæ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯ç›¸åº”çš„Javaç±»?</p><h4 id="5-1-åˆ é™¤å¤šä½™çš„JDKå’ŒSDK"><a href="#5-1-åˆ é™¤å¤šä½™çš„JDKå’ŒSDK" class="headerlink" title="5.1 åˆ é™¤å¤šä½™çš„JDKå’ŒSDK"></a>5.1 åˆ é™¤å¤šä½™çš„JDKå’ŒSDK</h4> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/%E5%88%A0%E9%99%A4%E5%A4%9A%E4%BD%99%E7%9A%84JDK%E5%92%8CSDK.png" class=""><h4 id="5-2æ·»åŠ JDK"><a href="#5-2æ·»åŠ JDK" class="headerlink" title="5.2æ·»åŠ JDK"></a>5.2æ·»åŠ JDK</h4> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/%E6%B7%BB%E5%8A%A0sdk.png" class=""><h4 id="5-3åˆ é™¤JDKä¸­Classpathå’ŒSourcepathä¸­çš„å†…å®¹"><a href="#5-3åˆ é™¤JDKä¸­Classpathå’ŒSourcepathä¸­çš„å†…å®¹" class="headerlink" title="5.3åˆ é™¤JDKä¸­Classpathå’ŒSourcepathä¸­çš„å†…å®¹"></a>5.3åˆ é™¤JDKä¸­Classpathå’ŒSourcepathä¸­çš„å†…å®¹</h4> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/%E5%88%A0%E9%99%A4Classpath.png" class=""><h4 id="5-4-åˆ é™¤SDKä¸­Classpathå’ŒSourcepathä¸­çš„å†…å®¹"><a href="#5-4-åˆ é™¤SDKä¸­Classpathå’ŒSourcepathä¸­çš„å†…å®¹" class="headerlink" title="5.4 åˆ é™¤SDKä¸­Classpathå’ŒSourcepathä¸­çš„å†…å®¹"></a>5.4 åˆ é™¤SDKä¸­Classpathå’ŒSourcepathä¸­çš„å†…å®¹</h4> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/%E5%88%A0%E9%99%A4Sourcepath.png" class=""><h4 id="5-5-é…ç½®Modules"><a href="#5-5-é…ç½®Modules" class="headerlink" title="5.5 é…ç½®Modules"></a>5.5 é…ç½®Modules</h4> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/%E9%85%8D%E7%BD%AEModules.png" class=""><h4 id="5-6æŠŠframeworkæ·»åŠ åˆ°Dependenciesä¸­"><a href="#5-6æŠŠframeworkæ·»åŠ åˆ°Dependenciesä¸­" class="headerlink" title="5.6æŠŠframeworkæ·»åŠ åˆ°Dependenciesä¸­"></a>5.6æŠŠframeworkæ·»åŠ åˆ°Dependenciesä¸­</h4> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/framework%E6%B7%BB%E5%8A%A0%E5%88%B0Dependencies1.png" class=""><ul><li></li></ul> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/framework%E6%B7%BB%E5%8A%A0%E5%88%B0Dependencies2.png" class=""><ul><li></li></ul> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/framework%E6%B7%BB%E5%8A%A0%E5%88%B0Dependencies3.png" class=""><ul><li></li></ul> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/framework%E6%B7%BB%E5%8A%A0%E5%88%B0Dependencies4.png" class=""><h4 id="5-7-ç¡®å®šProject-SDKé€‰æ‹©æ­£ç¡®"><a href="#5-7-ç¡®å®šProject-SDKé€‰æ‹©æ­£ç¡®" class="headerlink" title="5.7 ç¡®å®šProject SDKé€‰æ‹©æ­£ç¡®"></a>5.7 ç¡®å®šProject SDKé€‰æ‹©æ­£ç¡®</h4> <img src="/2021/08/22/AOSP%E5%AF%BC%E5%85%A5IDE/images/%E7%A1%AE%E5%AE%9AProjectSDK.png" class=""><h2 id="Nativeä»£ç å¯¼å…¥CLion"><a href="#Nativeä»£ç å¯¼å…¥CLion" class="headerlink" title="Nativeä»£ç å¯¼å…¥CLion"></a>Nativeä»£ç å¯¼å…¥CLion</h2><h3 id="1-æ‰“å¼€å¼€å…³ï¼Œç¼–è¯‘æ—¶ç”ŸæˆCMakeLists-txt"><a href="#1-æ‰“å¼€å¼€å…³ï¼Œç¼–è¯‘æ—¶ç”ŸæˆCMakeLists-txt" class="headerlink" title="1.æ‰“å¼€å¼€å…³ï¼Œç¼–è¯‘æ—¶ç”ŸæˆCMakeLists.txt"></a>1.æ‰“å¼€å¼€å…³ï¼Œç¼–è¯‘æ—¶ç”ŸæˆCMakeLists.txt</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">SOONG_GEN_CMAKEFILES</span>=1<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">SOONG_GEN_CMAKEFILES_DEBUG</span>=1<br></code></pre></td></tr></table></figure><h3 id="2-ç¼–è¯‘"><a href="#2-ç¼–è¯‘" class="headerlink" title="2.ç¼–è¯‘"></a>2.ç¼–è¯‘</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">make</span> -j<span class="hljs-number">16</span><br></code></pre></td></tr></table></figure><h3 id="3-ç”ŸæˆCMakeLists-txt"><a href="#3-ç”ŸæˆCMakeLists-txt" class="headerlink" title="3.ç”ŸæˆCMakeLists.txt"></a>3.ç”ŸæˆCMakeLists.txt</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">out<span class="hljs-regexp">/development/i</span>de<span class="hljs-regexp">/clion/</span>xxxx<br></code></pre></td></tr></table></figure><h3 id="4-åˆ›å»ºCMakeLists-txtç”¨äºåˆå¹¶"><a href="#4-åˆ›å»ºCMakeLists-txtç”¨äºåˆå¹¶" class="headerlink" title="4. åˆ›å»ºCMakeLists.txtç”¨äºåˆå¹¶"></a>4. åˆ›å»ºCMakeLists.txtç”¨äºåˆå¹¶</h3><p><code>åœ¨clionç›®å½•ä¸‹åˆ›å»ºCMakeLists.txt</code></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">cmake_minimum_required</span><span class="hljs-params">(VERSION <span class="hljs-number">3.6</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">project</span><span class="hljs-params">(AOSP-Native)</span></span><br><br><span class="hljs-comment">//ç”¨åˆ°äº†å“ªä¸ªæ¨¡å—å†å¯¼å…¥å³å¯ï¼Œè¦ä¿è¯æ”¹ç›®å½•ä¸‹æœ‰CMakeLists.txt</span><br><span class="hljs-comment">// æ·»åŠ å­æ¨¡å—ï¼Œå¯¼å…¥äº†éƒ¨åˆ†å·¥ç¨‹</span><br><span class="hljs-function"><span class="hljs-title">add_subdirectory</span><span class="hljs-params">(frameworks/native)</span></span><br>.......<br></code></pre></td></tr></table></figure><h3 id="5-CLionå¯¼å…¥"><a href="#5-CLionå¯¼å…¥" class="headerlink" title="5. CLionå¯¼å…¥"></a>5. CLionå¯¼å…¥</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> æ‰“å¼€CLion<br><span class="hljs-bullet">2.</span> é€‰æ‹©ã€Œopen xxxxxxã€<br><span class="hljs-bullet">3.</span> æŒ‡å®šåŒ…å« CMakeLists.txt çš„ç›®å½•out/development/ide/clion<br><span class="hljs-bullet">4.</span> é€‰æ‹©ã€ŒOpen Existing Projectã€<br></code></pre></td></tr></table></figure><h3 id="6-æ›´æ”¹å·¥ç¨‹æ ¹ç›®å½•"><a href="#6-æ›´æ”¹å·¥ç¨‹æ ¹ç›®å½•" class="headerlink" title="6.æ›´æ”¹å·¥ç¨‹æ ¹ç›®å½•"></a>6.æ›´æ”¹å·¥ç¨‹æ ¹ç›®å½•</h3><p>è®¾ç½®rootä¸ºaospæºç æ ¹ç›®å½•</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xl">T<span class="hljs-function"><span class="hljs-title">ools</span> -&gt;</span> CM<span class="hljs-function"><span class="hljs-title">ake</span> -&gt;</span> Change Project Root<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://www.jianshu.com/p/<span class="hljs-number">2</span>ba<span class="hljs-number">5</span>d<span class="hljs-number">6</span>bd<span class="hljs-number">461</span>e<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>rom</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android SOåº“ä¸æºç å¯¹åº”å…³ç³»</title>
    <link href="/2021/08/22/Android-so%E5%BA%93%E4%B8%8E%E6%BA%90%E7%A0%81%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB/"/>
    <url>/2021/08/22/Android-so%E5%BA%93%E4%B8%8E%E6%BA%90%E7%A0%81%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB/</url>
    
    <content type="html"><![CDATA[<ul><li><p>libandroid.so     <code>frameworks/base/native/android</code></p></li><li><p>libandroid_runtime.so    <code>frameworks/base/core/jni</code></p></li><li><p>libandroidfw.so    <code>frameworks/base/libs/androidfw</code></p></li><li><p>libaudioutils.so    <code>system/media/audio_utils</code></p></li><li><p>libbinder.so    <code>frameworks/native/libs/binder</code></p></li><li><p>libbluedroid.so    <code>system/bluetooth/bluedroid</code></p></li><li><p>libc.so    <code>bionic/libc</code></p></li><li><p>libcamera_client.so    <code>frameworks/av/camera</code></p></li><li><p>libcorkscrew.so    <code>system/core/libcorkscrew</code></p></li><li><p>libcpustats.so    <code>frameworks/native/libs/cpustats</code></p></li><li><p>libcrypto.so    <code>external/openssl</code></p></li><li><p>libcutils.so    <code>system/core/libcutils</code></p></li><li><p>libdbus.so    <code>external/dbus/dbus</code></p></li><li><p>libdvm.so    <code>dalvik/vm</code></p></li><li><p>libart.so    <code>art/runtime</code></p></li><li><p>libemoji.so    <code>frameworks/opt/emoji</code></p></li><li><p>libETC1.so    <code>frameworks/native/opengl/libs</code></p></li><li><p>libgccdemangle    <code>external/gcc-demangle</code></p></li><li><p>libgui.so    <code>frameworks/native/libs/gui</code></p></li><li><p>libgabi++.so    <code>abi/cpp</code></p></li><li><p>libGLESv1_CM.so    <code>frameworks/native/opengl/libs</code></p></li><li><p>libharfbuzz.so    <code>external/harfbuzz</code></p></li><li><p>libhwui.so    <code>frameworks/base/libs/hwui</code></p></li><li><p>libhardware_legacy.so    <code>hardware/libhardware_legacy</code></p></li><li><p>libjpeg.so    <code>external/jpeg</code></p></li><li><p>libmedia.so    <code>frameworks/av/media/libmedia</code></p></li><li><p>libmedia_native.so    <code>frameworks/av/media/libmedia_native</code></p></li><li><p>libnetutils.so    <code>system/core/libnetutils</code></p></li><li><p>libstagefright_foundation.so    <code>frameworks/av/media/libstagefright/foundation</code></p></li><li><p>libsonivox.so    <code>external/sonivox</code></p></li><li><p>libspeexresampler    <code>external/speex</code></p></li><li><p>libstlport.so    <code>external/stlport</code></p></li><li><p>libssl.so    <code>external/openssl</code></p></li><li><p>libui.so    <code>frameworks/native/libs/ui</code></p></li><li><p>libutils.so    <code>frameworks/native/libs/utils</code></p></li><li><p>libusbhost.so    <code>system/core/libusbhost</code></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Magiskå¼€å¯ro.debuggableè°ƒè¯•</title>
    <link href="/2021/08/22/Magisk%E5%BC%80%E5%90%AFro-debuggable%E8%B0%83%E8%AF%95/"/>
    <url>/2021/08/22/Magisk%E5%BC%80%E5%90%AFro-debuggable%E8%B0%83%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">magisk resetprop ro.debuggable <span class="hljs-number">1</span><br><span class="hljs-comment">#æŸ¥çœ‹ro.debuggable</span><br>getprop ro.debuggable<br><span class="hljs-comment">#é‡å¯</span><br>stop;start<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>magisk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pixel XL AOSPæºç ç¼–è¯‘</title>
    <link href="/2021/08/22/pixel-XL-AOSP%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"/>
    <url>/2021/08/22/pixel-XL-AOSP%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/</url>
    
    <content type="html"><![CDATA[<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><ul><li>æ“ä½œç³»ç»Ÿ ï¼šè™šæ‹Ÿæœº ubuntu 16.04</li><li>å†…å­˜ ï¼š12G</li><li>ç¡¬ç›˜ ï¼š150G</li><li>CPU ï¼š4æ ¸</li></ul><h2 id="ç¼–è¯‘è¿‡ç¨‹"><a href="#ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="ç¼–è¯‘è¿‡ç¨‹"></a>ç¼–è¯‘è¿‡ç¨‹</h2><h3 id="1-æºç åˆ†æ”¯è·å–"><a href="#1-æºç åˆ†æ”¯è·å–" class="headerlink" title="1. æºç åˆ†æ”¯è·å–"></a>1. æºç åˆ†æ”¯è·å–</h3><p>æ ¹æ®æ‰‹æœºå‹å·ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬ï¼Œé€šè¿‡ä»¥ä¸‹ç½‘ç«™è·å–pixel XL android 10ç‰ˆæœ¬çš„æºç æ ‡è®° android-10.0.0_r17</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://source.android.com/setup/start/build-numbers#source-code-tags-and-builds<br></code></pre></td></tr></table></figure> <img src="/2021/08/22/pixel-XL-AOSP%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/images/%E6%BA%90%E7%A0%81%E5%88%86%E6%94%AF%E8%8E%B7%E5%8F%96.png" class=""><h3 id="2-ä¸‹è½½androidæºç "><a href="#2-ä¸‹è½½androidæºç " class="headerlink" title="2.ä¸‹è½½androidæºç "></a>2.ä¸‹è½½androidæºç </h3><p>repo</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">sudo apt-get install git-core<br>sudo apt-get install git-core curl<br>mkdir ~/<span class="hljs-built_in">bin</span>/<br>cd ~/<span class="hljs-built_in">bin</span><br><br>curl https://mirrors.tuna.tsinghua.edu.cn/git/git-repo &gt; ~/<span class="hljs-built_in">bin</span>/repo<br>chmod a+x ~/<span class="hljs-built_in">bin</span>/repo<br>gedit ~/.bashrc<br></code></pre></td></tr></table></figure><p>åœ¨~/.bashrcé‡Œæ·»åŠ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#å›½å†…é•œåƒ</span><br>export REPO_URL=<span class="hljs-string">&#x27;https://aosp.tuna.tsinghua.edu.cn/git-repo&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="3-åŒæ­¥ä»£ç "><a href="#3-åŒæ­¥ä»£ç " class="headerlink" title="3. åŒæ­¥ä»£ç "></a>3. åŒæ­¥ä»£ç </h3><h4 id="3-1-ç¬¬ä¸€ç§æ–¹å¼"><a href="#3-1-ç¬¬ä¸€ç§æ–¹å¼" class="headerlink" title="3.1 ç¬¬ä¸€ç§æ–¹å¼"></a>3.1 ç¬¬ä¸€ç§æ–¹å¼</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">cd ~/work/sources/android-<span class="hljs-number">10.0</span><span class="hljs-number">.0</span>_r17<br>repo init -u https://aosp.tuna.tsinghua.edu.cn/platform/manifest -b android-<span class="hljs-number">10.0</span><span class="hljs-number">.0</span>_r17<br>repo sync -c --no-tags --prune -f -j4  <span class="hljs-comment">#çº¿ç¨‹æ ¹æ®cpuæ ¸æ•°å†³å®š ä¸€èˆ¬ä¸ºcpuæ ¸æ•°x2ï¼Œæ­¤å¤„é‡‡ç”¨4çº¿ç¨‹</span><br></code></pre></td></tr></table></figure><p>å‚æ•°ä»‹ç»:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs //å‚æ•°è¯´æ˜">-c, --current-branch fetch only current branch from server.<br>è¿™ä¸ªé€‰é¡¹æŒ‡å®šåªè·å–æ‰§è¡Œ repo init æ—¶ -b é€‰é¡¹æ‰€æŒ‡å®šçš„åˆ†æ”¯ï¼Œä¸ä¼šè·å–è¿œç«¯æœåŠ¡å™¨çš„åˆ†æ”¯ä¿¡æ¯ã€‚<br>ä¾‹å¦‚æœåŠ¡å™¨ä¸Šæ–°å¢äº†å…¶ä»–åˆ†æ”¯ï¼Œä½¿ç”¨ -c é€‰é¡¹åŒæ­¥åï¼Œåœ¨æœ¬åœ° git ä»“åº“æ‰§è¡Œ git branch -r å‘½ä»¤çœ‹ä¸åˆ°æœåŠ¡å™¨æ–°å¢çš„åˆ†æ”¯åã€‚å¦‚æœä¸åŠ  -c é€‰é¡¹ï¼Œé‚£ä¹ˆåŒæ­¥çš„æ—¶å€™ï¼Œä¼šæ‰“å° [new branch] è¿™æ ·çš„ä¿¡æ¯ï¼Œä½¿ç”¨ git branch -r å‘½ä»¤å¯æŸ¥çœ‹åˆ°æœåŠ¡å™¨æ–°å¢çš„åˆ†æ”¯ã€‚<br><br>â€“no-tags donâ€™t fetch tags.<br>è¯¥é€‰é¡¹æŒ‡å®šä¸è·å–æœåŠ¡å™¨ä¸Šçš„tagä¿¡æ¯ã€‚<br><br>â€“prune delete refs that no longer exist on the remote.<br>å¦‚æœè¿œç«¯æœåŠ¡å™¨å·²ç»åˆ é™¤äº†æŸä¸ªåˆ†æ”¯ï¼Œåœ¨ repo sync æ—¶åŠ ä¸Š --prune é€‰é¡¹ï¼Œå¯ä»¥è®©æœ¬åœ°ä»“åº“åˆ é™¤å¯¹è¿™ä¸ªåˆ†æ”¯çš„è·Ÿè¸ªå¼•ç”¨ã€‚<br><br>-j JOBS, --jobs=JOBS projects to fetch simultaneously (default 2).<br>æŒ‡å®šå¯ç”¨å¤šå°‘ä¸ªçº¿ç¨‹æ¥åŒæ­¥ã€‚<br>ä¾‹å¦‚ä¸Šé¢çš„ -j 4 æŒ‡å®šç”¨4ä¸ªçº¿ç¨‹æ¥åŒæ­¥ã€‚å¦‚æœæ²¡æœ‰æä¾›è¯¥é€‰é¡¹ï¼Œé»˜è®¤æ˜¯ç”¨2ä¸ªçº¿ç¨‹ã€‚<br><br>-fï¼šå³ä½¿æŸä¸ªé¡¹ç›®åŒæ­¥å¤±è´¥ï¼Œä¹Ÿç»§ç»­åŒæ­¥å…¶ä»–é¡¹ç›®ã€‚<br><br>æ€»çš„æ¥è¯´ï¼Œåœ¨ repo sync -c --no-tags --prune -j 4 å‘½ä»¤ä¸­ï¼Œä½¿ç”¨ -c å’Œ --no-tags é€‰é¡¹å¯ä»¥å‡å°‘éœ€è¦åŒæ­¥çš„å†…å®¹ï¼Œä»è€Œå‡å°‘è¦å ç”¨çš„æœ¬åœ°ä»£ç ç©ºé—´ï¼Œä¹Ÿå¯ä»¥å‡å°‘ä¸€äº›åŒæ­¥æ—¶é—´ã€‚<br>ä½¿ç”¨ -j é€‰é¡¹æ¥æŒ‡å®šå¯ç”¨å¤šçº¿ç¨‹è¿›è¡ŒåŒæ­¥ï¼Œå¯ä»¥åŠ å¿«æ‰§è¡Œé€Ÿåº¦ï¼Œä¹Ÿå°±å‡å°‘äº†åŒæ­¥æ—¶é—´ã€‚<br>ä½¿ç”¨ --prune é€‰é¡¹å»æ‰å·²åˆ é™¤åˆ†æ”¯çš„è·Ÿè¸ªå¼•ç”¨ï¼Œä¸€èˆ¬ä¸ä¼šç”¨åˆ°ï¼Œè¿™ä¸ªé€‰é¡¹å¯åŠ å¯ä¸åŠ ã€‚<br></code></pre></td></tr></table></figure><h4 id="3-1-ç¬¬äºŒç§æ–¹å¼-æœªå°è¯•æ­¤æ–¹æ³•ä¸çŸ¥é“æ˜¯å¦å¯è¡Œ"><a href="#3-1-ç¬¬äºŒç§æ–¹å¼-æœªå°è¯•æ­¤æ–¹æ³•ä¸çŸ¥é“æ˜¯å¦å¯è¡Œ" class="headerlink" title="3.1 ç¬¬äºŒç§æ–¹å¼(æœªå°è¯•æ­¤æ–¹æ³•ä¸çŸ¥é“æ˜¯å¦å¯è¡Œ)"></a>3.1 ç¬¬äºŒç§æ–¹å¼(æœªå°è¯•æ­¤æ–¹æ³•ä¸çŸ¥é“æ˜¯å¦å¯è¡Œ)</h4><p>ä¸‹è½½æºç çš„åˆå§‹åŒ–åŒ…ï¼ˆåŠ é€Ÿæºç ä¸‹è½½ï¼‰ å¤§çº¦60G</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="hljs-regexp">/aosp-monthly/</span>aosp-latest.tar<br></code></pre></td></tr></table></figure><p>è§£å‹ç¼©,è§£å‹ç¼©å®Œæˆä¹‹åä¼šå¤šå‡ºæ¥~/aospç›®å½•<br>åˆ‡è¿›å»</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">tar</span> zxvf aosp-latest.tar<br></code></pre></td></tr></table></figure><p>cd  aosp </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">repo init -u https://aosp.tuna.tsinghua.edu.cn/platform/manifest -b android-<span class="hljs-number">10.0</span><span class="hljs-number">.0</span>_r17<br>repo sync -c --no-tags --prune -f -j4  <span class="hljs-comment">#çº¿ç¨‹æ ¹æ®cpuæ ¸æ•°å†³å®š ä¸€èˆ¬ä¸ºcpuæ ¸æ•°x2ï¼Œæ­¤å¤„é‡‡ç”¨4çº¿ç¨‹</span><br></code></pre></td></tr></table></figure><h3 id="4-é©±åŠ¨ä¸‹è½½"><a href="#4-é©±åŠ¨ä¸‹è½½" class="headerlink" title="4. é©±åŠ¨ä¸‹è½½"></a>4. é©±åŠ¨ä¸‹è½½</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>developers.google.com<span class="hljs-regexp">/android/</span>drivers<span class="hljs-comment">#sailfishqp1a.190711.020</span><br></code></pre></td></tr></table></figure><p>ä¸‹è½½google_devices-sailfish-qp1a.191005.007.a3-a1615a0f.tgz</p><p>qcom-sailfish-qp1a.191005.007.a3-191228fe.tgz<br>ä¸¤ä¸ªå‹ç¼©åŒ…ï¼Œ191005.007.a3ä¸ºå½“æ—¶æœ€æ–°ç‰ˆæœ¬é©±åŠ¨</p> <img src="/2021/08/22/pixel-XL-AOSP%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/images/%E9%A9%B1%E5%8A%A8%E4%B8%8B%E8%BD%BD.png" class=""><p>ä¸‹è½½å®Œæˆåè§£å‹ä¼šè·å¾—ä¸¤ä¸ª.shè„šæœ¬æ–‡ä»¶ï¼Œè¿è¡Œä¸¤ä¸ªè„šæœ¬åä¼šç”Ÿæˆvendoræ–‡ä»¶å¤¹ï¼Œå°†vendoræ–‡ä»¶å¤¹æ‹·è´åˆ°<strong>æºç æ ¹ç›®å½•</strong>ä¸‹</p><h3 id="5-ç¼–è¯‘ç¯å¢ƒ"><a href="#5-ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="5. ç¼–è¯‘ç¯å¢ƒ"></a>5. ç¼–è¯‘ç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install git-core openjdk-8-jdk gnupg flex bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev ccache libxml2-utils xsltproc unzip<br></code></pre></td></tr></table></figure><h3 id="6-ç¼–è¯‘è„šæœ¬å‡†å¤‡"><a href="#6-ç¼–è¯‘è„šæœ¬å‡†å¤‡" class="headerlink" title="6. ç¼–è¯‘è„šæœ¬å‡†å¤‡"></a>6. ç¼–è¯‘è„šæœ¬å‡†å¤‡</h3><p>è¿›å»æºç æ ¹ç›®å½•ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">source ./build/envsetup.sh <br>lunch aosp_sailfish-userdebug <span class="hljs-comment">#ä¹Ÿå¯ä»¥å‘½ä»¤è¡Œlunchå›è½¦ç¨ç­‰ç‰‡åˆ»è¾“å…¥ ç„¶åè¾“å…¥15å³å¯</span><br><br><span class="hljs-comment">#è°ƒæ•´ä¸€ä¸ªJavaå‚æ•°ï¼Œè¦ä¸ç„¶ä¼šå‡ºç°Java OOMé”™è¯¯</span><br>export JACK_SERVER_VM_ARGUMENTS=<span class="hljs-string">&quot;-Dfile.encoding=UTF-8 -XX:+TieredCompilation -Xmx4096m&quot;</span><br><br></code></pre></td></tr></table></figure><p>æ³¨: æˆ‘ä»¬å¯ä»¥åœ¨aosp/build/tools/buildinfo.sh  vendor_buildinfo.sh è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­ç›´æ¥ä¿®æ”¹æ‰‹æœºå“ç‰Œçš„åå­—,å‚å®¶ç­‰ä¿¡æ¯</p><h3 id="7-å¼€å§‹ç¼–è¯‘"><a href="#7-å¼€å§‹ç¼–è¯‘" class="headerlink" title="7. å¼€å§‹ç¼–è¯‘"></a>7. å¼€å§‹ç¼–è¯‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">make -j6   <span class="hljs-comment">#çº¿ç¨‹è§†é…ç½®è€Œå®š</span><br><br><span class="hljs-comment">#ç¼–è¯‘çš„ç»“æœåœ¨ ~/aosp/out/target/product/marlin æ–‡ä»¶å¤¹ä¸­</span><br><span class="hljs-comment">#æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ˜¯ï¼š</span><br><br>boot.img<br>recovery.img<br>ramdisk.img<br>system.img<br>userdata.img<br></code></pre></td></tr></table></figure><h3 id="8-åˆ·æœº"><a href="#8-åˆ·æœº" class="headerlink" title="8. åˆ·æœº"></a>8. åˆ·æœº</h3><p>å›åˆ°æºç æ ¹ç›®å½•ä¸‹è¾“å…¥</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">fastboot flashall -w</span><br></code></pre></td></tr></table></figure><p>æ³¨ lanchå‘½ä»¤ä¸ºæˆ‘ä»¬è®¾ç½®å¥½äº†ANDROID_PRODUCT_OUTå˜é‡çš„å€¼ä¸ºç¼–è¯‘æ–‡ä»¶ç›®å½•ç¡®ä¿å®ƒçš„å€¼å’Œç¼–è¯‘åé•œåƒè¾“å‡ºç›®å½•çš„è·¯å¾„å€¼ä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´çš„è¯ï¼Œé‡æ–°è®¾ç½®ANDROID_PRODUCT_OUTçš„å€¼ä¸ç¼–è¯‘åé•œåƒè¾“å‡ºç›®å½•è·¯å¾„å€¼ä¸€è‡´ã€‚ </p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="fastboot"><a href="#fastboot" class="headerlink" title="fastboot"></a>fastboot</h3><p>ä¸€ã€Fastboot</p><p>1.1 Recoveryæ¨¡å¼(å¡åˆ·)</p><p>åœ¨ç³»ç»Ÿè¿›è¡Œå®šåˆ¶æ—¶ï¼Œç¼–è¯‘ç³»ç»Ÿä¼šç¼–è¯‘å‡ºä¸€ä»½ZIPçš„å‹ç¼©åŒ…ï¼Œé‡Œé¢æ˜¯ä¸€äº›ç³»ç»Ÿåˆ†åŒºé•œåƒï¼Œæä¾›ç»™å®¢æˆ·è¿›è¡Œæ‰‹åŠ¨å‡çº§ã€æ¢å¤ç³»ç»Ÿã€‚éœ€è¦æå‰å°†å‹ç¼©åŒ…å†…ç½®SDcardï¼Œåœ¨Recoveryæ¨¡å¼è¿›è¡Œã€‚</p><p>è¿›å…¥Recoveryæ–¹æ³•ï¼šå°†æ‰‹æœºå®Œå…¨å…³æœºåï¼ŒæŒ‰ä½éŸ³é‡é”®ä¸‹(ä¸Š)+ç”µæºé”®ï¼Œè¿›å…¥BootLoaderç•Œé¢ã€‚ç”¨éŸ³é‡åŠ å‡æ¥æ§åˆ¶å…‰æ ‡ï¼Œç”µæºé”®æ¥è¿›è¡Œç¡®è®¤(æœ‰çš„æœºå™¨åªèƒ½ç”¨éŸ³é‡ä¸‹é”®è¿›è¡Œé€‰æ‹©ï¼Œä¸Šé”®æ˜¯ç¡®è®¤é”®)ã€‚è¯´æ˜ï¼šæœ‰çš„æœºå™¨å¯èƒ½æ²¡æœ‰é¢„è£…Recoveryã€‚</p><p>1.2 Recoveryæ¨¡å¼(çº¿åˆ·)</p><p>åœ¨å®‰å“æ‰‹æœºä¸­Fastbootæ˜¯ä¸€ç§æ¯”Recoveryæ›´åº•å±‚çš„åˆ·æœºæ¨¡å¼ã€‚ä½¿ç”¨USBæ•°æ®çº¿è¿æ¥æ‰‹æœºçš„ä¸€ç§åˆ·æœºæ¨¡å¼ã€‚è¿™å°±æ˜¯æ‰€è°“çš„çº¿åˆ·ï¼Œä¸Recoveryæ¨¡å¼ç›¸æ¯”Fastbootéœ€è¦æŒæ¡ä¸€äº›çƒ§æœºå‘½ä»¤ï¼Œå¯¹äºæŸäº›ç³»ç»Ÿå¡åˆ·æ¥è¯´ï¼Œçº¿åˆ·æ›´å¯é ï¼Œå®‰å…¨ã€‚</p><p>äºŒã€Androidç³»ç»Ÿåˆ†åŒºä»‹ç»</p><ul><li><p>bootloader     ç³»ç»Ÿå¼€æœºå¼•å¯¼ç±»ä¼¼ç”µè„‘BIOSï¼Œè¿™å—åˆ·é”™æ‰‹æœºå°±ä¼š<strong>å˜æˆç –</strong></p></li><li><p>radio     é€šè®¯æ¨¡å—ã€åŸºå¸¦ã€WIFIã€Bluetoothç­‰è¡”æ¥ç¡¬ä»¶çš„é©±åŠ¨è½¯ä»¶</p></li><li><p>recovery     ç³»ç»Ÿæ•…éšœæ—¶è´Ÿè´£æ¢å¤</p></li><li><p>boot     LinuxåµŒå…¥å¼ç³»ç»Ÿå†…æ ¸</p></li><li><p>system     ç³»ç»Ÿæ–‡ä»¶ã€åº”ç”¨</p></li><li><p>cache     ç³»ç»Ÿè¿è¡Œæ—¶äº§ç”Ÿçš„ç¼“å­˜</p></li><li><p>userdata     ç”¨æˆ·ä½¿ç”¨APPäº§ç”Ÿçš„ç¼“å­˜æ•°æ®</p></li></ul><h3 id="æ¨¡å—ç¼–è¯‘ä»‹ç»"><a href="#æ¨¡å—ç¼–è¯‘ä»‹ç»" class="headerlink" title="æ¨¡å—ç¼–è¯‘ä»‹ç»"></a>æ¨¡å—ç¼–è¯‘ä»‹ç»</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#é™¤äº†é€šè¿‡makeå‘½ä»¤ç¼–è¯‘å¯ä»¥æ•´ä¸ªandroidæºç å¤–,Googleä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†ç›¸åº”çš„å‘½ä»¤æ¥æ”¯æŒå•ç‹¬æ¨¡å—çš„ç¼–è¯‘.</span><br><span class="hljs-comment">#ç¼–è¯‘ç¯å¢ƒåˆå§‹åŒ–(å³æ‰§è¡Œsource build/envsetup.sh)ä¹‹å,æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›æœ‰ç”¨çš„æŒ‡ä»¤,é™¤äº†ä¸Šè¾¹ç”¨åˆ°çš„lunch,è¿˜æœ‰ä»¥ä¸‹:</span><br><br>  - croot: Changes directory to the top of the tree.<br>  - m: Makes <span class="hljs-keyword">from</span> the top of the tree.<br>  - mm: Builds <span class="hljs-built_in">all</span> of the modules <span class="hljs-keyword">in</span> the current directory.<br>  - mmm: Builds <span class="hljs-built_in">all</span> of the modules <span class="hljs-keyword">in</span> the supplied directories.<br>  - cgrep: Greps on <span class="hljs-built_in">all</span> local C/C++ files.<br>  - jgrep: Greps on <span class="hljs-built_in">all</span> local Java files.<br>  - resgrep: Greps on <span class="hljs-built_in">all</span> local res/*.xml files.<br>  - godir: Go to the directory containing a file.<br></code></pre></td></tr></table></figure><p>å…¶ä¸­mmmæŒ‡ä»¤å°±æ˜¯ç”¨æ¥ç¼–è¯‘æŒ‡å®šç›®å½•.é€šå¸¸æ¥è¯´,æ¯ä¸ªç›®å½•åªåŒ…å«ä¸€ä¸ªæ¨¡å—.æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬è¦ç¼–è¯‘Launcher2æ¨¡å—,æ‰§è¡ŒæŒ‡ä»¤:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mmm packages<span class="hljs-regexp">/apps/</span>Launcher2/<br></code></pre></td></tr></table></figure><p>ç¨ç­‰ä¸€ä¼šä¹‹å,å¦‚æœæç¤º:</p><p>make completed success fully </p><p>å³è¡¨ç¤ºç¼–è¯‘å®Œæˆ,æ­¤æ—¶åœ¨out/target/product/gereric/system/appå°±å¯ä»¥çœ‹åˆ°ç¼–è¯‘çš„Launcher2.apkæ–‡ä»¶äº†.</p><h3 id="é‡æ–°æ‰“åŒ…ç³»ç»Ÿé•œåƒ"><a href="#é‡æ–°æ‰“åŒ…ç³»ç»Ÿé•œåƒ" class="headerlink" title="é‡æ–°æ‰“åŒ…ç³»ç»Ÿé•œåƒ"></a>é‡æ–°æ‰“åŒ…ç³»ç»Ÿé•œåƒ</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">ç¼–è¯‘å¥½æŒ‡å®šæ¨¡å—å,å¦‚æœæˆ‘ä»¬æƒ³è¦å°†è¯¥æ¨¡å—å¯¹åº”çš„apké›†æˆåˆ°ç³»ç»Ÿé•œåƒä¸­,éœ€è¦å€ŸåŠ©<span class="hljs-keyword">make</span> snodæŒ‡ä»¤é‡æ–°æ‰“åŒ…ç³»ç»Ÿé•œåƒ,è¿™æ ·æˆ‘ä»¬æ–°ç”Ÿæˆçš„<span class="hljs-built_in">system</span>.imgä¸­å°±åŒ…å«äº†åˆšæ‰ç¼–è¯‘çš„Launcher2æ¨¡å—äº†.é‡å¯æœºå™¨ä¹‹åç”Ÿæ•ˆ.<br></code></pre></td></tr></table></figure><h3 id="å•ç‹¬å®‰è£…æ¨¡å—"><a href="#å•ç‹¬å®‰è£…æ¨¡å—" class="headerlink" title="å•ç‹¬å®‰è£…æ¨¡å—"></a>å•ç‹¬å®‰è£…æ¨¡å—</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">æˆ‘ä»¬åœ¨ä¸æ–­çš„ä¿®æ”¹æŸäº›æ¨¡å—,æ€»ä¸èƒ½æ¯æ¬¡ç¼–è¯‘å®Œæˆåéƒ½è¦é‡æ–°æ‰“åŒ…<span class="hljs-built_in">system</span>.img,ç„¶åé‡å¯æ‰‹æœºå§?æœ‰æ²¡æœ‰ä»€ä¹ˆç®€å•çš„æ–¹æ³•å‘¢?<br>åœ¨ç¼–è¯‘å®Œå,å€ŸåŠ©adb installå‘½ä»¤ç›´æ¥å°†ç”Ÿæˆçš„apkæ–‡ä»¶å®‰è£…åˆ°è®¾å¤‡ä¸Šå³å¯,ç›¸æ¯”ä½¿ç”¨<span class="hljs-keyword">make</span> snod,ä¼šèŠ‚çœå¾ˆå¤šäº‹ä»¶.<br></code></pre></td></tr></table></figure><h3 id="ç¼–è¯‘ç›®å½•ä»‹ç»"><a href="#ç¼–è¯‘ç›®å½•ä»‹ç»" class="headerlink" title="ç¼–è¯‘ç›®å½•ä»‹ç»"></a>ç¼–è¯‘ç›®å½•ä»‹ç»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs out/target/product/generic/system```ç›®å½•ä¸‹çš„å¸¸ç”¨ç›®å½•:"><br>- Androidç³»ç»Ÿè‡ªå¸¦çš„apkæ–‡ä»¶éƒ½åœ¨```out/target/product/generic/system/apk```ç›®å½•ä¸‹<br>- ä¸€äº›å¯æ‰§è¡Œæ–‡ä»¶(æ¯”å¦‚Cç¼–è¯‘çš„æ‰§è¡Œ),æ”¾åœ¨```out/target/product/generic/system/bin```ç›®å½•ä¸‹<br>- åŠ¨æ€é“¾æ¥åº“æ”¾åœ¨```out/target/product/generic/system/lib```ç›®å½•ä¸‹<br>- ç¡¬ä»¶æŠ½è±¡å±‚æ–‡ä»¶éƒ½æ”¾åœ¨```out/targer/product/generic/system/lib/hw```ç›®å½•ä¸‹<br><br>### æºç ç›®å½•ä»‹ç»<br><br>![](https://img2020.cnblogs.com/blog/2275974/202101/2275974-20210109203736099-1901913006.png)<br><br><br>![](https://img2020.cnblogs.com/blog/2275974/202101/2275974-20210109203759902-672469351.png)<br><br><br>### lunch åé¢çš„å‚æ•°ä»‹ç»<br><br></code></pre></td></tr></table></figure><p>lunch aosp_arm-eng</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><br>è¯¥å‘½ä»¤è¡¨ç¤ºé’ˆå¯¹æ¨¡æ‹Ÿå™¨è¿›è¡Œå®Œæ•´ç¼–è¯‘ï¼Œå¹¶ä¸”æ‰€æœ‰è°ƒè¯•åŠŸèƒ½å‡å¤„äºå¯ç”¨çŠ¶æ€ã€‚<br><br>å¦‚æœæ‚¨æ²¡æœ‰æä¾›ä»»ä½•å‚æ•°å°±è¿è¡Œå‘½ä»¤ï¼Œlunch å°†æç¤ºæ‚¨ä»èœå•ä¸­é€‰æ‹©ä¸€ä¸ªç›®æ ‡ã€‚<br><br>æ‰€æœ‰ç¼–è¯‘ç›®æ ‡éƒ½é‡‡ç”¨ BUILD-BUILDTYPE å½¢å¼ï¼Œå…¶ä¸­ BUILD æ˜¯è¡¨ç¤ºç‰¹å®šåŠŸèƒ½ç»„åˆçš„ä»£å·ã€‚<br><br>BUILDTYPE æ˜¯ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š<br><br><br>|<span class="hljs-string"> ç¼–è¯‘ç±»å‹  </span>|<span class="hljs-string"> ä½¿ç”¨æƒ…å†µ                                                     </span>|<br>|<span class="hljs-string"> --------- </span>|<span class="hljs-string"> ------------------------------------------------------------ </span>|<br>|<span class="hljs-string"> user      </span>|<span class="hljs-string"> é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ                                               </span>|<br>|<span class="hljs-string"> userdebug </span>|<span class="hljs-string"> ä¸â€œuserâ€ç±»ä¼¼ï¼Œä½†å…·æœ‰ root æƒé™å’Œå¯è°ƒè¯•æ€§ï¼›æ˜¯è¿›è¡Œè°ƒè¯•æ—¶çš„é¦–é€‰ç¼–è¯‘ç±»å‹ </span>|<br>|<span class="hljs-string"> eng       </span>|<span class="hljs-string"> engå…·æœ‰é¢å¤–è°ƒè¯•å·¥å…·çš„å¼€å‘é…ç½®                            </span>|<br><br>![](https://img2020.cnblogs.com/blog/2275974/202101/2275974-20210109203911293-1939592244.png)<br><br><br>![](https://img2020.cnblogs.com/blog/2275974/202101/2275974-20210109204041185-295820055.png)<br><br><br><br> <span class="hljs-comment">### å•ç‹¬åˆ·å…¥æŸä¸ª imgï¼š</span><br><br>fastbootåˆ·å…¥å‘½ä»¤æ ¼å¼ï¼šfastboot flash ç³»ç»Ÿåˆ†åŒº å¯¹åº”çš„name.img<br><br> ```shell<br>cd out/target/product/marlin<br>fastboot flash boot_a boot.img<br>fastboot flash boot_b boot.img<br>fastboot flash system system.img<br>fastboot flash system_b system_other.img<br>fastboot flash vendor vendor.img<br>fastboot flash userdata userdata.img<br>fastboot flash userdata data.img<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/wengliuhu/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">107979371</span> æºç ç›®å½•ä»‹ç»<br>https:<span class="hljs-regexp">//</span>developers.google.cn<span class="hljs-regexp">/android/im</span>ages<span class="hljs-comment">#marlin å®˜ç½‘åˆ·æœºåŒ…ï¼Œæ•‘ç –</span><br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/u012417380/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">73196722</span> lunchå‚æ•°ä»‹ç»<br>https:<span class="hljs-regexp">//</span>source.android.com<span class="hljs-regexp">/source/</span>building å®˜ç½‘åˆ·æœºæ•™ç¨‹<br>https:<span class="hljs-regexp">//</span>www.dazhuanlan.com<span class="hljs-regexp">/2019/</span><span class="hljs-number">12</span><span class="hljs-regexp">/09/</span><span class="hljs-number">5</span>dedf04e496e7  Android8 åˆ†åŒºè¡¨å˜åŒ–å’Œç›¸å…³ä¿¡æ¯<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>rom</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pixel XLå†…æ ¸ç¼–è¯‘</title>
    <link href="/2021/08/22/pixel-XL%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91/"/>
    <url>/2021/08/22/pixel-XL%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91/</url>
    
    <content type="html"><![CDATA[<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><ul><li>æ“ä½œç³»ç»Ÿ ï¼šè™šæ‹Ÿæœº ubuntu 16.04</li><li>å†…å­˜ ï¼š8G</li><li>ç¡¬ç›˜ ï¼š150G</li><li>CPU ï¼š4æ ¸</li></ul><h2 id="ç¼–è¯‘è¿‡ç¨‹"><a href="#ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="ç¼–è¯‘è¿‡ç¨‹"></a>ç¼–è¯‘è¿‡ç¨‹</h2><p>æ³¨ï¼š ç¼–è¯‘ç¯å¢ƒè§pixel XLæºç ç¼–è¯‘</p><h3 id="1-æºç åˆ†æ”¯è·å–"><a href="#1-æºç åˆ†æ”¯è·å–" class="headerlink" title="1. æºç åˆ†æ”¯è·å–"></a>1. æºç åˆ†æ”¯è·å–</h3><p>æ ¹æ®æ‰‹æœºå‹å·é€‰æ‹©åˆ†æ”¯åç§°</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>source.android.google.cn<span class="hljs-regexp">/setup/</span>build/building-kernels?hl=zh-cn<span class="hljs-comment">#customize-build</span><br></code></pre></td></tr></table></figure><p>Pixel XLçš„åˆ†æ”¯åç§°ä¸ºandroid-msm-marlin-3.18-pie-qpr2</p> <img src="/2021/08/22/pixel-XL%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91/images/%E5%88%86%E6%94%AF%E5%90%8D%E7%A7%B0.png" class=""><h3 id="2-ä¸‹è½½æºç "><a href="#2-ä¸‹è½½æºç " class="headerlink" title="2. ä¸‹è½½æºç "></a>2. ä¸‹è½½æºç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#å…±4Gæ–‡ä»¶éœ€è¦æ¢¯å­ï¼ŒæŒ‚ä¸ªvpn å¤§çº¦2ä¸ªå°æ—¶ä¸‹å®Œ</span><br>mkdir android-kernel &amp;&amp; cd android-kernel<br><br>repo init -u https://android.googlesource.com/kernel/manifest -b android-msm-marlin-<span class="hljs-number">3.18</span>-pie-qpr2<br>repo sync<br></code></pre></td></tr></table></figure><h3 id="3-æ„å»º"><a href="#3-æ„å»º" class="headerlink" title="3. æ„å»º"></a>3. æ„å»º</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#æ„å»ºaarch64çš„å†…æ ¸ç‰ˆæœ¬</span><br>./build/build.sh  BUILD_CONFIG=common/build.config.gki.aarch64<br></code></pre></td></tr></table></figure><p>æ³¨:æ­¤å¤„å¯èƒ½ä¼šæŠ¥é”™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">build/buildinfo/buildinfo.py <span class="hljs-keyword">not</span> found<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘build.config,å°†EXTRA_CMDS=â€™python build/buildinfo/buildinfo.pyâ€™ åˆ é™¤ï¼Œå®æµ‹å¯ä»¥ç¼–è¯‘æˆåŠŸ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">KERNEL_DIR=private/msm-google<br>. $&#123;ROOT_DIR&#125;/$&#123;KERNEL_DIR&#125;/build.config.common<br>POST_DEFCONFIG_CMDS=<span class="hljs-string">&quot;check_defconfig &amp;&amp; compression_tool_and_files lz4&quot;</span><br>EXTRA_CMDS=<span class="hljs-string">&#x27;python build/buildinfo/buildinfo.py&#x27;</span>      <span class="hljs-comment"># &lt;----åˆ é™¤æ­¤è¡Œ</span><br>STOP_SHIP_TRACEPRINTK=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>ç¼–è¯‘æˆåŠŸåå†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶ã€æ¨¡å—å’Œç›¸åº”çš„æ˜ åƒä½äº out/android-msm-marlinxxxxx/dist ç›®å½•ä¸‹ã€‚</p><h3 id="4-åˆ·æœº"><a href="#4-åˆ·æœº" class="headerlink" title="4. åˆ·æœº"></a>4. åˆ·æœº</h3><h4 id="4-1-ä¸´æ—¶åˆ·å…¥"><a href="#4-1-ä¸´æ—¶åˆ·å…¥" class="headerlink" title="4.1 ä¸´æ—¶åˆ·å…¥"></a>4.1 ä¸´æ—¶åˆ·å…¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#åˆ·å…¥out/xxx/Image.lz4-dtb </span><br><span class="hljs-comment">#ä¸´æ—¶æœ‰æ•ˆï¼Œé‡å¯æ¢å¤ä¹‹å‰å†…æ ¸</span><br><br>adb reboot bootloader<br>fastboot boot Image.lz4-dtb  <br></code></pre></td></tr></table></figure><h4 id="4-2-æ°¸ä¹…åˆ·å…¥"><a href="#4-2-æ°¸ä¹…åˆ·å…¥" class="headerlink" title="4.2 æ°¸ä¹…åˆ·å…¥"></a>4.2 æ°¸ä¹…åˆ·å…¥</h4><h5 id="4-2-1-æ‹·è´å†…æ ¸æ–‡ä»¶åˆ°AOSPé¡¹ç›®ä¸‹"><a href="#4-2-1-æ‹·è´å†…æ ¸æ–‡ä»¶åˆ°AOSPé¡¹ç›®ä¸‹" class="headerlink" title="4.2.1 æ‹·è´å†…æ ¸æ–‡ä»¶åˆ°AOSPé¡¹ç›®ä¸‹"></a>4.2.1 æ‹·è´å†…æ ¸æ–‡ä»¶åˆ°AOSPé¡¹ç›®ä¸‹</h5><p>å°†<code>out/xxx/Image.lz4-dtb</code> æ‹·è´åˆ°<code> device/google/marlin-kernel</code>ä¸‹ï¼ˆä»¥é˜²ä¸‡ä¸€æ‹·è´ä¹‹å‰å¤‡ä»½<code>device/google/marlin-kernel/Image.lz4-dtb</code>ï¼‰</p><h5 id="4-2-2-ç¼–è¯‘aosp"><a href="#4-2-2-ç¼–è¯‘aosp" class="headerlink" title="4.2.2  ç¼–è¯‘aosp"></a>4.2.2  ç¼–è¯‘aosp</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">source build/envsetup.sh<br>lunch <span class="hljs-number">15</span>   <span class="hljs-comment">#æ ¹æ®æœºå‹é€‰æ‹©ä¸åŒç‰ˆæœ¬</span><br>make bootimage<br></code></pre></td></tr></table></figure><h5 id="4-2-3-ç¼–è¯‘å®Œæˆåˆ·å…¥ç³»ç»Ÿ"><a href="#4-2-3-ç¼–è¯‘å®Œæˆåˆ·å…¥ç³»ç»Ÿ" class="headerlink" title="4.2.3 ç¼–è¯‘å®Œæˆåˆ·å…¥ç³»ç»Ÿ"></a>4.2.3 ç¼–è¯‘å®Œæˆåˆ·å…¥ç³»ç»Ÿ</h5><p>åˆ·å…¥/out/target/product/marlin/boot.img</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">fastboot flash boot boot.img<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>rom</tag>
      
      <tag>å†…æ ¸</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>adbæŸ¥çœ‹å½“å‰Activity</title>
    <link href="/2021/08/22/adb%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8DActivity/"/>
    <url>/2021/08/22/adb%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8DActivity/</url>
    
    <content type="html"><![CDATA[<h2 id="Android-8-1å‰"><a href="#Android-8-1å‰" class="headerlink" title="Android 8.1å‰"></a>Android 8.1å‰</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">adb <span class="hljs-keyword">shell</span> dumpsys activity | <span class="hljs-keyword">grep</span> <span class="hljs-string">&quot;mFocus&quot;</span><br></code></pre></td></tr></table></figure><h2 id="Android-8-1-å"><a href="#Android-8-1-å" class="headerlink" title="Android 8.1 å"></a>Android 8.1 å</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">adb <span class="hljs-keyword">shell</span> dumpsys activity | <span class="hljs-keyword">grep</span> <span class="hljs-string">&quot;mResume&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>adb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>adbè®¾ç½®ä»£ç†</title>
    <link href="/2021/08/22/adb%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/"/>
    <url>/2021/08/22/adb%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="è®¾ç½®ä»£ç†"><a href="#è®¾ç½®ä»£ç†" class="headerlink" title="è®¾ç½®ä»£ç†"></a>è®¾ç½®ä»£ç†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb shell settings put global http_proxy 127.0.0.1:8888<br></code></pre></td></tr></table></figure><h2 id="ç§»é™¤ä»£ç†ï¼ˆéœ€è¦é‡å¯ï¼‰ï¼š"><a href="#ç§»é™¤ä»£ç†ï¼ˆéœ€è¦é‡å¯ï¼‰ï¼š" class="headerlink" title="ç§»é™¤ä»£ç†ï¼ˆéœ€è¦é‡å¯ï¼‰ï¼š"></a>ç§»é™¤ä»£ç†ï¼ˆéœ€è¦é‡å¯ï¼‰ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb shell settings delete global http_proxy<br><br>adb shell settings delete global global_http_proxy_host<br><br>adb shell settings delete global global_http_proxy_port<br><br>adb reboot<br></code></pre></td></tr></table></figure><h2 id="ä¸é‡å¯ç§»é™¤ä»£ç†"><a href="#ä¸é‡å¯ç§»é™¤ä»£ç†" class="headerlink" title="ä¸é‡å¯ç§»é™¤ä»£ç†:"></a>ä¸é‡å¯ç§»é™¤ä»£ç†:</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb shell settings put global http_proxy :0<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>adb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>amå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2021/08/21/am%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2021/08/21/am%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="æ‹¨æ‰“ç”µè¯10086"><a href="#æ‹¨æ‰“ç”µè¯10086" class="headerlink" title="æ‹¨æ‰“ç”µè¯10086"></a>æ‹¨æ‰“ç”µè¯10086</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">adb shell am start -<span class="hljs-selector-tag">a</span> android<span class="hljs-selector-class">.intent</span><span class="hljs-selector-class">.action</span><span class="hljs-selector-class">.CALL</span> -d tel:<span class="hljs-number">10086</span><br></code></pre></td></tr></table></figure><h2 id="æ‰“å¼€ç½‘å€"><a href="#æ‰“å¼€ç½‘å€" class="headerlink" title="æ‰“å¼€ç½‘å€"></a>æ‰“å¼€ç½‘å€</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">adb shell am start -<span class="hljs-selector-tag">a</span> android<span class="hljs-selector-class">.intent</span><span class="hljs-selector-class">.action</span><span class="hljs-selector-class">.VIEW</span> -d  http:<span class="hljs-comment">//gityuan.com</span><br></code></pre></td></tr></table></figure><h2 id="å¯åŠ¨Activity"><a href="#å¯åŠ¨Activity" class="headerlink" title="å¯åŠ¨Activity"></a>å¯åŠ¨Activity</h2><p> å¯åŠ¨åŒ…åä¸º<code>com.yuanhh.app</code>ï¼Œä¸»Activityä¸º<code>.MainActivity</code>  ä¸”extraæ•°æ®ä»¥â€websiteâ€ä¸ºkey, â€œyuanh.comâ€ä¸ºvalue</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">am</span> start -n <span class="hljs-keyword">com</span>.yuanhh.app/.MainActivity -es website gityuan.<span class="hljs-keyword">com</span><br></code></pre></td></tr></table></figure><h2 id="å‘é€å¹¿æ’­"><a href="#å‘é€å¹¿æ’­" class="headerlink" title="å‘é€å¹¿æ’­"></a>å‘é€å¹¿æ’­</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">adb shell am broadcast -a com.android.test <span class="hljs-params">--es</span> test_string <span class="hljs-string">&quot;this is test string&quot;</span> <span class="hljs-params">--ei</span> test_int 100 <span class="hljs-params">--ez</span> test_boolean <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å‘½ä»¤åˆ—è¡¨ï¼š</p><table><thead><tr><th align="left">å‘½ä»¤</th><th align="left">åŠŸèƒ½</th><th align="left">å®ç°æ–¹æ³•</th></tr></thead><tbody><tr><td align="left">am start [options] <INTENT></td><td align="left">å¯åŠ¨Activity</td><td align="left">startActivityAsUser</td></tr><tr><td align="left">am startservice <INTENT></td><td align="left">å¯åŠ¨Service</td><td align="left">startService</td></tr><tr><td align="left">am stopservice <INTENT></td><td align="left">åœæ­¢Service</td><td align="left">stopService</td></tr><tr><td align="left">am broadcast <INTENT></td><td align="left">å‘é€å¹¿æ’­</td><td align="left">broadcastIntent</td></tr><tr><td align="left">am kill <PACKAGE></td><td align="left">æ€æŒ‡å®šåå°è¿›ç¨‹</td><td align="left">killBackgroundProcesses</td></tr><tr><td align="left">am kill-all</td><td align="left">æ€æ‰€æœ‰åå°è¿›ç¨‹</td><td align="left">killAllBackgroundProcesses</td></tr><tr><td align="left">am force-stop <PACKAGE></td><td align="left">å¼ºæ€è¿›ç¨‹</td><td align="left">forceStopPackage</td></tr><tr><td align="left">am hang</td><td align="left">ç³»ç»Ÿå¡ä½</td><td align="left">hang</td></tr><tr><td align="left">am restart</td><td align="left">é‡å¯</td><td align="left">restart</td></tr><tr><td align="left">am bug-report</td><td align="left">åˆ›å»ºbugreport</td><td align="left">requestBugReport</td></tr><tr><td align="left">am dumpheap <pid> <file></td><td align="left">è¿›ç¨‹pidçš„å †ä¿¡æ¯è¾“å‡ºåˆ°file</td><td align="left">dumpheap</td></tr><tr><td align="left">am send-trim-memory <pid> <level></td><td align="left">æ”¶ç´§è¿›ç¨‹çš„å†…å­˜</td><td align="left">setProcessMemoryTrimLevel</td></tr><tr><td align="left">am monitor</td><td align="left">ç›‘æ§</td><td align="left">MyActivityController.run</td></tr></tbody></table><p>amå‘½ä»¤å®çš„å®ç°æ–¹å¼åœ¨Am.javaï¼Œæœ€ç»ˆå‡ ä¹éƒ½æ˜¯è°ƒç”¨<code>ActivityManagerService</code>ç›¸åº”çš„æ–¹æ³•æ¥å®Œæˆçš„ï¼Œ<code>am monitor</code>é™¤å¤–ã€‚æ¯”å¦‚å‰é¢æ¦‚è¿°ä¸­ä»‹ç»çš„å‘½ä»¤<code>am start -a android.intent.action.VIEW -d http://gityuan.com</code>ï¼Œ å¯åŠ¨Acitivtyæœ€ç»ˆè°ƒç”¨çš„æ˜¯ActivityManagerServiceç±»çš„startActivityAsUser()æ–¹æ³•æ¥å®Œæˆçš„ã€‚å†æ¯”å¦‚<code>am kill-all</code>å‘½ä»¤ï¼Œæœ€ç»ˆçš„å®ç°å·¥ä½œæ˜¯ç”±ActivityManagerServiceçš„killBackgroundProcesses()æ–¹æ³•å®Œæˆçš„</p><h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><p>ä¸»è¦æ˜¯å¯åŠ¨Activityå‘½ä»¤<code>am start [options] </code>ä½¿ç”¨optionså‚æ•°ï¼Œæ¥ä¸‹æ¥åˆ—ä¸¾Activityå‘½ä»¤çš„[options]å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">-D: å…è®¸è°ƒè¯•åŠŸèƒ½<br>-W: ç­‰å¾…appå¯åŠ¨å®Œæˆ<br>-R &lt;COUNT&gt;: é‡å¤å¯åŠ¨Activity COUNTæ¬¡<br>-S: å¯åŠ¨activityä¹‹å‰ï¼Œå…ˆè°ƒç”¨forceStopPackage()æ–¹æ³•å¼ºåˆ¶åœæ­¢app.<br>â€“opengl-trace: è¿è¡Œè·å–OpenGLå‡½æ•°çš„trace<br>â€“user &lt;USER_ID&gt; | current: æŒ‡å®šç”¨æˆ·æ¥è¿è¡ŒApp,é»˜è®¤ä¸ºå½“å‰ç”¨æˆ·ã€‚<br>â€“start-profiler &lt;FILE&gt;: å¯åŠ¨profilerï¼Œå¹¶å°†ç»“æœå‘é€åˆ° &lt;FILE&gt;;<br>-P &lt;FILE&gt;: ç±»ä¼¼ â€“start-profilerï¼Œä¸åŒçš„æ˜¯å½“appè¿›å…¥idleçŠ¶æ€ï¼Œåˆ™åœæ­¢profiling<br>â€“sampling INTERVAL: è®¾ç½®profiler å–æ ·æ—¶é—´é—´éš”ï¼Œå•ä½ms;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨Activityçš„å®ç°åŸç†ï¼š å­˜åœ¨-Wå‚æ•°åˆ™è°ƒç”¨startActivityAndWait()æ–¹æ³•æ¥è¿è¡Œï¼Œå¦åˆ™startActivityAsUser()ã€‚</p><h2 id="æ”¶ç´§å†…å­˜"><a href="#æ”¶ç´§å†…å­˜" class="headerlink" title="æ”¶ç´§å†…å­˜"></a>æ”¶ç´§å†…å­˜</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">am</span> send-trim-memory  <span class="hljs-symbol">&lt;pid&gt;</span> <span class="hljs-symbol">&lt;level&gt;</span><br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š å‘pid=12345çš„è¿›ç¨‹ï¼Œå‘å‡ºlevel=RUNNING_LOWçš„æ”¶ç´§å†…å­˜å‘½ä»¤</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">am send-<span class="hljs-keyword">trim</span>-<span class="hljs-keyword">memory</span> <span class="hljs-number">12345</span> RUNNING_LOWã€‚<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆlevelå–å€¼èŒƒå›´ä¸ºï¼š HIDDENã€RUNNING_MODERATEã€BACKGROUNDã€RUNNING_LOWã€MODERATEã€RUNNING_CRITICALã€COMPLETEã€‚</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>å¯¹äºamçš„å­å‘½ä»¤ï¼Œstartservice, stopservice, broadcast, kill, profile start, profile stop, dumpheapçš„å¯é€‰å‚æ•°éƒ½å…è®¸è®¾ç½®<code>--user </code>ã€‚ç›®å‰å¸‚é¢ä¸Šçš„ç»å¤§å¤šæ•°æ‰‹æœºè¿˜æ˜¯å•ç”¨æˆ·æ¨¡å¼ï¼Œæ•…å¯ä»¥å¿½ç•¥è¯¥å‚æ•°ï¼Œé»˜è®¤ä¸ºå½“å‰ç”¨æˆ·ã€‚</p><p>ä¾‹å¦‚ï¼šå¯åŠ¨id=10010çš„ç”¨æˆ·çš„æŒ‡å®šserviceã€‚</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">am startservice --<span class="hljs-keyword">user</span> <span class="hljs-title">10010</span><br></code></pre></td></tr></table></figure><h2 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h2><p>Intentçš„å‚æ•°å’Œflagsè¾ƒå¤šï¼Œåˆ†ä¸º3ç§ç±»å‹å‚æ•°ï¼Œå¸¸ç”¨å‚æ•°ï¼ŒExtraå‚æ•°ï¼ŒFlagså‚æ•°</p><h3 id="å¸¸ç”¨å‚æ•°"><a href="#å¸¸ç”¨å‚æ•°" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h3><ul><li><code>-a </code>: æŒ‡å®šIntent actionï¼Œ å®ç°åŸç†Intent.setAction()ï¼›</li><li><code>-n </code>: æŒ‡å®šç»„ä»¶åï¼Œæ ¼å¼ä¸º{åŒ…å}/.{ä¸»Activityå}ï¼Œå®ç°åŸç†Intent.setComponent(ï¼‰ï¼›</li><li><code>-d </code>: æŒ‡å®šIntent data URI</li><li><code>-t </code>: æŒ‡å®šIntent MIME Type</li><li> <code>-c &lt;CATEGORY&gt; [-c &lt;CATEGORY&gt;] ...]:</code>:æŒ‡å®šIntent categoryï¼Œå®ç°åŸç†Intent.addCategory()</li><li><code>-p </code>: æŒ‡å®šåŒ…åï¼Œå®ç°åŸç†Intent.setPackage();</li><li><code>-f </code>: æ·»åŠ flagsï¼Œå®ç°åŸç†Intent.setFlags(int )ï¼Œç´§æ¥ç€çš„å‚æ•°å¿…é¡»æ˜¯intå‹ï¼›</li></ul><p>å®ä¾‹</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">am start -<span class="hljs-selector-tag">a</span> android<span class="hljs-selector-class">.intent</span><span class="hljs-selector-class">.action</span><span class="hljs-selector-class">.VIEW</span><br>am start -n com<span class="hljs-selector-class">.yuanhh</span>.app/<span class="hljs-selector-class">.MainActivity</span><br>am start -d <span class="hljs-attribute">content</span>://contacts/people/<span class="hljs-number">1</span><br>am start -t image/png<br>am start -c android<span class="hljs-selector-class">.intent</span><span class="hljs-selector-class">.category</span>.APP_CONTACTS<br></code></pre></td></tr></table></figure><h3 id="Extraå‚æ•°"><a href="#Extraå‚æ•°" class="headerlink" title="Extraå‚æ•°"></a>Extraå‚æ•°</h3><h4 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a>åŸºæœ¬ç±»å‹</h4><table><thead><tr><th>å‚æ•°</th><th>-e/-es</th><th>-esn</th><th>-ez</th><th>-ei</th><th>-el</th><th>-ef</th><th>-eu</th><th>-ecn</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>String</td><td>(String)null</td><td>boolean</td><td>int</td><td>long</td><td>float</td><td>uri</td><td>component</td></tr></tbody></table><p>æ¯”å¦‚å‚æ•°esæ˜¯Extra Stringé¦–å­—æ¯ç®€ç§°ï¼Œå®ä¾‹ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">am</span> start -n <span class="hljs-keyword">com</span>.yuanhh.app/.MainActivity -es website gityuan.<span class="hljs-keyword">com</span><br></code></pre></td></tr></table></figure><p>æ­¤å¤„<code>-es website gityuan.com</code>ï¼Œç­‰ä»·äºIntent.putExtra(â€œwebsiteâ€, â€œgityuan.comâ€);</p><h4 id="æ•°ç»„ç±»å‹"><a href="#æ•°ç»„ç±»å‹" class="headerlink" title="æ•°ç»„ç±»å‹"></a>æ•°ç»„ç±»å‹</h4><table><thead><tr><th>å‚æ•°</th><th>-esa</th><th>-eia</th><th>-ela</th><th>-efa</th></tr></thead><tbody><tr><td>æ•°ç»„ç±»å‹</td><td>String[]</td><td>int[]</td><td>long[]</td><td>float[]</td></tr></tbody></table><p>æ¯”å¦‚å‚æ•°eiaï¼Œæ˜¯Extra int arrayé¦–å­—æ¯ç®€ç§°ï¼Œå¤šä¸ªvalueå€¼ä¹‹é—´ä»¥é€—å·éš”å¼€.ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">am</span> start -n com.yuanhh.app/.MainActivity -ela weekday <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p>æ­¤å¤„<code>-ela weekday 1,2,3,4,5</code>ï¼Œç­‰ä»·äºIntent.putExtra(â€œweekdayâ€, new int[]{1,2,3,4,5});</p><h4 id="ArrayListç±»å‹"><a href="#ArrayListç±»å‹" class="headerlink" title="ArrayListç±»å‹"></a>ArrayListç±»å‹</h4><table><thead><tr><th>å‚æ•°</th><th>-esal</th><th>-eial</th><th>-elal</th><th>-efal</th></tr></thead><tbody><tr><td>Listç±»å‹</td><td>String</td><td>int</td><td>long</td><td>float</td></tr></tbody></table><p>æ¯”å¦‚å‚æ•°efalï¼Œæ˜¯Extra float Array Listé¦–å­—æ¯ç®€ç§°ï¼Œå¤šä¸ªvalueå€¼ä¹‹é—´ä»¥é€—å·éš”å¼€ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">am</span> start -n com.yuanhh.app/.MainActivity -efal nums <span class="hljs-number">1</span>.<span class="hljs-number">2</span>,<span class="hljs-number">2</span>.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>æ­¤å¤„<code>-efal nums 1.2,2.2</code>ï¼Œç­‰ä»·äºå…ˆæ„é€ ArrayListå˜é‡ï¼Œå†é€šè¿‡putExtraæ”¾å…¥ç¬¬äºŒä¸ªå‚æ•°ã€‚</p><h3 id="Flagså‚æ•°"><a href="#Flagså‚æ•°" class="headerlink" title="Flagså‚æ•°"></a>Flagså‚æ•°</h3><p>åœ¨å‚æ•°ç±»å‹1ä¸­ï¼Œæåˆ°æœ‰<code>-f </code>ï¼Œæ˜¯é€šè¿‡<code>Intent.setFlags(int )</code>æ–¹æ³•ï¼Œæ¥è®¾ç½®Intentçš„flags.æœ¬å°èŠ‚ä¹Ÿæ˜¯å…³äºflagsï¼Œæ˜¯é€šè¿‡<code>Intent.addFlags(int )</code>æ–¹æ³•ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæ‰€æœ‰çš„flagså‚æ•°ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json">[--grant-read-uri-permission] [--grant-write-uri-permission]<br>[--grant-persistable-uri-permission] [--grant-prefix-uri-permission]<br>[--debug-log-resolution]<br>[--exclude-stopped-packages] [--include-stopped-packages]<br>[--activity-brought-to-front] [--activity-clear-top]<br>[--activity-clear-when-task-reset] [--activity-exclude-from-recents]<br>[--activity-launched-from-history] [--activity-multiple-task]<br>[--activity-no-animation] [--activity-no-history]<br>[--activity-no-user-action] [--activity-previous-is-top]<br>[--activity-reorder-to-front] [--activity-reset-task-if-needed]<br>[--activity-single-top] [--activity-clear-task]<br>[--activity-task-on-home]<br>[--receiver-registered-only] [--receiver-replace-pending]<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå‘é€action=â€broadcast.demoâ€çš„å¹¿æ’­ï¼Œå¹¶ä¸”å¯¹äºforceStopPackage()çš„åº”ç”¨ä¸å…è®¸æ¥æ”¶è¯¥å¹¿æ’­ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">am broadcast -<span class="hljs-keyword">a</span> broadcast.demo <span class="hljs-comment">--exclude-stopped-packages</span><br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.jianshu.com<span class="hljs-regexp">/p/</span>ea84febaa7bd<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>adb</tag>
      
      <tag>am</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IOS13.3.1 è¶Šç‹±åè®¾ç½®ä¸­æœªæ˜¾ç¤ºè¶Šç‹±æ’ä»¶</title>
    <link href="/2021/08/21/IOS13-3-1-%E8%B6%8A%E7%8B%B1%E5%90%8E%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%9C%AA%E6%98%BE%E7%A4%BA%E8%B6%8A%E7%8B%B1%E6%8F%92%E4%BB%B6/"/>
    <url>/2021/08/21/IOS13-3-1-%E8%B6%8A%E7%8B%B1%E5%90%8E%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%9C%AA%E6%98%BE%E7%A4%BA%E8%B6%8A%E7%8B%B1%E6%8F%92%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<ol><li>è¿›å…¥ cydia é‡æ–°å®‰è£… <code>cydia substrate</code>å¦‚æœè¿˜æœªæ˜¾ç¤ºï¼Œé‡æ–°å®‰è£… <code>Preference Loader</code></li></ol>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¶Šç‹±</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot+JWT TokenéªŒè¯</title>
    <link href="/2021/08/21/SpringBoot-JWT-Token%E9%AA%8C%E8%AF%81/"/>
    <url>/2021/08/21/SpringBoot-JWT-Token%E9%AA%8C%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<h2 id="1-pom-xml-æ·»åŠ ä¾èµ–"><a href="#1-pom-xml-æ·»åŠ ä¾èµ–" class="headerlink" title="1. pom.xml æ·»åŠ ä¾èµ–"></a>1. pom.xml æ·»åŠ ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-application-yml"><a href="#2-application-yml" class="headerlink" title="2. application.yml"></a>2. application.yml</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">jwt:</span><br>  <span class="hljs-attr">expire:</span> <span class="hljs-number">86400000</span>      <span class="hljs-comment">#jwtæœ‰æ•ˆæ—¶é—´(24å°æ—¶)</span><br>  <span class="hljs-attr">secret:</span> <span class="hljs-string">secret</span>        <span class="hljs-comment"># ç­¾åå¯†é’¥</span><br></code></pre></td></tr></table></figure><h2 id="3-å·¥å…·ç±»ç”Ÿæˆã€éªŒè¯tokenã€æ ¹æ®tokenæå–ç”¨æˆ·ID"><a href="#3-å·¥å…·ç±»ç”Ÿæˆã€éªŒè¯tokenã€æ ¹æ®tokenæå–ç”¨æˆ·ID" class="headerlink" title="3. å·¥å…·ç±»ç”Ÿæˆã€éªŒè¯tokenã€æ ¹æ®tokenæå–ç”¨æˆ·ID"></a>3. å·¥å…·ç±»ç”Ÿæˆã€éªŒè¯tokenã€æ ¹æ®tokenæå–ç”¨æˆ·ID</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JwtUtil</span> </span>&#123;<br><br>    <span class="hljs-comment">//tokenæœ‰æ•ˆæ—¶é•¿</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">long</span> EXPIRE_TIME;<br>    <span class="hljs-comment">//å¯†é’¥</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String SECRET;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.secret&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSecret</span><span class="hljs-params">(String secret)</span> </span>&#123;<br>        JwtUtil.SECRET= secret;<br>    &#125;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.expire&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setExpireTime</span><span class="hljs-params">(<span class="hljs-keyword">long</span> date)</span> </span>&#123;<br>        JwtUtil.EXPIRE_TIME= date;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”Ÿæˆç­¾åï¼Œ24å°æ—¶åè¿‡æœŸ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getToken</span><span class="hljs-params">(String userId)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Date date = <span class="hljs-keyword">new</span> Date(System.currentTimeMillis() + EXPIRE_TIME);<br>            Algorithm algorithm = Algorithm.HMAC256(SECRET);<br>            <span class="hljs-keyword">return</span> JWT.create()<br>                    <span class="hljs-comment">// å°† user id ä¿å­˜åˆ° token é‡Œé¢</span><br>                    .withAudience(userId)<br>                    .withExpiresAt(date)<br>                    <span class="hljs-comment">// token çš„å¯†é’¥</span><br>                    .sign(algorithm);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®tokenè·å–userId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> token</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getUserName</span><span class="hljs-params">(String token)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            String userId = JWT.decode(token).getAudience().get(<span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">return</span> userId;<br>        &#125; <span class="hljs-keyword">catch</span> (JWTDecodeException e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¡éªŒtoken</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> token</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DecodedJWT <span class="hljs-title">verify</span><span class="hljs-params">(String token)</span></span>&#123;<br>        JWTVerifier build = JWT.require(Algorithm.HMAC256(SECRET)).build();<br>        <span class="hljs-keyword">return</span> build.verify(token);  <br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-æ·»åŠ æ‹¦æˆªå™¨"><a href="#4-æ·»åŠ æ‹¦æˆªå™¨" class="headerlink" title="4. æ·»åŠ æ‹¦æˆªå™¨"></a>4. æ·»åŠ æ‹¦æˆªå™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JwtInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object object)</span> </span>&#123;<br>        <span class="hljs-comment">//OPTIONSè¯·æ±‚é»˜è®¤é€šè¿‡</span><br>        <span class="hljs-keyword">if</span> (httpServletRequest.getMethod().equals(<span class="hljs-string">&quot;OPTIONS&quot;</span>))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125;<br>        <span class="hljs-comment">//è·å–è¯·æ±‚å¤´X-Tokenå­—æ®µ</span><br>        String token = httpServletRequest.getHeader(<span class="hljs-string">&quot;X-Token&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            JwtUtil.verify(token);<br>        &#125;<span class="hljs-keyword">catch</span> (SignatureVerificationException e)&#123;<br>            <span class="hljs-comment">//e.printStackTrace();</span><br>            System.out.println(<span class="hljs-string">&quot;æ— æ•ˆç­¾å&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<span class="hljs-keyword">catch</span> (TokenExpiredException e)&#123;<br>            <span class="hljs-comment">//e.printStackTrace();</span><br>            System.out.println(<span class="hljs-string">&quot;tokenè¿‡æœŸ&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<span class="hljs-keyword">catch</span> (AlgorithmMismatchException e)&#123;<br>            <span class="hljs-comment">//e.printStackTrace();</span><br>            System.out.println(<span class="hljs-string">&quot;tokenç®—æ³•ä¸ä¸€è‡´&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-comment">//e.printStackTrace();</span><br>            System.out.println(<span class="hljs-string">&quot;tokenæ— æ•ˆ&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postHandle</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterCompletion</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-é…ç½®æ‹¦æˆªå™¨"><a href="#5-é…ç½®æ‹¦æˆªå™¨" class="headerlink" title="5. é…ç½®æ‹¦æˆªå™¨"></a>5. é…ç½®æ‹¦æˆªå™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InterceptorConfig</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;<br><br>        registry.addInterceptor(<span class="hljs-keyword">new</span> JwtInterceptor())<br>                <span class="hljs-comment">//æ‹¦æˆªçš„è·¯å¾„</span><br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)<br>                <span class="hljs-comment">//æ’é™¤ç™»å½•æ¥å£</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/prod-api/user/login&quot;</span>)<br>                .excludePathPatterns(<span class="hljs-string">&quot;/prod-api/user/logout&quot;</span>);<br>        WebMvcConfigurer.<span class="hljs-keyword">super</span>.addInterceptors(registry);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="6-controllerå±‚å®ç°ç™»å½•æ–¹æ³•å’Œè·å–ç”¨æˆ·ä¿¡æ¯"><a href="#6-controllerå±‚å®ç°ç™»å½•æ–¹æ³•å’Œè·å–ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="6. controllerå±‚å®ç°ç™»å½•æ–¹æ³•å’Œè·å–ç”¨æˆ·ä¿¡æ¯"></a>6. controllerå±‚å®ç°ç™»å½•æ–¹æ³•å’Œè·å–ç”¨æˆ·ä¿¡æ¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/login&quot;,method = RequestMethod.POST)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Result&lt;JSONObject&gt; <span class="hljs-title">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String userInfo)</span></span>&#123;<br>    JSONObject jsonObject = JSON.parseObject(userInfo);<br>    String username = (String) jsonObject.get(<span class="hljs-string">&quot;username&quot;</span>);  <span class="hljs-comment">//è·å–ç™»å½•è´¦å·</span><br>    String password = (String) jsonObject.get(<span class="hljs-string">&quot;password&quot;</span>);  <span class="hljs-comment">//ç™»å½•å¯†ç </span><br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * éªŒè¯ç”¨æˆ·å¯†ç æ˜¯å¦æ­£ç¡®ï¼ˆæ­¤å¤„çœç•¥ï¼‰</span><br><span class="hljs-comment">     */</span>        <br><br>    JSONObject dataJson = <span class="hljs-keyword">new</span> JSONObject();<br>    dataJson.put(<span class="hljs-string">&quot;token&quot;</span>,JwtUtil.getToken(username));  <span class="hljs-comment">//å°†ç”Ÿæˆtokenå‘é€è‡³ç”¨æˆ·</span><br>    <span class="hljs-keyword">return</span> Result.success(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>, dataJson);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="7-æµ‹è¯•"><a href="#7-æµ‹è¯•" class="headerlink" title="7. æµ‹è¯•"></a>7. æµ‹è¯•</h2><p>ç™»å½•æˆåŠŸè¿”å›token</p> <img src="/2021/08/21/SpringBoot-JWT-Token%E9%AA%8C%E8%AF%81/images/login.png" class=""><p>æ›´æ”¹è¯·æ±‚x-tokenï¼Œè¢«æ‹¦æˆªå™¨æ‹¦æˆªè¿”å›é”™è¯¯ä¿¡æ¯</p> <img src="/2021/08/21/SpringBoot-JWT-Token%E9%AA%8C%E8%AF%81/images/token.png" class=""><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p><a href="https://github.com/lingade/springboot-jwt">SpringBoot+JWT TokenéªŒè¯</a></p>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JWT</tag>
      
      <tag>java</tag>
      
      <tag>springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FridaåŠ è½½APK/DEXæ–‡ä»¶å¹¶è°ƒç”¨æ–¹æ³•</title>
    <link href="/2021/08/21/Frida%E5%8A%A0%E8%BD%BDAPK-DEX%E6%96%87%E4%BB%B6%E5%B9%B6%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <url>/2021/08/21/Frida%E5%8A%A0%E8%BD%BDAPK-DEX%E6%96%87%E4%BB%B6%E5%B9%B6%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="1-AndroidStudioåˆ›å»ºé¡¹ç›®"><a href="#1-AndroidStudioåˆ›å»ºé¡¹ç›®" class="headerlink" title="1. AndroidStudioåˆ›å»ºé¡¹ç›®"></a>1. AndroidStudioåˆ›å»ºé¡¹ç›®</h2><p>åˆ›å»ºreturnNumæ–¹æ³•</p> <img src="/2021/08/21/Frida%E5%8A%A0%E8%BD%BDAPK-DEX%E6%96%87%E4%BB%B6%E5%B9%B6%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95/images/as.png" class=""><h2 id="2-buildé¡¹ç›®ï¼Œå°†apk-pushæ‰‹æœºä¸­"><a href="#2-buildé¡¹ç›®ï¼Œå°†apk-pushæ‰‹æœºä¸­" class="headerlink" title="2. buildé¡¹ç›®ï¼Œå°†apk pushæ‰‹æœºä¸­"></a>2. buildé¡¹ç›®ï¼Œå°†apk pushæ‰‹æœºä¸­</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb push 1.apk /data/local/tmp<br></code></pre></td></tr></table></figure><h2 id="3-FridaåŠ è½½APKè°ƒç”¨æ–¹æ³•"><a href="#3-FridaåŠ è½½APKè°ƒç”¨æ–¹æ³•" class="headerlink" title="3. FridaåŠ è½½APKè°ƒç”¨æ–¹æ³•"></a>3. FridaåŠ è½½APKè°ƒç”¨æ–¹æ³•</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> DEXFactory = <span class="hljs-literal">null</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadAPK</span>(<span class="hljs-params">path</span>)</span>&#123;<br>    <span class="hljs-keyword">var</span> ActivityThread = Java.use(<span class="hljs-string">&quot;android.app.ActivityThread&quot;</span>);<br>    <span class="hljs-keyword">var</span> app = ActivityThread.currentApplication();<br>    Java.classFactory.cacheDir = <span class="hljs-string">&quot;/data/data/&quot;</span> + app.getPackageName() + <span class="hljs-string">&quot;/cache&quot;</span>;<br>    Java.classFactory.codeCacheDir = <span class="hljs-string">&quot;/data/data/&quot;</span> + app.getPackageName() + <span class="hljs-string">&quot;/code_cache&quot;</span>;<br>    <span class="hljs-keyword">var</span> DexClassLoader = Java.use(<span class="hljs-string">&quot;dalvik.system.DexClassLoader&quot;</span>);<br>    <span class="hljs-keyword">var</span> DEXCL = DexClassLoader.$new(path, Java.classFactory.codeCacheDir, <span class="hljs-literal">null</span>, DexClassLoader.getSystemClassLoader());<br>    DEXFactory = Java.ClassFactory.get(DEXCL);<br>    DEXFactory.cacheDir = <span class="hljs-string">&quot;/data/data/&quot;</span> + app.getPackageName() + <span class="hljs-string">&quot;/cache&quot;</span>;<br>    DEXFactory.codeCacheDir = <span class="hljs-string">&quot;/data/data/&quot;</span> + app.getPackageName() + <span class="hljs-string">&quot;/code_cache&quot;</span>;<br>&#125;<br><br><br>Java.performNow(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    loadAPK(<span class="hljs-string">&quot;/data/local/tmp/1.apk&quot;</span>);<br>    <span class="hljs-keyword">var</span> utils = DEXFactory.use(<span class="hljs-string">&quot;custom.dex.utils&quot;</span>);<br>    <span class="hljs-built_in">console</span>.log(utils.returnNum());<br><br>&#125;);<br></code></pre></td></tr></table></figure><p>åŠ è½½APKå¹¶è°ƒç”¨æ–¹æ³•,æ­¤å¤„æ–¹æ³•åªæ˜¯ç®€å•çš„return æ•°å­—ï¼Œä¹Ÿå¯ä»¥å°†ä¸€äº›å¤æ‚çš„é€»è¾‘æ”¾åœ¨APKä¸­ç”¨äºè°ƒç”¨</p> <img src="/2021/08/21/Frida%E5%8A%A0%E8%BD%BDAPK-DEX%E6%96%87%E4%BB%B6%E5%B9%B6%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95/images/frida.png" class=""><h2 id="4-FridaåŠ è½½DEXè°ƒç”¨æ–¹æ³•"><a href="#4-FridaåŠ è½½DEXè°ƒç”¨æ–¹æ³•" class="headerlink" title="4.FridaåŠ è½½DEXè°ƒç”¨æ–¹æ³•"></a>4.FridaåŠ è½½DEXè°ƒç”¨æ–¹æ³•</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">Java.openClassFile(<span class="hljs-string">&quot;/data/local/tmp/xxx.dex&quot;</span>).load();<br><span class="hljs-keyword">var</span>  utils = Java.use(<span class="hljs-string">&quot;custom.dex.utils&quot;</span>);<br><span class="hljs-built_in">console</span>.log(utils.returnNum());<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>frida</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>frida</tag>
      
      <tag>hook</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
